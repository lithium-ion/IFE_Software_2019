ARM GAS  /tmp/ccouNvQA.s 			page 1


   1              		.cpu cortex-m3
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 1
   9              		.eabi_attribute 34, 1
  10              		.eabi_attribute 18, 4
  11              		.file	"LTC6811.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.section	.text.initPECTable,"ax",%progbits
  16              		.align	1
  17              		.global	initPECTable
  18              		.syntax unified
  19              		.thumb
  20              		.thumb_func
  21              		.fpu softvfp
  23              	initPECTable:
  24              	.LFB66:
  25              		.file 1 "Src/LTC6811.c"
   1:Src/LTC6811.c **** /*
   2:Src/LTC6811.c **** 	LTC6811 Command Functions
   3:Src/LTC6811.c **** 	Matt Vlasaty
   4:Src/LTC6811.c **** 	March 29th, 2019
   5:Src/LTC6811.c **** 	
   6:Src/LTC6811.c **** 	General Functions
   7:Src/LTC6811.c **** 		sendBroadcastCommand: void sendBroadcastCommand(CommandCodeTypedef command);
   8:Src/LTC6811.c **** 			- sends specified write-only command to every LTC in the chain (ex: ADCV)
   9:Src/LTC6811.c **** 			- CommandCodeTypedef enum contains every command code used
  10:Src/LTC6811.c **** 		sendAddressCommand: void sendAddressCommand(CommandCodeTypedef command, uint8_t address);
  11:Src/LTC6811.c **** 			- sends specified write-only command to LTC with specified address
  12:Src/LTC6811.c **** 		readRegister: bool readRegister(CommandCodeTypedef command, uint8_t address, uint16_t *data);
  13:Src/LTC6811.c **** 			- reads register specified in command from specified board
  14:Src/LTC6811.c **** 			- ex: ReadCellVoltageRegisterGroup1to3, ReadAuxiliaryGroupA, ReadConfigurationRegisterGroup
  15:Src/LTC6811.c **** 			- returns true if received PEC matches calculated PEC
  16:Src/LTC6811.c **** 		
  17:Src/LTC6811.c **** 	Configuration Functions
  18:Src/LTC6811.c **** 		writeConfigAll: void writeConfigAll(BMSconfigStructTypedef cfg);
  19:Src/LTC6811.c **** 			- writes configuration data from BMSconfig struct into LTC configuration register
  20:Src/LTC6811.c **** 			- BMSconfig struct includes ADCMode, UV, OV, and discharge enable for each cell
  21:Src/LTC6811.c **** 			- BMSconfig struct also contains number of ICs and array of addresses used
  22:Src/LTC6811.c **** 		writeConfigAddress: void writeConfigAddress(BMSconfigStructTypedef cfg, uint8_t address);
  23:Src/LTC6811.c **** 			- this is only used for cellDischarge command
  24:Src/LTC6811.c **** 			- writes configuration data to LTC with specified address
  25:Src/LTC6811.c **** 		readConfig: bool readConfig(uint8_t address, uint8_t cfg[6]);
  26:Src/LTC6811.c **** 			- uses general readRegister function to check current state of LTC configuration register
  27:Src/LTC6811.c **** 			- this is mostly for testing purposes
  28:Src/LTC6811.c **** 			- returns true if received PEC matches calculated PEC (same as readRegister)
  29:Src/LTC6811.c **** 		
  30:Src/LTC6811.c **** 	Cell Voltage Functions
  31:Src/LTC6811.c **** 		readCellVoltage: bool readCellVoltage(uint8_t address, uint16_t cellVoltage[12]);
  32:Src/LTC6811.c **** 			- sends ADCV command that begins conversion for every cell to specified LTC
  33:Src/LTC6811.c **** 			- reads all cell voltage registers using general readRegister function
ARM GAS  /tmp/ccouNvQA.s 			page 2


  34:Src/LTC6811.c **** 			- used cell inputs (1, 2, 3, 4, 7, 8, 9, 10) must be chosen from cellVoltage[12] later
  35:Src/LTC6811.c **** 			- returns true if received PEC matches calculated PEC for every register read
  36:Src/LTC6811.c **** 		readAllCellVoltages: bool readAllCellVoltages(BMSconfigStructTypedef cfg, uint8_t bmsData[96][6])
  37:Src/LTC6811.c **** 			- stores cell number, cell voltage, and data valid bit into bmsData
  38:Src/LTC6811.c **** 			- returns true if no PEC for any register read for any board
  39:Src/LTC6811.c **** 	Cell Temperature Functions
  40:Src/LTC6811.c **** 		readCellTemp: bool readCellTemp(uint8_t address, uint16_t cellTemp[4], bool dcFault[4], bool temp
  41:Src/LTC6811.c **** 			- initiates ADC conversion for GPIO inputs connected to temperature sensors
  42:Src/LTC6811.c **** 			- reads auxiliary register groups using general readRegister function
  43:Src/LTC6811.c **** 			- converts measured voltage into temperature based on temperature sensor response
  44:Src/LTC6811.c **** 			- checks for disconnected temperature sensor and overtemperature faults for each LTC and stores 
  45:Src/LTC6811.c **** 		readAllCellTemps: bool readAllCellTemps(uint8_t numBoards, uint16_t cellTemp[numBoards][4], bool 
  46:Src/LTC6811.c **** 			- not tested
  47:Src/LTC6811.c **** 			- using order of ICs in BMSconfig, stores cell temperature for every cell on every board into 2D
  48:Src/LTC6811.c **** 			- returns false if any readCellTemp returns false
  49:Src/LTC6811.c **** 	
  50:Src/LTC6811.c **** 	Cell Connection Functions
  51:Src/LTC6811.c **** 		checkCellConnection: void checkCellConnection(uint16_t cellVoltage[12], bool cellConnection[12]);
  52:Src/LTC6811.c **** 			- needs previously obtained cell voltage measurements
  53:Src/LTC6811.c **** 			- initiates ADOW command with PUP = 0 to source 100uA while measuring cell voltage
  54:Src/LTC6811.c **** 			- reads cell voltages with readCellVoltage function
  55:Src/LTC6811.c **** 			- compares previously measured values to open wire check values
  56:Src/LTC6811.c **** 			- if there is a significant drop in voltage (should be configurable), cell is disconnected
  57:Src/LTC6811.c **** 			- stores 1 into cellConnection if cell is connected
  58:Src/LTC6811.c **** 			- stores 0 into cellConnection if cell is disconnected
  59:Src/LTC6811.c **** 		checkAllCellConnections: 
  60:Src/LTC6811.c **** 	
  61:Src/LTC6811.c **** 	PEC Functions
  62:Src/LTC6811.c **** 		initPECTable: void initPECTable(void);
  63:Src/LTC6811.c **** 			- taken from LTC6811 datasheet
  64:Src/LTC6811.c **** 			- generates PEC look-up table
  65:Src/LTC6811.c **** 			- should be called on start-up
  66:Src/LTC6811.c **** 		calculatePEC: uint16_t calculatePEC(uint8_t len, uint8_t *data);
  67:Src/LTC6811.c **** 			- taken from LTC6811 datasheet
  68:Src/LTC6811.c **** 			- used when sending command to calculate necessary PEC bytes to follow command bytes
  69:Src/LTC6811.c **** 			- used when receiving data to compare received PEC with the PEC that should have been received b
  70:Src/LTC6811.c **** 			- returns uint16_t PEC value
  71:Src/LTC6811.c **** 			
  72:Src/LTC6811.c **** 	TODO:
  73:Src/LTC6811.c **** 		- checkCellConnection return value needs to disregard unused cell inputs
  74:Src/LTC6811.c **** 		- resolve issue with writeConfig not changing every bit in the first register group
  75:Src/LTC6811.c **** 		- test functions used to read from every board (readAllCellVoltages should be [12][8])
  76:Src/LTC6811.c **** 		- minor changes (using more user-defined constants, changing return values)
  77:Src/LTC6811.c **** 		
  78:Src/LTC6811.c **** 	NOTES:
  79:Src/LTC6811.c **** 		- writeConfig is called every loop for every LTC because dischargeCells is called every loop for 
  80:Src/LTC6811.c **** 		- always take measurements, only send when not charging? (CAN messages for charging?)
  81:Src/LTC6811.c **** 		- every 'readAll' function starts with address = 0 and increases sequentially
  82:Src/LTC6811.c **** 		
  83:Src/LTC6811.c **** 		- in temp read, faults are determined but not transferred
  84:Src/LTC6811.c **** 		- temperature conversion works, but error is +/- 1 degree
  85:Src/LTC6811.c **** */
  86:Src/LTC6811.c **** 
  87:Src/LTC6811.c **** 
  88:Src/LTC6811.c **** #include "LTC6811.h"
  89:Src/LTC6811.c **** 
  90:Src/LTC6811.c **** uint16_t pec15Table[256];
ARM GAS  /tmp/ccouNvQA.s 			page 3


  91:Src/LTC6811.c **** uint16_t CRC15_POLY = 0x4599;
  92:Src/LTC6811.c **** 
  93:Src/LTC6811.c **** void initPECTable(void) {
  26              		.loc 1 93 0
  27              		.cfi_startproc
  28              		@ args = 0, pretend = 0, frame = 0
  29              		@ frame_needed = 0, uses_anonymous_args = 0
  30              		@ link register save eliminated.
  31              	.LVL0:
  32              	.LBB2:
  94:Src/LTC6811.c **** 	
  95:Src/LTC6811.c **** 	uint16_t remainder;
  96:Src/LTC6811.c **** 	
  97:Src/LTC6811.c **** 	for (int i = 0; i < 256; i++) {
  33              		.loc 1 97 0
  34 0000 0020     		movs	r0, #0
  35 0002 11E0     		b	.L2
  36              	.LVL1:
  37              	.L4:
  38              	.LBB3:
  98:Src/LTC6811.c **** 		remainder = i << 7;
  99:Src/LTC6811.c **** 		for (int bit = 8; bit > 0; bit--) {
 100:Src/LTC6811.c **** 			if (remainder & 0x4000) {
 101:Src/LTC6811.c **** 				remainder = ((remainder << 1));
 102:Src/LTC6811.c **** 				remainder = (remainder ^ CRC15_POLY);
 103:Src/LTC6811.c **** 			}
 104:Src/LTC6811.c **** 			else {
 105:Src/LTC6811.c **** 				remainder = ((remainder << 1));
  39              		.loc 1 105 0
  40 0004 5B00     		lsls	r3, r3, #1
  41              	.LVL2:
  42 0006 9BB2     		uxth	r3, r3
  43              	.LVL3:
  44              	.L5:
  99:Src/LTC6811.c **** 			if (remainder & 0x4000) {
  45              		.loc 1 99 0 discriminator 2
  46 0008 013A     		subs	r2, r2, #1
  47              	.LVL4:
  48              	.L3:
  99:Src/LTC6811.c **** 			if (remainder & 0x4000) {
  49              		.loc 1 99 0 is_stmt 0 discriminator 1
  50 000a 002A     		cmp	r2, #0
  51 000c 08DD     		ble	.L8
 100:Src/LTC6811.c **** 				remainder = ((remainder << 1));
  52              		.loc 1 100 0 is_stmt 1
  53 000e 13F4804F 		tst	r3, #16384
  54 0012 F7D0     		beq	.L4
 101:Src/LTC6811.c **** 				remainder = (remainder ^ CRC15_POLY);
  55              		.loc 1 101 0
  56 0014 5B00     		lsls	r3, r3, #1
  57              	.LVL5:
  58 0016 9BB2     		uxth	r3, r3
  59              	.LVL6:
 102:Src/LTC6811.c **** 			}
  60              		.loc 1 102 0
  61 0018 0749     		ldr	r1, .L10
  62 001a 0988     		ldrh	r1, [r1]
ARM GAS  /tmp/ccouNvQA.s 			page 4


  63 001c 4B40     		eors	r3, r3, r1
  64              	.LVL7:
  65 001e F3E7     		b	.L5
  66              	.L8:
  67              	.LBE3:
 106:Src/LTC6811.c **** 			}
 107:Src/LTC6811.c **** 		}
 108:Src/LTC6811.c **** 		pec15Table[i] = remainder & 0xFFFF;
  68              		.loc 1 108 0 discriminator 2
  69 0020 064A     		ldr	r2, .L10+4
  70              	.LVL8:
  71 0022 22F81030 		strh	r3, [r2, r0, lsl #1]	@ movhi
  97:Src/LTC6811.c **** 		remainder = i << 7;
  72              		.loc 1 97 0 discriminator 2
  73 0026 0130     		adds	r0, r0, #1
  74              	.LVL9:
  75              	.L2:
  97:Src/LTC6811.c **** 		remainder = i << 7;
  76              		.loc 1 97 0 is_stmt 0 discriminator 1
  77 0028 FF28     		cmp	r0, #255
  78 002a 04DC     		bgt	.L9
  98:Src/LTC6811.c **** 		for (int bit = 8; bit > 0; bit--) {
  79              		.loc 1 98 0 is_stmt 1
  80 002c 83B2     		uxth	r3, r0
  81 002e DB01     		lsls	r3, r3, #7
  82 0030 9BB2     		uxth	r3, r3
  83              	.LVL10:
  84              	.LBB4:
  99:Src/LTC6811.c **** 			if (remainder & 0x4000) {
  85              		.loc 1 99 0
  86 0032 0822     		movs	r2, #8
  87 0034 E9E7     		b	.L3
  88              	.LVL11:
  89              	.L9:
  90              	.LBE4:
  91              	.LBE2:
 109:Src/LTC6811.c **** 	}
 110:Src/LTC6811.c **** };
  92              		.loc 1 110 0
  93 0036 7047     		bx	lr
  94              	.L11:
  95              		.align	2
  96              	.L10:
  97 0038 00000000 		.word	.LANCHOR0
  98 003c 00000000 		.word	pec15Table
  99              		.cfi_endproc
 100              	.LFE66:
 102              		.section	.text.calculatePEC,"ax",%progbits
 103              		.align	1
 104              		.global	calculatePEC
 105              		.syntax unified
 106              		.thumb
 107              		.thumb_func
 108              		.fpu softvfp
 110              	calculatePEC:
 111              	.LFB79:
 111:Src/LTC6811.c **** 
ARM GAS  /tmp/ccouNvQA.s 			page 5


 112:Src/LTC6811.c **** void writeConfigAddress(BMSconfigStructTypedef cfg, uint8_t address) {
 113:Src/LTC6811.c **** 
 114:Src/LTC6811.c **** 	uint8_t config[6];
 115:Src/LTC6811.c **** 	uint8_t *cmd;
 116:Src/LTC6811.c **** 	uint8_t cmd_len = 12;
 117:Src/LTC6811.c **** 	uint16_t PEC_return;
 118:Src/LTC6811.c **** 	uint8_t dummy[8];
 119:Src/LTC6811.c **** 
 120:Src/LTC6811.c **** 	readConfig(address, dummy);
 121:Src/LTC6811.c **** 	
 122:Src/LTC6811.c **** 	cmd = (uint8_t *)malloc(cmd_len*sizeof(uint8_t));
 123:Src/LTC6811.c **** 	
 124:Src/LTC6811.c **** 	config[0] = (uint8_t) (cfg.GPIO5PulldownOff << 7) | (cfg.GPIO4PulldownOff << 6) | (cfg.GPIO3Pulldo
 125:Src/LTC6811.c **** 	config[1] = (uint8_t) (cfg.UndervoltageComparisonVoltage & 0xFF);
 126:Src/LTC6811.c **** 	config[2] = (uint8_t) ((cfg.OvervoltageComparisonVoltage << 4) & 0xF0) | ((cfg.UndervoltageCompari
 127:Src/LTC6811.c **** 	config[3] = (uint8_t) ((cfg.OvervoltageComparisonVoltage >> 4) & 0xFF);
 128:Src/LTC6811.c **** 	config[4] = (uint8_t) (cfg.DischargeCell8 << 7) | (cfg.DischargeCell7 << 6) | (cfg.DischargeCell6 
 129:Src/LTC6811.c **** 	config[5] = (uint8_t) ((cfg.DischargeTimeoutValue << 4) & 0xF0) | (cfg.DischargeCell12 << 3) | (cf
 130:Src/LTC6811.c **** 	
 131:Src/LTC6811.c **** 	cmd[0] = (uint8_t) (0x80 | ((address << 3) & 0x78) | ((WriteConfigurationRegisterGroup >> 8) & 0x0
 132:Src/LTC6811.c **** 	cmd[1] = (uint8_t) (WriteConfigurationRegisterGroup & 0xFF);
 133:Src/LTC6811.c **** 	
 134:Src/LTC6811.c **** 	PEC_return = calculatePEC(2, cmd);
 135:Src/LTC6811.c **** 	
 136:Src/LTC6811.c **** 	cmd[2] = (PEC_return >> 8) & 0xFF;
 137:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 138:Src/LTC6811.c **** 
 139:Src/LTC6811.c **** 	cmd[4] = config[0];
 140:Src/LTC6811.c **** 	cmd[5] = config[1];
 141:Src/LTC6811.c **** 	cmd[6] = config[2];
 142:Src/LTC6811.c **** 	cmd[7] = config[3];
 143:Src/LTC6811.c **** 	cmd[8] = config[4];
 144:Src/LTC6811.c **** 	cmd[9] = config[5];
 145:Src/LTC6811.c **** 	
 146:Src/LTC6811.c **** 	PEC_return = calculatePEC(6, cmd + 4);
 147:Src/LTC6811.c **** 
 148:Src/LTC6811.c **** 	cmd[10] = (PEC_return >> 8) & 0xFF;
 149:Src/LTC6811.c **** 	cmd[11] = PEC_return & 0xFF;
 150:Src/LTC6811.c **** 	
 151:Src/LTC6811.c **** 	SPIWrite(cmd, cmd_len);
 152:Src/LTC6811.c **** 
 153:Src/LTC6811.c **** 	readConfig(address, dummy);
 154:Src/LTC6811.c **** 	
 155:Src/LTC6811.c **** 	free(cmd);
 156:Src/LTC6811.c **** 
 157:Src/LTC6811.c **** };
 158:Src/LTC6811.c **** 
 159:Src/LTC6811.c **** void writeConfigAll(BMSconfigStructTypedef cfg) {
 160:Src/LTC6811.c **** 
 161:Src/LTC6811.c **** 	for (uint8_t i = 0; i < cfg.numOfICs; i++) {
 162:Src/LTC6811.c **** 		writeConfigAddress(cfg, cfg.address[i]);
 163:Src/LTC6811.c **** 	}
 164:Src/LTC6811.c **** };
 165:Src/LTC6811.c **** 
 166:Src/LTC6811.c **** bool readCellVoltage(uint8_t address, uint16_t cellVoltage[12]) {
 167:Src/LTC6811.c **** 	
 168:Src/LTC6811.c **** 	bool PEC_check = false;
ARM GAS  /tmp/ccouNvQA.s 			page 6


 169:Src/LTC6811.c **** 	bool dataValid = true;
 170:Src/LTC6811.c **** 	uint16_t *voltage;
 171:Src/LTC6811.c **** 	
 172:Src/LTC6811.c **** 	voltage = (uint16_t *)malloc(12*sizeof(uint16_t));
 173:Src/LTC6811.c **** 	
 174:Src/LTC6811.c **** 	sendAddressCommand(StartCellVoltageADCConversionAll, address); // start conversion for every cell
 175:Src/LTC6811.c **** 
 176:Src/LTC6811.c **** 	HAL_Delay(15); // conversion time is 12.8ms at 422Hz, so wait 15ms
 177:Src/LTC6811.c **** 	
 178:Src/LTC6811.c **** 	PEC_check = readRegister(ReadCellVoltageRegisterGroup1to3, address, voltage);
 179:Src/LTC6811.c **** 	//dataValid = dataValid & PEC_check;
 180:Src/LTC6811.c **** 	PEC_check = readRegister(ReadCellVoltageRegisterGroup4to6, address, voltage);
 181:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 182:Src/LTC6811.c **** 	PEC_check = readRegister(ReadCellVoltageRegisterGroup7to9, address, voltage);
 183:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 184:Src/LTC6811.c **** 	PEC_check = readRegister(ReadCellVoltageRegisterGroup10to12, address, voltage);
 185:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 186:Src/LTC6811.c **** 	PEC_check = readRegister(ReadCellVoltageRegisterGroup1to3, address, voltage);
 187:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 188:Src/LTC6811.c **** 	
 189:Src/LTC6811.c **** 	for (uint8_t i = 0; i < 12; i++) {
 190:Src/LTC6811.c **** 		cellVoltage[i] = voltage[i];
 191:Src/LTC6811.c **** 	}
 192:Src/LTC6811.c **** 	
 193:Src/LTC6811.c **** 	free(voltage);
 194:Src/LTC6811.c **** 	
 195:Src/LTC6811.c **** 	return(dataValid);
 196:Src/LTC6811.c **** 	
 197:Src/LTC6811.c **** };
 198:Src/LTC6811.c **** 
 199:Src/LTC6811.c **** bool readAllCellVoltages(BMSconfigStructTypedef cfg, uint8_t bmsData[96][6]) {
 200:Src/LTC6811.c **** 
 201:Src/LTC6811.c **** 	uint16_t boardVoltage[cfg.numOfCellInputs];
 202:Src/LTC6811.c **** 	bool PEC_check[cfg.numOfICs];
 203:Src/LTC6811.c **** 	bool dataValid = true;
 204:Src/LTC6811.c **** 
 205:Src/LTC6811.c **** 	for (uint8_t board = 0; board < cfg.numOfICs; board++) {
 206:Src/LTC6811.c **** 
 207:Src/LTC6811.c **** 		//read voltage of every cell input (1-12) for a specific address, store in boardVoltage
 208:Src/LTC6811.c **** 		PEC_check[board] = readCellVoltage(cfg.address[board], boardVoltage);
 209:Src/LTC6811.c **** 
 210:Src/LTC6811.c **** 		//store cell number and valid data bit in bmsData
 211:Src/LTC6811.c **** 		for (uint8_t cell = 0; cell < cfg.numOfCellsPerIC; cell++) {
 212:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][0] = (uint8_t) ((board * cfg.numOfCellsPerIC) + ce
 213:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][1] = (uint8_t) (0x02 & (PEC_check[board] << 1)); /
 214:Src/LTC6811.c **** 		}
 215:Src/LTC6811.c **** 
 216:Src/LTC6811.c **** 		//store cell voltage in bmsData
 217:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 0][2] = (uint8_t) ((boardVoltage[0] >> 8) & 0xFF); //cell
 218:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 0][3] = (uint8_t) (boardVoltage[0] & 0xFF); //cell 1, vol
 219:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 1][2] = (uint8_t) ((boardVoltage[1] >> 8) & 0xFF); //cell
 220:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 1][3] = (uint8_t) (boardVoltage[1] & 0xFF); //cell 2, vol
 221:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 2][2] = (uint8_t) ((boardVoltage[2] >> 8) & 0xFF); //cell
 222:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 2][3] = (uint8_t) (boardVoltage[2] & 0xFF); //cell 3, vol
 223:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 3][2] = (uint8_t) ((boardVoltage[3] >> 8) & 0xFF); //cell
 224:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 3][3] = (uint8_t) (boardVoltage[3] & 0xFF); //cell 4, vol
 225:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 4][2] = (uint8_t) ((boardVoltage[6] >> 8) & 0xFF); //cell
ARM GAS  /tmp/ccouNvQA.s 			page 7


 226:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 4][3] = (uint8_t) (boardVoltage[6] & 0xFF); //cell 7, vol
 227:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 5][2] = (uint8_t) ((boardVoltage[7] >> 8) & 0xFF); //cell
 228:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 5][3] = (uint8_t) (boardVoltage[7] & 0xFF); //cell 8, vol
 229:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 6][2] = (uint8_t) ((boardVoltage[8] >> 8) & 0xFF); //cell
 230:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 6][3] = (uint8_t) (boardVoltage[8] & 0xFF); //cell 9, vol
 231:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 7][2] = (uint8_t) ((boardVoltage[9] >> 8) & 0xFF); //cell
 232:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 7][3] = (uint8_t) (boardVoltage[9] & 0xFF); //cell 10, vo
 233:Src/LTC6811.c **** 	
 234:Src/LTC6811.c **** 	}
 235:Src/LTC6811.c **** 
 236:Src/LTC6811.c **** 	for (uint8_t board = 0; board < cfg.numOfICs; board++) {
 237:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 238:Src/LTC6811.c **** 			dataValid = false;
 239:Src/LTC6811.c **** 	}
 240:Src/LTC6811.c **** 
 241:Src/LTC6811.c **** 	return dataValid; //return true if no PEC errors for any board 
 242:Src/LTC6811.c **** }
 243:Src/LTC6811.c **** 
 244:Src/LTC6811.c **** bool readCellTemp(uint8_t address, uint16_t cellTemp[4], bool dcFault[4], bool tempFault[4]) {
 245:Src/LTC6811.c **** 	
 246:Src/LTC6811.c **** 	bool PEC_check = false;
 247:Src/LTC6811.c **** 	bool dataValid = true;
 248:Src/LTC6811.c **** 	uint16_t *temp;
 249:Src/LTC6811.c **** 	double dummy[4];
 250:Src/LTC6811.c **** 	double conversion[4];
 251:Src/LTC6811.c **** 	
 252:Src/LTC6811.c **** 	temp = (uint16_t *)malloc(4*sizeof(uint16_t));
 253:Src/LTC6811.c **** 	
 254:Src/LTC6811.c **** 	sendAddressCommand(StartCellTempVoltageADCConversionAll, address);
 255:Src/LTC6811.c **** 	
 256:Src/LTC6811.c **** 	HAL_Delay(15); // conversion time is 12.8ms at 422Hz, so wait 15ms
 257:Src/LTC6811.c **** 	
 258:Src/LTC6811.c **** 	PEC_check = readRegister(ReadAuxiliaryGroupA, address, temp);
 259:Src/LTC6811.c **** 	//dataValid = dataValid & PEC_check;
 260:Src/LTC6811.c **** 	PEC_check = readRegister(ReadAuxiliaryGroupB, address, temp);
 261:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 262:Src/LTC6811.c **** 	PEC_check = readRegister(ReadAuxiliaryGroupA, address, temp);
 263:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 264:Src/LTC6811.c **** 	
 265:Src/LTC6811.c **** 	for (uint8_t i = 0; i < 4; i++) {
 266:Src/LTC6811.c **** 		if ((temp[i] > 24400) || (temp[i] < 13000)) {
 267:Src/LTC6811.c **** 			dcFault[i] = true;
 268:Src/LTC6811.c **** 			cellTemp[i] = 0x0000;
 269:Src/LTC6811.c **** 		}
 270:Src/LTC6811.c **** 		else
 271:Src/LTC6811.c **** 			dcFault[i] = false;
 272:Src/LTC6811.c **** 		
 273:Src/LTC6811.c **** 		if ((temp[i] >= 13000) && (temp[i] < 15100)) {
 274:Src/LTC6811.c **** 			tempFault[i] = true;
 275:Src/LTC6811.c **** 			cellTemp[i] = 0xFFFF;
 276:Src/LTC6811.c **** 		}
 277:Src/LTC6811.c **** 		else
 278:Src/LTC6811.c **** 			tempFault[i] = false;
 279:Src/LTC6811.c **** 		
 280:Src/LTC6811.c **** 		if ((temp[i] >= 15100) && (temp[i] <= 24400)) {
 281:Src/LTC6811.c **** 			dummy[i] = (double) temp[i] / 10000; // convert from ADC value to voltage
 282:Src/LTC6811.c **** 			// convert from voltage to temperature
ARM GAS  /tmp/ccouNvQA.s 			page 8


 283:Src/LTC6811.c **** 			conversion[i] = 37735 - 113923 * dummy[i] + 142663 * pow(dummy[i], 2) - 94465 * pow(dummy[i], 3)
 284:Src/LTC6811.c **** 			conversion[i] = 500 * (conversion[i] + 20); // map value to larger range
 285:Src/LTC6811.c **** 			cellTemp[i] = (uint16_t) conversion[i];
 286:Src/LTC6811.c **** 		}
 287:Src/LTC6811.c **** 	}
 288:Src/LTC6811.c **** 	
 289:Src/LTC6811.c **** 	free(temp);
 290:Src/LTC6811.c **** 	
 291:Src/LTC6811.c **** 	return (dataValid);
 292:Src/LTC6811.c **** 	
 293:Src/LTC6811.c **** };
 294:Src/LTC6811.c **** 
 295:Src/LTC6811.c **** bool readAllCellTemps(BMSconfigStructTypedef cfg, uint8_t bmsData[96][6]) {
 296:Src/LTC6811.c **** 
 297:Src/LTC6811.c **** 	uint16_t boardTemp[cfg.numOfTempPerIC];
 298:Src/LTC6811.c **** 	bool boardDCFault[cfg.numOfTempPerIC];
 299:Src/LTC6811.c **** 	bool boardTempFault[cfg.numOfTempPerIC];
 300:Src/LTC6811.c **** 	bool PEC_check[cfg.numOfICs];
 301:Src/LTC6811.c **** 	bool dataValid = true;
 302:Src/LTC6811.c **** 
 303:Src/LTC6811.c **** 	for (uint8_t board = 0; board < cfg.numOfICs; board++) {
 304:Src/LTC6811.c **** 
 305:Src/LTC6811.c **** 		//read temperature, check for OT and temp DC
 306:Src/LTC6811.c **** 		PEC_check[board] = readCellTemp(cfg.address[board], boardTemp, boardDCFault, boardTempFault);
 307:Src/LTC6811.c **** 
 308:Src/LTC6811.c **** 		//store OT and temp DC bits in status byte
 309:Src/LTC6811.c **** 		for (uint8_t cell = 0; cell < cfg.numOfCellsPerIC; cell++) {
 310:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][1] &= (PEC_check[board] << 1);
 311:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][1] |= (boardTempFault[cell / 2] << 4);
 312:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][1] |= (boardDCFault[cell / 2] >> 3);
 313:Src/LTC6811.c **** 		}
 314:Src/LTC6811.c **** 
 315:Src/LTC6811.c **** 		//store cell temperature in bmsData
 316:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 0][4] = (uint8_t) ((boardTemp[0] >> 8) & 0xFF); //temp1 H
 317:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 0][5] = (uint8_t) (boardTemp[0] & 0xFF); //temp1 L
 318:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 1][4] = (uint8_t) ((boardTemp[0] >> 8) & 0xFF); //temp1 H
 319:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 1][5] = (uint8_t) (boardTemp[0] & 0xFF); //temp1 L
 320:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 2][4] = (uint8_t) ((boardTemp[1] >> 8) & 0xFF); //temp2 H
 321:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 2][5] = (uint8_t) (boardTemp[1] & 0xFF); //temp2 L
 322:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 3][4] = (uint8_t) ((boardTemp[1] >> 8) & 0xFF); //temp2 H
 323:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 3][5] = (uint8_t) (boardTemp[1] & 0xFF); //temp2 L
 324:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 4][4] = (uint8_t) ((boardTemp[2] >> 8) & 0xFF); //temp3 H
 325:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 4][5] = (uint8_t) (boardTemp[2] & 0xFF); //temp3 L
 326:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 5][4] = (uint8_t) ((boardTemp[2] >> 8) & 0xFF); //temp3 H
 327:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 5][5] = (uint8_t) (boardTemp[2] & 0xFF); //temp3 L
 328:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 6][4] = (uint8_t) ((boardTemp[3] >> 8) & 0xFF); //temp4 H
 329:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 6][5] = (uint8_t) (boardTemp[3] & 0xFF); //temp4 L
 330:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 7][4] = (uint8_t) ((boardTemp[3] >> 8) & 0xFF); //temp4 H
 331:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 7][5] = (uint8_t) (boardTemp[3] & 0xFF); //temp4 L
 332:Src/LTC6811.c **** 	}
 333:Src/LTC6811.c **** 	
 334:Src/LTC6811.c **** 	for (uint8_t board = 0; board < cfg.numOfICs; board++) {
 335:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 336:Src/LTC6811.c **** 			dataValid = false;
 337:Src/LTC6811.c **** 	}
 338:Src/LTC6811.c **** 
 339:Src/LTC6811.c **** 	return dataValid;
ARM GAS  /tmp/ccouNvQA.s 			page 9


 340:Src/LTC6811.c **** }
 341:Src/LTC6811.c **** 
 342:Src/LTC6811.c **** bool readConfig(uint8_t address, uint8_t cfg[8]) {
 343:Src/LTC6811.c **** 	
 344:Src/LTC6811.c **** 	uint16_t *config;
 345:Src/LTC6811.c **** 	bool dataValid = false;
 346:Src/LTC6811.c **** 	
 347:Src/LTC6811.c **** 	config = (uint16_t *)malloc(4*sizeof(uint16_t));
 348:Src/LTC6811.c **** 	
 349:Src/LTC6811.c **** 	dataValid = readRegister(ReadConfigurationRegisterGroup, address, config);
 350:Src/LTC6811.c **** 	
 351:Src/LTC6811.c **** 	cfg[0] = (uint8_t) ((config[0] >> 8) & 0xFF);
 352:Src/LTC6811.c **** 	cfg[1] = (uint8_t) (config[0] & 0xFF);
 353:Src/LTC6811.c **** 	cfg[2] = (uint8_t) ((config[1] >> 8) & 0xFF);
 354:Src/LTC6811.c **** 	cfg[3] = (uint8_t) (config[1] & 0xFF);
 355:Src/LTC6811.c **** 	cfg[4] = (uint8_t) ((config[2] >> 8) & 0xFF);
 356:Src/LTC6811.c **** 	cfg[5] = (uint8_t) (config[2] & 0xFF);
 357:Src/LTC6811.c **** 	cfg[6] = (uint8_t) ((config[3] >> 8) & 0xFF);
 358:Src/LTC6811.c **** 	cfg[7] = (uint8_t) (config[3] & 0xFF);
 359:Src/LTC6811.c **** 	
 360:Src/LTC6811.c **** 	return dataValid;
 361:Src/LTC6811.c **** }
 362:Src/LTC6811.c **** 
 363:Src/LTC6811.c **** /*bool checkCellConnection(uint8_t address, uint16_t cellVoltage[12], bool cellConnection[12]) {
 364:Src/LTC6811.c **** 		
 365:Src/LTC6811.c **** 
 366:Src/LTC6811.c **** 	
 367:Src/LTC6811.c **** 	for (uint8_t i = 0; i < 12; i++) {
 368:Src/LTC6811.c **** 		// if voltage fell by > 100mV
 369:Src/LTC6811.c **** 		if ((cellVoltage[i] - ADOWvoltage[i]) > 1000) {
 370:Src/LTC6811.c **** 			cellConnection[i] = 0; // cell is disconnected
 371:Src/LTC6811.c **** 			disconnect = true;
 372:Src/LTC6811.c **** 		}
 373:Src/LTC6811.c **** 		else {
 374:Src/LTC6811.c **** 			cellConnection[i] = 1;
 375:Src/LTC6811.c **** 		}
 376:Src/LTC6811.c **** 	}
 377:Src/LTC6811.c **** 	return disconnect;
 378:Src/LTC6811.c **** }*/
 379:Src/LTC6811.c **** 
 380:Src/LTC6811.c **** bool checkAllCellConnections(BMSconfigStructTypedef cfg, uint8_t bmsData[96][6]) {
 381:Src/LTC6811.c **** 	
 382:Src/LTC6811.c **** 	uint16_t ADOWvoltage[cfg.numOfCellInputs];
 383:Src/LTC6811.c **** 	uint16_t cellVoltage;
 384:Src/LTC6811.c **** 	bool disconnect = false;
 385:Src/LTC6811.c **** 
 386:Src/LTC6811.c **** 	//at least 2
 387:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 388:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 389:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 390:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 391:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 392:Src/LTC6811.c **** 
 393:Src/LTC6811.c **** 	HAL_Delay(15);
 394:Src/LTC6811.c **** 
 395:Src/LTC6811.c **** 	for (uint8_t board = 0; board < cfg.numOfICs; board++) {
 396:Src/LTC6811.c **** 
ARM GAS  /tmp/ccouNvQA.s 			page 10


 397:Src/LTC6811.c **** 		readCellVoltage(cfg.address[board], ADOWvoltage);
 398:Src/LTC6811.c **** 
 399:Src/LTC6811.c **** 		for (uint8_t cell = 0; cell < cfg.numOfCellsPerIC; cell++) {
 400:Src/LTC6811.c **** 
 401:Src/LTC6811.c **** 			cellVoltage = 0;
 402:Src/LTC6811.c **** 			cellVoltage = (uint16_t) (bmsData[(board * cfg.numOfCellsPerIC) + cell][2]);
 403:Src/LTC6811.c **** 			cellVoltage = cellVoltage << 8;
 404:Src/LTC6811.c **** 			cellVoltage += (uint16_t) (bmsData[(board * cfg.numOfCellsPerIC) + cell][3]);
 405:Src/LTC6811.c **** 
 406:Src/LTC6811.c **** 			if ((cellVoltage - ADOWvoltage[cell]) > 1000)
 407:Src/LTC6811.c **** 				bmsData[(board * cfg.numOfCellsPerIC) + cell][1] &= 0xFE;
 408:Src/LTC6811.c **** 			else
 409:Src/LTC6811.c **** 				bmsData[(board * cfg.numOfCellsPerIC) + cell][1] |= 0x01;
 410:Src/LTC6811.c **** 		}
 411:Src/LTC6811.c **** 	}
 412:Src/LTC6811.c **** 
 413:Src/LTC6811.c **** 	return 0;
 414:Src/LTC6811.c **** }
 415:Src/LTC6811.c **** 
 416:Src/LTC6811.c **** bool dischargeCellGroups(BMSconfigStructTypedef config, bool cellDischarge[12][8]) {
 417:Src/LTC6811.c **** 	
 418:Src/LTC6811.c **** 	BMSconfigStructTypedef *cfg;
 419:Src/LTC6811.c **** 
 420:Src/LTC6811.c **** 	cfg = &config;
 421:Src/LTC6811.c **** 
 422:Src/LTC6811.c **** 	for (uint8_t i = 0; i < config.numOfICs; i++) {
 423:Src/LTC6811.c **** 
 424:Src/LTC6811.c **** 		cfg->DischargeCell1 = cellDischarge[i][0];
 425:Src/LTC6811.c **** 		cfg->DischargeCell2 = cellDischarge[i][1];
 426:Src/LTC6811.c **** 		cfg->DischargeCell3 = cellDischarge[i][2];
 427:Src/LTC6811.c **** 		cfg->DischargeCell4 = cellDischarge[i][3];
 428:Src/LTC6811.c **** 		cfg->DischargeCell7 = cellDischarge[i][4];
 429:Src/LTC6811.c **** 		cfg->DischargeCell8 = cellDischarge[i][5];
 430:Src/LTC6811.c **** 		cfg->DischargeCell9 = cellDischarge[i][6];
 431:Src/LTC6811.c **** 		cfg->DischargeCell10 = cellDischarge[i][7];
 432:Src/LTC6811.c **** 
 433:Src/LTC6811.c **** 		writeConfigAddress(config, config.address[i]);
 434:Src/LTC6811.c **** 
 435:Src/LTC6811.c **** 	}
 436:Src/LTC6811.c **** 
 437:Src/LTC6811.c **** 	cfg->DischargeCell1 = 0;
 438:Src/LTC6811.c **** 	cfg->DischargeCell2 = 0;
 439:Src/LTC6811.c **** 	cfg->DischargeCell3 = 0;
 440:Src/LTC6811.c **** 	cfg->DischargeCell4 = 0;
 441:Src/LTC6811.c **** 	cfg->DischargeCell7 = 0;
 442:Src/LTC6811.c **** 	cfg->DischargeCell8 = 0;
 443:Src/LTC6811.c **** 	cfg->DischargeCell9 = 0;
 444:Src/LTC6811.c **** 	cfg->DischargeCell10 = 0;
 445:Src/LTC6811.c **** 
 446:Src/LTC6811.c **** 	return 0;
 447:Src/LTC6811.c **** 	
 448:Src/LTC6811.c **** }
 449:Src/LTC6811.c **** 
 450:Src/LTC6811.c **** /*bool dischargeCell(BMSconfigStructTypedef config, bool cellDischarge[8]) {
 451:Src/LTC6811.c **** 	
 452:Src/LTC6811.c **** 	BMSconfigStructTypedef *cfg;
 453:Src/LTC6811.c **** 	cfg = &config;
ARM GAS  /tmp/ccouNvQA.s 			page 11


 454:Src/LTC6811.c **** 	
 455:Src/LTC6811.c **** 	cfg->DischargeCell1 = cellDischarge[0];
 456:Src/LTC6811.c **** 	cfg->DischargeCell2 = cellDischarge[1];
 457:Src/LTC6811.c **** 	cfg->DischargeCell3 = cellDischarge[2];
 458:Src/LTC6811.c **** 	cfg->DischargeCell4 = cellDischarge[3];
 459:Src/LTC6811.c **** 	cfg->DischargeCell7 = cellDischarge[4];
 460:Src/LTC6811.c **** 	cfg->DischargeCell8 = cellDischarge[5];
 461:Src/LTC6811.c **** 	cfg->DischargeCell9 = cellDischarge[6];
 462:Src/LTC6811.c **** 	cfg->DischargeCell10 = cellDischarge[7];
 463:Src/LTC6811.c **** 	
 464:Src/LTC6811.c **** 	writeConfig(config, 0, 1);
 465:Src/LTC6811.c **** 	
 466:Src/LTC6811.c **** 	return 0;
 467:Src/LTC6811.c **** 	
 468:Src/LTC6811.c **** }*/
 469:Src/LTC6811.c **** 
 470:Src/LTC6811.c **** bool readRegister(CommandCodeTypedef command, uint8_t address, uint16_t *data) {
 471:Src/LTC6811.c **** 	
 472:Src/LTC6811.c **** 	uint8_t cmd[12];
 473:Src/LTC6811.c **** 	uint8_t rx_data[12];
 474:Src/LTC6811.c **** 	uint16_t PEC_return;
 475:Src/LTC6811.c **** 	uint8_t *PEC_send;
 476:Src/LTC6811.c **** 	bool dataValid = true;
 477:Src/LTC6811.c **** 
 478:Src/LTC6811.c **** 	PEC_send = (uint8_t *)malloc(6*sizeof(uint8_t));
 479:Src/LTC6811.c **** 	
 480:Src/LTC6811.c **** 	PEC_send[0] = (uint8_t) (0x80 | ((address << 3) & 0x78) | ((command >> 8) & 0x07));
 481:Src/LTC6811.c **** 	PEC_send[1] = (uint8_t) (command & 0xFF);
 482:Src/LTC6811.c **** 
 483:Src/LTC6811.c **** 	cmd[0] = PEC_send[0];
 484:Src/LTC6811.c **** 	cmd[1] = PEC_send[1];
 485:Src/LTC6811.c **** 	
 486:Src/LTC6811.c **** 	PEC_return = calculatePEC(2, PEC_send);
 487:Src/LTC6811.c **** 	
 488:Src/LTC6811.c **** 	cmd[2] = (PEC_return >> 8) & 0xFF;
 489:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 490:Src/LTC6811.c **** 	
 491:Src/LTC6811.c **** 	cmd[4] = 0;
 492:Src/LTC6811.c **** 	cmd[5] = 0;
 493:Src/LTC6811.c **** 	cmd[6] = 0;
 494:Src/LTC6811.c **** 	cmd[7] = 0;
 495:Src/LTC6811.c **** 	cmd[8] = 0;
 496:Src/LTC6811.c **** 	cmd[9] = 0;
 497:Src/LTC6811.c **** 	cmd[10] = 0;
 498:Src/LTC6811.c **** 	cmd[11] = 0;
 499:Src/LTC6811.c **** 	
 500:Src/LTC6811.c **** 	SPIWriteRead(cmd, rx_data, sizeof(cmd)); // send 4 command bytes, receive 6 cell voltage bytes (4-
 501:Src/LTC6811.c **** 	
 502:Src/LTC6811.c **** 	// calculate PEC based on cell voltage data received
 503:Src/LTC6811.c **** 	PEC_send[0] = rx_data[4]; // cell 1 voltage low bytes
 504:Src/LTC6811.c **** 	PEC_send[1] = rx_data[5]; // cell 1 voltage high bytes
 505:Src/LTC6811.c **** 	PEC_send[2] = rx_data[6]; // cell 2 voltage low bytes
 506:Src/LTC6811.c **** 	PEC_send[3] = rx_data[7]; // cell 2 voltage high bytes
 507:Src/LTC6811.c **** 	PEC_send[4] = rx_data[8]; // cell 3 voltage low bytes
 508:Src/LTC6811.c **** 	PEC_send[5] = rx_data[9]; // cell 3 voltage high bytes
 509:Src/LTC6811.c **** 	
 510:Src/LTC6811.c **** 	PEC_return = calculatePEC(6, PEC_send);
ARM GAS  /tmp/ccouNvQA.s 			page 12


 511:Src/LTC6811.c **** 	
 512:Src/LTC6811.c **** 	// check if received PEC matches calculated PEC
 513:Src/LTC6811.c **** 	if (PEC_return != (((rx_data[10] << 8) & 0xFF00) | (rx_data[11] & 0x00FF))) {
 514:Src/LTC6811.c **** 		dataValid = false;
 515:Src/LTC6811.c **** 	}
 516:Src/LTC6811.c **** 	
 517:Src/LTC6811.c **** 	if (command == ReadCellVoltageRegisterGroup1to3) {
 518:Src/LTC6811.c **** 		
 519:Src/LTC6811.c **** 		data[0] = (uint16_t) ((rx_data[5] << 8) & 0xFF00) | (rx_data[4] & 0x00FF);
 520:Src/LTC6811.c **** 		data[1] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 521:Src/LTC6811.c **** 		data[2] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 522:Src/LTC6811.c **** 		//data[3] = (uint16_t) ((rx_data[10] << 8) & 0xFF00) | (rx_data[11] & 0x00FF);
 523:Src/LTC6811.c **** 		//data[4] = PEC_return;
 524:Src/LTC6811.c **** 	}
 525:Src/LTC6811.c **** 
 526:Src/LTC6811.c **** 	if (command == ReadCellVoltageRegisterGroup4to6) {
 527:Src/LTC6811.c **** 		
 528:Src/LTC6811.c **** 		data[3] = (uint16_t) ((rx_data[5] << 8) & 0xFF00) | (rx_data[4] & 0x00FF);
 529:Src/LTC6811.c **** 		data[4] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 530:Src/LTC6811.c **** 		data[5] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 531:Src/LTC6811.c **** 	}
 532:Src/LTC6811.c **** 	
 533:Src/LTC6811.c **** 	if (command == ReadCellVoltageRegisterGroup7to9) {
 534:Src/LTC6811.c **** 		
 535:Src/LTC6811.c **** 		data[6] = (uint16_t) ((rx_data[5] << 8) & 0xFF00) | (rx_data[4] & 0x00FF);
 536:Src/LTC6811.c **** 		data[7] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 537:Src/LTC6811.c **** 		data[8] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 538:Src/LTC6811.c **** 	}
 539:Src/LTC6811.c **** 	
 540:Src/LTC6811.c **** 	if (command == ReadCellVoltageRegisterGroup10to12) {
 541:Src/LTC6811.c **** 		
 542:Src/LTC6811.c **** 		data[9] = (uint16_t) ((rx_data[5] << 8) & 0xFF00) | (rx_data[4] & 0x00FF);
 543:Src/LTC6811.c **** 		data[10] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 544:Src/LTC6811.c **** 		data[11] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 545:Src/LTC6811.c **** 	}
 546:Src/LTC6811.c **** 	
 547:Src/LTC6811.c **** 	if (command == ReadAuxiliaryGroupA) {
 548:Src/LTC6811.c **** 		
 549:Src/LTC6811.c **** 		data[0] = (uint16_t) ((rx_data[5] << 8) & 0xFF00) | (rx_data[4] & 0x00FF);
 550:Src/LTC6811.c **** 		data[1] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 551:Src/LTC6811.c **** 		data[2] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 552:Src/LTC6811.c **** 	}
 553:Src/LTC6811.c **** 	
 554:Src/LTC6811.c **** 	if (command == ReadAuxiliaryGroupB) {
 555:Src/LTC6811.c **** 		data[3] = (uint16_t) ((rx_data[5] << 8) & 0xFF00) | (rx_data[4] & 0x00FF);
 556:Src/LTC6811.c **** 	}
 557:Src/LTC6811.c **** 	
 558:Src/LTC6811.c **** 	if (command == ReadConfigurationRegisterGroup) {
 559:Src/LTC6811.c **** 		data[0] = (uint16_t) ((rx_data[4] << 8) & 0xFF00) | (rx_data[5] & 0x00FF);
 560:Src/LTC6811.c **** 		data[1] = (uint16_t) ((rx_data[6] << 8) & 0xFF00) | (rx_data[7] & 0x00FF);
 561:Src/LTC6811.c **** 		data[2] = (uint16_t) ((rx_data[8] << 8) & 0xFF00) | (rx_data[9] & 0x00FF);
 562:Src/LTC6811.c **** 		data[3] = (uint16_t) ((rx_data[10] << 8) & 0xFF00) | (rx_data[11] & 0x00FF);
 563:Src/LTC6811.c **** 	}
 564:Src/LTC6811.c **** 	
 565:Src/LTC6811.c **** 	return(dataValid);
 566:Src/LTC6811.c **** 	
 567:Src/LTC6811.c **** };
ARM GAS  /tmp/ccouNvQA.s 			page 13


 568:Src/LTC6811.c **** 
 569:Src/LTC6811.c **** void sendBroadcastCommand(CommandCodeTypedef command) {
 570:Src/LTC6811.c **** 	
 571:Src/LTC6811.c **** 	uint8_t cmd[4];
 572:Src/LTC6811.c **** 	uint16_t PEC_return;
 573:Src/LTC6811.c **** 	
 574:Src/LTC6811.c **** 	cmd[0] = (uint8_t) ((command >> 8) & 0x0F);
 575:Src/LTC6811.c **** 	cmd[1] = (uint8_t) (command & 0xFF);
 576:Src/LTC6811.c **** 	
 577:Src/LTC6811.c **** 	PEC_return = calculatePEC(2, (uint8_t *)&(cmd));
 578:Src/LTC6811.c **** 	
 579:Src/LTC6811.c **** 	cmd[2] = (PEC_return >> 8) & 0xFF;
 580:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 581:Src/LTC6811.c **** 	
 582:Src/LTC6811.c **** 	SPIWrite(cmd, 4);
 583:Src/LTC6811.c **** };
 584:Src/LTC6811.c **** 
 585:Src/LTC6811.c **** void sendAddressCommand(CommandCodeTypedef command, uint8_t address) {
 586:Src/LTC6811.c **** 	
 587:Src/LTC6811.c **** 	uint8_t cmd[4];
 588:Src/LTC6811.c **** 	uint16_t PEC_return;
 589:Src/LTC6811.c **** 	uint8_t *msbytes;
 590:Src/LTC6811.c **** 	
 591:Src/LTC6811.c **** 	msbytes = (uint8_t *)malloc(2*sizeof(uint8_t));
 592:Src/LTC6811.c **** 	
 593:Src/LTC6811.c **** 	msbytes[0] = (uint8_t) (0x80 | ((address << 3) & 0x78) | ((command >> 8) & 0x07));
 594:Src/LTC6811.c **** 	msbytes[1] = (uint8_t) (command & 0xFF);
 595:Src/LTC6811.c **** 
 596:Src/LTC6811.c **** 	cmd[0] = msbytes[0];
 597:Src/LTC6811.c **** 	cmd[1] = msbytes[1];
 598:Src/LTC6811.c **** 	
 599:Src/LTC6811.c **** 	PEC_return = calculatePEC(2, msbytes);
 600:Src/LTC6811.c **** 	
 601:Src/LTC6811.c **** 	cmd[2] = (PEC_return >> 8) & 0xFF;
 602:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 603:Src/LTC6811.c **** 	
 604:Src/LTC6811.c **** 	SPIWrite(cmd, 4);
 605:Src/LTC6811.c **** 	
 606:Src/LTC6811.c **** 	free(msbytes);
 607:Src/LTC6811.c **** };
 608:Src/LTC6811.c **** 
 609:Src/LTC6811.c **** uint16_t calculatePEC(uint8_t len, uint8_t *data) {
 112              		.loc 1 609 0
 113              		.cfi_startproc
 114              		@ args = 0, pretend = 0, frame = 0
 115              		@ frame_needed = 0, uses_anonymous_args = 0
 116              		@ link register save eliminated.
 117              	.LVL12:
 118 0000 30B4     		push	{r4, r5}
 119              	.LCFI0:
 120              		.cfi_def_cfa_offset 8
 121              		.cfi_offset 4, -8
 122              		.cfi_offset 5, -4
 123              	.LVL13:
 124              	.LBB5:
 610:Src/LTC6811.c **** 	
 611:Src/LTC6811.c **** 	uint16_t remainder, address;
ARM GAS  /tmp/ccouNvQA.s 			page 14


 612:Src/LTC6811.c **** 	remainder = 16; //PEC seed
 613:Src/LTC6811.c **** 	
 614:Src/LTC6811.c **** 	for (int i = 0; i < len; i++) {
 125              		.loc 1 614 0
 126 0002 0024     		movs	r4, #0
 127              	.LBE5:
 612:Src/LTC6811.c **** 	
 128              		.loc 1 612 0
 129 0004 1023     		movs	r3, #16
 130              	.LBB6:
 131              		.loc 1 614 0
 132 0006 0AE0     		b	.L13
 133              	.LVL14:
 134              	.L14:
 615:Src/LTC6811.c **** 		address = ((remainder >> 7) ^ data[i]) & 0xFF; //calculate PEC table address
 135              		.loc 1 615 0 discriminator 3
 136 0008 0A5D     		ldrb	r2, [r1, r4]	@ zero_extendqisi2
 137 000a 82EAD312 		eor	r2, r2, r3, lsr #7
 138 000e D2B2     		uxtb	r2, r2
 139              	.LVL15:
 616:Src/LTC6811.c **** 		remainder = (remainder << 8) ^ pec15Table[address];
 140              		.loc 1 616 0 discriminator 3
 141 0010 064D     		ldr	r5, .L16
 142 0012 35F91220 		ldrsh	r2, [r5, r2, lsl #1]
 143              	.LVL16:
 144 0016 82EA0323 		eor	r3, r2, r3, lsl #8
 145              	.LVL17:
 146 001a 9BB2     		uxth	r3, r3
 147              	.LVL18:
 614:Src/LTC6811.c **** 		address = ((remainder >> 7) ^ data[i]) & 0xFF; //calculate PEC table address
 148              		.loc 1 614 0 discriminator 3
 149 001c 0134     		adds	r4, r4, #1
 150              	.LVL19:
 151              	.L13:
 614:Src/LTC6811.c **** 		address = ((remainder >> 7) ^ data[i]) & 0xFF; //calculate PEC table address
 152              		.loc 1 614 0 is_stmt 0 discriminator 1
 153 001e A042     		cmp	r0, r4
 154 0020 F2DC     		bgt	.L14
 155              	.LBE6:
 617:Src/LTC6811.c **** 	}
 618:Src/LTC6811.c **** 	
 619:Src/LTC6811.c **** 	return (remainder * 2); //The CRC15 has a 0 in the LSB so the final value must be multiplied by 2
 156              		.loc 1 619 0 is_stmt 1
 157 0022 5800     		lsls	r0, r3, #1
 158              	.LVL20:
 159 0024 80B2     		uxth	r0, r0
 620:Src/LTC6811.c **** };
 160              		.loc 1 620 0
 161 0026 30BC     		pop	{r4, r5}
 162              	.LCFI1:
 163              		.cfi_restore 5
 164              		.cfi_restore 4
 165              		.cfi_def_cfa_offset 0
 166              	.LVL21:
 167 0028 7047     		bx	lr
 168              	.L17:
 169 002a 00BF     		.align	2
ARM GAS  /tmp/ccouNvQA.s 			page 15


 170              	.L16:
 171 002c 00000000 		.word	pec15Table
 172              		.cfi_endproc
 173              	.LFE79:
 175              		.section	.text.readRegister,"ax",%progbits
 176              		.align	1
 177              		.global	readRegister
 178              		.syntax unified
 179              		.thumb
 180              		.thumb_func
 181              		.fpu softvfp
 183              	readRegister:
 184              	.LFB76:
 470:Src/LTC6811.c **** 	
 185              		.loc 1 470 0
 186              		.cfi_startproc
 187              		@ args = 0, pretend = 0, frame = 24
 188              		@ frame_needed = 0, uses_anonymous_args = 0
 189              	.LVL22:
 190 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 191              	.LCFI2:
 192              		.cfi_def_cfa_offset 20
 193              		.cfi_offset 4, -20
 194              		.cfi_offset 5, -16
 195              		.cfi_offset 6, -12
 196              		.cfi_offset 7, -8
 197              		.cfi_offset 14, -4
 198 0002 87B0     		sub	sp, sp, #28
 199              	.LCFI3:
 200              		.cfi_def_cfa_offset 48
 201 0004 0646     		mov	r6, r0
 202 0006 0C46     		mov	r4, r1
 203 0008 1746     		mov	r7, r2
 204              	.LVL23:
 478:Src/LTC6811.c **** 	
 205              		.loc 1 478 0
 206 000a 0620     		movs	r0, #6
 207              	.LVL24:
 208 000c FFF7FEFF 		bl	malloc
 209              	.LVL25:
 210 0010 0546     		mov	r5, r0
 211              	.LVL26:
 480:Src/LTC6811.c **** 	PEC_send[1] = (uint8_t) (command & 0xFF);
 212              		.loc 1 480 0
 213 0012 E300     		lsls	r3, r4, #3
 214 0014 03F07803 		and	r3, r3, #120
 215 0018 63F07F03 		orn	r3, r3, #127
 216 001c C6F30224 		ubfx	r4, r6, #8, #3
 217 0020 2343     		orrs	r3, r3, r4
 218 0022 DBB2     		uxtb	r3, r3
 219 0024 0370     		strb	r3, [r0]
 481:Src/LTC6811.c **** 
 220              		.loc 1 481 0
 221 0026 F2B2     		uxtb	r2, r6
 222 0028 4270     		strb	r2, [r0, #1]
 483:Src/LTC6811.c **** 	cmd[1] = PEC_send[1];
 223              		.loc 1 483 0
ARM GAS  /tmp/ccouNvQA.s 			page 16


 224 002a 8DF80C30 		strb	r3, [sp, #12]
 484:Src/LTC6811.c **** 	
 225              		.loc 1 484 0
 226 002e 8DF80D20 		strb	r2, [sp, #13]
 486:Src/LTC6811.c **** 	
 227              		.loc 1 486 0
 228 0032 0146     		mov	r1, r0
 229 0034 0220     		movs	r0, #2
 230              	.LVL27:
 231 0036 FFF7FEFF 		bl	calculatePEC
 232              	.LVL28:
 488:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 233              		.loc 1 488 0
 234 003a 030A     		lsrs	r3, r0, #8
 235 003c 8DF80E30 		strb	r3, [sp, #14]
 489:Src/LTC6811.c **** 	
 236              		.loc 1 489 0
 237 0040 8DF80F00 		strb	r0, [sp, #15]
 491:Src/LTC6811.c **** 	cmd[5] = 0;
 238              		.loc 1 491 0
 239 0044 0023     		movs	r3, #0
 240 0046 8DF81030 		strb	r3, [sp, #16]
 492:Src/LTC6811.c **** 	cmd[6] = 0;
 241              		.loc 1 492 0
 242 004a 8DF81130 		strb	r3, [sp, #17]
 493:Src/LTC6811.c **** 	cmd[7] = 0;
 243              		.loc 1 493 0
 244 004e 8DF81230 		strb	r3, [sp, #18]
 494:Src/LTC6811.c **** 	cmd[8] = 0;
 245              		.loc 1 494 0
 246 0052 8DF81330 		strb	r3, [sp, #19]
 495:Src/LTC6811.c **** 	cmd[9] = 0;
 247              		.loc 1 495 0
 248 0056 8DF81430 		strb	r3, [sp, #20]
 496:Src/LTC6811.c **** 	cmd[10] = 0;
 249              		.loc 1 496 0
 250 005a 8DF81530 		strb	r3, [sp, #21]
 497:Src/LTC6811.c **** 	cmd[11] = 0;
 251              		.loc 1 497 0
 252 005e 8DF81630 		strb	r3, [sp, #22]
 498:Src/LTC6811.c **** 	
 253              		.loc 1 498 0
 254 0062 8DF81730 		strb	r3, [sp, #23]
 500:Src/LTC6811.c **** 	
 255              		.loc 1 500 0
 256 0066 0C22     		movs	r2, #12
 257 0068 6946     		mov	r1, sp
 258 006a 0DEB0200 		add	r0, sp, r2
 259              	.LVL29:
 260 006e FFF7FEFF 		bl	SPIWriteRead
 261              	.LVL30:
 503:Src/LTC6811.c **** 	PEC_send[1] = rx_data[5]; // cell 1 voltage high bytes
 262              		.loc 1 503 0
 263 0072 9DF80430 		ldrb	r3, [sp, #4]	@ zero_extendqisi2
 264 0076 2B70     		strb	r3, [r5]
 504:Src/LTC6811.c **** 	PEC_send[2] = rx_data[6]; // cell 2 voltage low bytes
 265              		.loc 1 504 0
ARM GAS  /tmp/ccouNvQA.s 			page 17


 266 0078 9DF80530 		ldrb	r3, [sp, #5]	@ zero_extendqisi2
 267 007c 6B70     		strb	r3, [r5, #1]
 505:Src/LTC6811.c **** 	PEC_send[3] = rx_data[7]; // cell 2 voltage high bytes
 268              		.loc 1 505 0
 269 007e 9DF80630 		ldrb	r3, [sp, #6]	@ zero_extendqisi2
 270 0082 AB70     		strb	r3, [r5, #2]
 506:Src/LTC6811.c **** 	PEC_send[4] = rx_data[8]; // cell 3 voltage low bytes
 271              		.loc 1 506 0
 272 0084 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 273 0088 EB70     		strb	r3, [r5, #3]
 507:Src/LTC6811.c **** 	PEC_send[5] = rx_data[9]; // cell 3 voltage high bytes
 274              		.loc 1 507 0
 275 008a 9DF80830 		ldrb	r3, [sp, #8]	@ zero_extendqisi2
 276 008e 2B71     		strb	r3, [r5, #4]
 508:Src/LTC6811.c **** 	
 277              		.loc 1 508 0
 278 0090 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 279 0094 6B71     		strb	r3, [r5, #5]
 510:Src/LTC6811.c **** 	
 280              		.loc 1 510 0
 281 0096 2946     		mov	r1, r5
 282 0098 0620     		movs	r0, #6
 283 009a FFF7FEFF 		bl	calculatePEC
 284              	.LVL31:
 513:Src/LTC6811.c **** 		dataValid = false;
 285              		.loc 1 513 0
 286 009e 9DF80A20 		ldrb	r2, [sp, #10]	@ zero_extendqisi2
 287 00a2 9DF80B30 		ldrb	r3, [sp, #11]	@ zero_extendqisi2
 288 00a6 43EA0223 		orr	r3, r3, r2, lsl #8
 289 00aa 9842     		cmp	r0, r3
 290 00ac 12D0     		beq	.L29
 514:Src/LTC6811.c **** 	}
 291              		.loc 1 514 0
 292 00ae 0020     		movs	r0, #0
 293              	.LVL32:
 294              	.L19:
 517:Src/LTC6811.c **** 		
 295              		.loc 1 517 0
 296 00b0 042E     		cmp	r6, #4
 297 00b2 11D0     		beq	.L30
 298              	.L20:
 526:Src/LTC6811.c **** 		
 299              		.loc 1 526 0
 300 00b4 062E     		cmp	r6, #6
 301 00b6 28D0     		beq	.L31
 302              	.L21:
 533:Src/LTC6811.c **** 		
 303              		.loc 1 533 0
 304 00b8 082E     		cmp	r6, #8
 305 00ba 3FD0     		beq	.L32
 306              	.L22:
 540:Src/LTC6811.c **** 		
 307              		.loc 1 540 0
 308 00bc 0A2E     		cmp	r6, #10
 309 00be 56D0     		beq	.L33
 310              	.L23:
 547:Src/LTC6811.c **** 		
ARM GAS  /tmp/ccouNvQA.s 			page 18


 311              		.loc 1 547 0
 312 00c0 0C2E     		cmp	r6, #12
 313 00c2 6DD0     		beq	.L34
 314              	.L24:
 554:Src/LTC6811.c **** 		data[3] = (uint16_t) ((rx_data[5] << 8) & 0xFF00) | (rx_data[4] & 0x00FF);
 315              		.loc 1 554 0
 316 00c4 0E2E     		cmp	r6, #14
 317 00c6 00F08480 		beq	.L35
 318              	.L25:
 558:Src/LTC6811.c **** 		data[0] = (uint16_t) ((rx_data[4] << 8) & 0xFF00) | (rx_data[5] & 0x00FF);
 319              		.loc 1 558 0
 320 00ca 022E     		cmp	r6, #2
 321 00cc 00F08A80 		beq	.L36
 322              	.L26:
 567:Src/LTC6811.c **** 
 323              		.loc 1 567 0
 324 00d0 07B0     		add	sp, sp, #28
 325              	.LCFI4:
 326              		.cfi_remember_state
 327              		.cfi_def_cfa_offset 20
 328              		@ sp needed
 329 00d2 F0BD     		pop	{r4, r5, r6, r7, pc}
 330              	.LVL33:
 331              	.L29:
 332              	.LCFI5:
 333              		.cfi_restore_state
 476:Src/LTC6811.c **** 
 334              		.loc 1 476 0
 335 00d4 0120     		movs	r0, #1
 336              	.LVL34:
 337 00d6 EBE7     		b	.L19
 338              	.LVL35:
 339              	.L30:
 519:Src/LTC6811.c **** 		data[1] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 340              		.loc 1 519 0
 341 00d8 9DF80530 		ldrb	r3, [sp, #5]	@ zero_extendqisi2
 342 00dc 1B02     		lsls	r3, r3, #8
 343 00de 1BB2     		sxth	r3, r3
 344 00e0 9DF80420 		ldrb	r2, [sp, #4]	@ zero_extendqisi2
 345 00e4 1343     		orrs	r3, r3, r2
 346 00e6 3B80     		strh	r3, [r7]	@ movhi
 520:Src/LTC6811.c **** 		data[2] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 347              		.loc 1 520 0
 348 00e8 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 349 00ec 1B02     		lsls	r3, r3, #8
 350 00ee 1BB2     		sxth	r3, r3
 351 00f0 9DF80620 		ldrb	r2, [sp, #6]	@ zero_extendqisi2
 352 00f4 1343     		orrs	r3, r3, r2
 353 00f6 7B80     		strh	r3, [r7, #2]	@ movhi
 521:Src/LTC6811.c **** 		//data[3] = (uint16_t) ((rx_data[10] << 8) & 0xFF00) | (rx_data[11] & 0x00FF);
 354              		.loc 1 521 0
 355 00f8 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 356 00fc 1B02     		lsls	r3, r3, #8
 357 00fe 1BB2     		sxth	r3, r3
 358 0100 9DF80820 		ldrb	r2, [sp, #8]	@ zero_extendqisi2
 359 0104 1343     		orrs	r3, r3, r2
 360 0106 BB80     		strh	r3, [r7, #4]	@ movhi
ARM GAS  /tmp/ccouNvQA.s 			page 19


 361 0108 D4E7     		b	.L20
 362              	.L31:
 528:Src/LTC6811.c **** 		data[4] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 363              		.loc 1 528 0
 364 010a 9DF80530 		ldrb	r3, [sp, #5]	@ zero_extendqisi2
 365 010e 1B02     		lsls	r3, r3, #8
 366 0110 1BB2     		sxth	r3, r3
 367 0112 9DF80420 		ldrb	r2, [sp, #4]	@ zero_extendqisi2
 368 0116 1343     		orrs	r3, r3, r2
 369 0118 FB80     		strh	r3, [r7, #6]	@ movhi
 529:Src/LTC6811.c **** 		data[5] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 370              		.loc 1 529 0
 371 011a 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 372 011e 1B02     		lsls	r3, r3, #8
 373 0120 1BB2     		sxth	r3, r3
 374 0122 9DF80620 		ldrb	r2, [sp, #6]	@ zero_extendqisi2
 375 0126 1343     		orrs	r3, r3, r2
 376 0128 3B81     		strh	r3, [r7, #8]	@ movhi
 530:Src/LTC6811.c **** 	}
 377              		.loc 1 530 0
 378 012a 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 379 012e 1B02     		lsls	r3, r3, #8
 380 0130 1BB2     		sxth	r3, r3
 381 0132 9DF80820 		ldrb	r2, [sp, #8]	@ zero_extendqisi2
 382 0136 1343     		orrs	r3, r3, r2
 383 0138 7B81     		strh	r3, [r7, #10]	@ movhi
 384 013a BDE7     		b	.L21
 385              	.L32:
 535:Src/LTC6811.c **** 		data[7] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 386              		.loc 1 535 0
 387 013c 9DF80530 		ldrb	r3, [sp, #5]	@ zero_extendqisi2
 388 0140 1B02     		lsls	r3, r3, #8
 389 0142 1BB2     		sxth	r3, r3
 390 0144 9DF80420 		ldrb	r2, [sp, #4]	@ zero_extendqisi2
 391 0148 1343     		orrs	r3, r3, r2
 392 014a BB81     		strh	r3, [r7, #12]	@ movhi
 536:Src/LTC6811.c **** 		data[8] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 393              		.loc 1 536 0
 394 014c 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 395 0150 1B02     		lsls	r3, r3, #8
 396 0152 1BB2     		sxth	r3, r3
 397 0154 9DF80620 		ldrb	r2, [sp, #6]	@ zero_extendqisi2
 398 0158 1343     		orrs	r3, r3, r2
 399 015a FB81     		strh	r3, [r7, #14]	@ movhi
 537:Src/LTC6811.c **** 	}
 400              		.loc 1 537 0
 401 015c 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 402 0160 1B02     		lsls	r3, r3, #8
 403 0162 1BB2     		sxth	r3, r3
 404 0164 9DF80820 		ldrb	r2, [sp, #8]	@ zero_extendqisi2
 405 0168 1343     		orrs	r3, r3, r2
 406 016a 3B82     		strh	r3, [r7, #16]	@ movhi
 407 016c A6E7     		b	.L22
 408              	.L33:
 542:Src/LTC6811.c **** 		data[10] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 409              		.loc 1 542 0
 410 016e 9DF80530 		ldrb	r3, [sp, #5]	@ zero_extendqisi2
ARM GAS  /tmp/ccouNvQA.s 			page 20


 411 0172 1B02     		lsls	r3, r3, #8
 412 0174 1BB2     		sxth	r3, r3
 413 0176 9DF80420 		ldrb	r2, [sp, #4]	@ zero_extendqisi2
 414 017a 1343     		orrs	r3, r3, r2
 415 017c 7B82     		strh	r3, [r7, #18]	@ movhi
 543:Src/LTC6811.c **** 		data[11] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 416              		.loc 1 543 0
 417 017e 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 418 0182 1B02     		lsls	r3, r3, #8
 419 0184 1BB2     		sxth	r3, r3
 420 0186 9DF80620 		ldrb	r2, [sp, #6]	@ zero_extendqisi2
 421 018a 1343     		orrs	r3, r3, r2
 422 018c BB82     		strh	r3, [r7, #20]	@ movhi
 544:Src/LTC6811.c **** 	}
 423              		.loc 1 544 0
 424 018e 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 425 0192 1B02     		lsls	r3, r3, #8
 426 0194 1BB2     		sxth	r3, r3
 427 0196 9DF80820 		ldrb	r2, [sp, #8]	@ zero_extendqisi2
 428 019a 1343     		orrs	r3, r3, r2
 429 019c FB82     		strh	r3, [r7, #22]	@ movhi
 430 019e 8FE7     		b	.L23
 431              	.L34:
 549:Src/LTC6811.c **** 		data[1] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 432              		.loc 1 549 0
 433 01a0 9DF80530 		ldrb	r3, [sp, #5]	@ zero_extendqisi2
 434 01a4 1B02     		lsls	r3, r3, #8
 435 01a6 1BB2     		sxth	r3, r3
 436 01a8 9DF80420 		ldrb	r2, [sp, #4]	@ zero_extendqisi2
 437 01ac 1343     		orrs	r3, r3, r2
 438 01ae 3B80     		strh	r3, [r7]	@ movhi
 550:Src/LTC6811.c **** 		data[2] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 439              		.loc 1 550 0
 440 01b0 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 441 01b4 1B02     		lsls	r3, r3, #8
 442 01b6 1BB2     		sxth	r3, r3
 443 01b8 9DF80620 		ldrb	r2, [sp, #6]	@ zero_extendqisi2
 444 01bc 1343     		orrs	r3, r3, r2
 445 01be 7B80     		strh	r3, [r7, #2]	@ movhi
 551:Src/LTC6811.c **** 	}
 446              		.loc 1 551 0
 447 01c0 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 448 01c4 1B02     		lsls	r3, r3, #8
 449 01c6 1BB2     		sxth	r3, r3
 450 01c8 9DF80820 		ldrb	r2, [sp, #8]	@ zero_extendqisi2
 451 01cc 1343     		orrs	r3, r3, r2
 452 01ce BB80     		strh	r3, [r7, #4]	@ movhi
 453 01d0 78E7     		b	.L24
 454              	.L35:
 555:Src/LTC6811.c **** 	}
 455              		.loc 1 555 0
 456 01d2 9DF80530 		ldrb	r3, [sp, #5]	@ zero_extendqisi2
 457 01d6 1B02     		lsls	r3, r3, #8
 458 01d8 1BB2     		sxth	r3, r3
 459 01da 9DF80420 		ldrb	r2, [sp, #4]	@ zero_extendqisi2
 460 01de 1343     		orrs	r3, r3, r2
 461 01e0 FB80     		strh	r3, [r7, #6]	@ movhi
ARM GAS  /tmp/ccouNvQA.s 			page 21


 462 01e2 72E7     		b	.L25
 463              	.L36:
 559:Src/LTC6811.c **** 		data[1] = (uint16_t) ((rx_data[6] << 8) & 0xFF00) | (rx_data[7] & 0x00FF);
 464              		.loc 1 559 0
 465 01e4 9DF80430 		ldrb	r3, [sp, #4]	@ zero_extendqisi2
 466 01e8 1B02     		lsls	r3, r3, #8
 467 01ea 1BB2     		sxth	r3, r3
 468 01ec 9DF80520 		ldrb	r2, [sp, #5]	@ zero_extendqisi2
 469 01f0 1343     		orrs	r3, r3, r2
 470 01f2 3B80     		strh	r3, [r7]	@ movhi
 560:Src/LTC6811.c **** 		data[2] = (uint16_t) ((rx_data[8] << 8) & 0xFF00) | (rx_data[9] & 0x00FF);
 471              		.loc 1 560 0
 472 01f4 9DF80630 		ldrb	r3, [sp, #6]	@ zero_extendqisi2
 473 01f8 1B02     		lsls	r3, r3, #8
 474 01fa 1BB2     		sxth	r3, r3
 475 01fc 9DF80720 		ldrb	r2, [sp, #7]	@ zero_extendqisi2
 476 0200 1343     		orrs	r3, r3, r2
 477 0202 7B80     		strh	r3, [r7, #2]	@ movhi
 561:Src/LTC6811.c **** 		data[3] = (uint16_t) ((rx_data[10] << 8) & 0xFF00) | (rx_data[11] & 0x00FF);
 478              		.loc 1 561 0
 479 0204 9DF80830 		ldrb	r3, [sp, #8]	@ zero_extendqisi2
 480 0208 1B02     		lsls	r3, r3, #8
 481 020a 1BB2     		sxth	r3, r3
 482 020c 9DF80920 		ldrb	r2, [sp, #9]	@ zero_extendqisi2
 483 0210 1343     		orrs	r3, r3, r2
 484 0212 BB80     		strh	r3, [r7, #4]	@ movhi
 562:Src/LTC6811.c **** 	}
 485              		.loc 1 562 0
 486 0214 9DF80A30 		ldrb	r3, [sp, #10]	@ zero_extendqisi2
 487 0218 1B02     		lsls	r3, r3, #8
 488 021a 1BB2     		sxth	r3, r3
 489 021c 9DF80B20 		ldrb	r2, [sp, #11]	@ zero_extendqisi2
 490 0220 1343     		orrs	r3, r3, r2
 491 0222 FB80     		strh	r3, [r7, #6]	@ movhi
 492 0224 54E7     		b	.L26
 493              		.cfi_endproc
 494              	.LFE76:
 496              		.section	.text.readConfig,"ax",%progbits
 497              		.align	1
 498              		.global	readConfig
 499              		.syntax unified
 500              		.thumb
 501              		.thumb_func
 502              		.fpu softvfp
 504              	readConfig:
 505              	.LFB73:
 342:Src/LTC6811.c **** 	
 506              		.loc 1 342 0
 507              		.cfi_startproc
 508              		@ args = 0, pretend = 0, frame = 0
 509              		@ frame_needed = 0, uses_anonymous_args = 0
 510              	.LVL36:
 511 0000 70B5     		push	{r4, r5, r6, lr}
 512              	.LCFI6:
 513              		.cfi_def_cfa_offset 16
 514              		.cfi_offset 4, -16
 515              		.cfi_offset 5, -12
ARM GAS  /tmp/ccouNvQA.s 			page 22


 516              		.cfi_offset 6, -8
 517              		.cfi_offset 14, -4
 518 0002 0646     		mov	r6, r0
 519 0004 0C46     		mov	r4, r1
 520              	.LVL37:
 347:Src/LTC6811.c **** 	
 521              		.loc 1 347 0
 522 0006 0820     		movs	r0, #8
 523              	.LVL38:
 524 0008 FFF7FEFF 		bl	malloc
 525              	.LVL39:
 526 000c 0546     		mov	r5, r0
 527              	.LVL40:
 349:Src/LTC6811.c **** 	
 528              		.loc 1 349 0
 529 000e 0246     		mov	r2, r0
 530 0010 3146     		mov	r1, r6
 531 0012 0220     		movs	r0, #2
 532              	.LVL41:
 533 0014 FFF7FEFF 		bl	readRegister
 534              	.LVL42:
 351:Src/LTC6811.c **** 	cfg[1] = (uint8_t) (config[0] & 0xFF);
 535              		.loc 1 351 0
 536 0018 2B88     		ldrh	r3, [r5]
 537 001a 1A0A     		lsrs	r2, r3, #8
 538 001c 2270     		strb	r2, [r4]
 352:Src/LTC6811.c **** 	cfg[2] = (uint8_t) ((config[1] >> 8) & 0xFF);
 539              		.loc 1 352 0
 540 001e 6370     		strb	r3, [r4, #1]
 353:Src/LTC6811.c **** 	cfg[3] = (uint8_t) (config[1] & 0xFF);
 541              		.loc 1 353 0
 542 0020 6B88     		ldrh	r3, [r5, #2]
 543 0022 1A0A     		lsrs	r2, r3, #8
 544 0024 A270     		strb	r2, [r4, #2]
 354:Src/LTC6811.c **** 	cfg[4] = (uint8_t) ((config[2] >> 8) & 0xFF);
 545              		.loc 1 354 0
 546 0026 E370     		strb	r3, [r4, #3]
 355:Src/LTC6811.c **** 	cfg[5] = (uint8_t) (config[2] & 0xFF);
 547              		.loc 1 355 0
 548 0028 AB88     		ldrh	r3, [r5, #4]
 549 002a 1A0A     		lsrs	r2, r3, #8
 550 002c 2271     		strb	r2, [r4, #4]
 356:Src/LTC6811.c **** 	cfg[6] = (uint8_t) ((config[3] >> 8) & 0xFF);
 551              		.loc 1 356 0
 552 002e 6371     		strb	r3, [r4, #5]
 357:Src/LTC6811.c **** 	cfg[7] = (uint8_t) (config[3] & 0xFF);
 553              		.loc 1 357 0
 554 0030 EB88     		ldrh	r3, [r5, #6]
 555 0032 1A0A     		lsrs	r2, r3, #8
 556 0034 A271     		strb	r2, [r4, #6]
 358:Src/LTC6811.c **** 	
 557              		.loc 1 358 0
 558 0036 E371     		strb	r3, [r4, #7]
 361:Src/LTC6811.c **** 
 559              		.loc 1 361 0
 560 0038 70BD     		pop	{r4, r5, r6, pc}
 561              		.cfi_endproc
ARM GAS  /tmp/ccouNvQA.s 			page 23


 562              	.LFE73:
 564              		.section	.text.writeConfigAddress,"ax",%progbits
 565              		.align	1
 566              		.global	writeConfigAddress
 567              		.syntax unified
 568              		.thumb
 569              		.thumb_func
 570              		.fpu softvfp
 572              	writeConfigAddress:
 573              	.LFB67:
 112:Src/LTC6811.c **** 
 574              		.loc 1 112 0
 575              		.cfi_startproc
 576              		@ args = 100, pretend = 16, frame = 8
 577              		@ frame_needed = 0, uses_anonymous_args = 0
 578              	.LVL43:
 579 0000 84B0     		sub	sp, sp, #16
 580              	.LCFI7:
 581              		.cfi_def_cfa_offset 16
 582 0002 2DE9F04F 		push	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 583              	.LCFI8:
 584              		.cfi_def_cfa_offset 52
 585              		.cfi_offset 4, -52
 586              		.cfi_offset 5, -48
 587              		.cfi_offset 6, -44
 588              		.cfi_offset 7, -40
 589              		.cfi_offset 8, -36
 590              		.cfi_offset 9, -32
 591              		.cfi_offset 10, -28
 592              		.cfi_offset 11, -24
 593              		.cfi_offset 14, -20
 594 0006 83B0     		sub	sp, sp, #12
 595              	.LCFI9:
 596              		.cfi_def_cfa_offset 64
 597 0008 0CAC     		add	r4, sp, #48
 598 000a 84E80F00 		stm	r4, {r0, r1, r2, r3}
 599 000e 9DF89090 		ldrb	r9, [sp, #144]	@ zero_extendqisi2
 600              	.LVL44:
 120:Src/LTC6811.c **** 	
 601              		.loc 1 120 0
 602 0012 6946     		mov	r1, sp
 603 0014 4846     		mov	r0, r9
 604 0016 FFF7FEFF 		bl	readConfig
 605              	.LVL45:
 122:Src/LTC6811.c **** 	
 606              		.loc 1 122 0
 607 001a 0C20     		movs	r0, #12
 608 001c FFF7FEFF 		bl	malloc
 609              	.LVL46:
 610 0020 0646     		mov	r6, r0
 611              	.LVL47:
 124:Src/LTC6811.c **** 	config[1] = (uint8_t) (cfg.UndervoltageComparisonVoltage & 0xFF);
 612              		.loc 1 124 0
 613 0022 9DF87250 		ldrb	r5, [sp, #114]	@ zero_extendqisi2
 614 0026 ED01     		lsls	r5, r5, #7
 615 0028 6DB2     		sxtb	r5, r5
 616 002a 9DF87330 		ldrb	r3, [sp, #115]	@ zero_extendqisi2
ARM GAS  /tmp/ccouNvQA.s 			page 24


 617 002e 45EA8315 		orr	r5, r5, r3, lsl #6
 618 0032 6DB2     		sxtb	r5, r5
 619 0034 9DF87430 		ldrb	r3, [sp, #116]	@ zero_extendqisi2
 620 0038 45EA4315 		orr	r5, r5, r3, lsl #5
 621 003c 6DB2     		sxtb	r5, r5
 622 003e 9DF87530 		ldrb	r3, [sp, #117]	@ zero_extendqisi2
 623 0042 45EA0315 		orr	r5, r5, r3, lsl #4
 624 0046 6DB2     		sxtb	r5, r5
 625 0048 9DF87630 		ldrb	r3, [sp, #118]	@ zero_extendqisi2
 626 004c 45EAC305 		orr	r5, r5, r3, lsl #3
 627 0050 6DB2     		sxtb	r5, r5
 628 0052 9DF87730 		ldrb	r3, [sp, #119]	@ zero_extendqisi2
 629 0056 45EA8305 		orr	r5, r5, r3, lsl #2
 630 005a 6DB2     		sxtb	r5, r5
 631 005c 9DF97830 		ldrsb	r3, [sp, #120]
 632 0060 1D43     		orrs	r5, r5, r3
 633 0062 EDB2     		uxtb	r5, r5
 125:Src/LTC6811.c **** 	config[2] = (uint8_t) ((cfg.OvervoltageComparisonVoltage << 4) & 0xF0) | ((cfg.UndervoltageCompari
 634              		.loc 1 125 0
 635 0064 BDF87A30 		ldrh	r3, [sp, #122]
 636 0068 5FFA83FA 		uxtb	r10, r3
 126:Src/LTC6811.c **** 	config[3] = (uint8_t) ((cfg.OvervoltageComparisonVoltage >> 4) & 0xFF);
 637              		.loc 1 126 0
 638 006c BDF87C80 		ldrh	r8, [sp, #124]
 639 0070 4FEA0817 		lsl	r7, r8, #4
 640 0074 7FB2     		sxtb	r7, r7
 641 0076 C3F30323 		ubfx	r3, r3, #8, #4
 642 007a 1F43     		orrs	r7, r7, r3
 643 007c FFB2     		uxtb	r7, r7
 127:Src/LTC6811.c **** 	config[4] = (uint8_t) (cfg.DischargeCell8 << 7) | (cfg.DischargeCell7 << 6) | (cfg.DischargeCell6 
 644              		.loc 1 127 0
 645 007e C8F30718 		ubfx	r8, r8, #4, #8
 128:Src/LTC6811.c **** 	config[5] = (uint8_t) ((cfg.DischargeTimeoutValue << 4) & 0xF0) | (cfg.DischargeCell12 << 3) | (cf
 646              		.loc 1 128 0
 647 0082 9DF88540 		ldrb	r4, [sp, #133]	@ zero_extendqisi2
 648 0086 E401     		lsls	r4, r4, #7
 649 0088 64B2     		sxtb	r4, r4
 650 008a 9DF88430 		ldrb	r3, [sp, #132]	@ zero_extendqisi2
 651 008e 44EA8314 		orr	r4, r4, r3, lsl #6
 652 0092 64B2     		sxtb	r4, r4
 653 0094 9DF88330 		ldrb	r3, [sp, #131]	@ zero_extendqisi2
 654 0098 44EA4314 		orr	r4, r4, r3, lsl #5
 655 009c 64B2     		sxtb	r4, r4
 656 009e 9DF88230 		ldrb	r3, [sp, #130]	@ zero_extendqisi2
 657 00a2 44EA0314 		orr	r4, r4, r3, lsl #4
 658 00a6 64B2     		sxtb	r4, r4
 659 00a8 9DF88130 		ldrb	r3, [sp, #129]	@ zero_extendqisi2
 660 00ac 44EAC304 		orr	r4, r4, r3, lsl #3
 661 00b0 64B2     		sxtb	r4, r4
 662 00b2 9DF88030 		ldrb	r3, [sp, #128]	@ zero_extendqisi2
 663 00b6 44EA8304 		orr	r4, r4, r3, lsl #2
 664 00ba 64B2     		sxtb	r4, r4
 665 00bc 9DF87F30 		ldrb	r3, [sp, #127]	@ zero_extendqisi2
 666 00c0 44EA4304 		orr	r4, r4, r3, lsl #1
 667 00c4 64B2     		sxtb	r4, r4
 668 00c6 9DF97E30 		ldrsb	r3, [sp, #126]
 669 00ca 1C43     		orrs	r4, r4, r3
ARM GAS  /tmp/ccouNvQA.s 			page 25


 670 00cc E4B2     		uxtb	r4, r4
 129:Src/LTC6811.c **** 	
 671              		.loc 1 129 0
 672 00ce 9DF88AB0 		ldrb	fp, [sp, #138]	@ zero_extendqisi2
 673 00d2 4FEA0B1B 		lsl	fp, fp, #4
 674 00d6 4FFA8BFB 		sxtb	fp, fp
 675 00da 9DF88930 		ldrb	r3, [sp, #137]	@ zero_extendqisi2
 676 00de 4BEAC30B 		orr	fp, fp, r3, lsl #3
 677 00e2 4FFA8BFB 		sxtb	fp, fp
 678 00e6 9DF88830 		ldrb	r3, [sp, #136]	@ zero_extendqisi2
 679 00ea 4BEA830B 		orr	fp, fp, r3, lsl #2
 680 00ee 4FFA8BFB 		sxtb	fp, fp
 681 00f2 9DF88730 		ldrb	r3, [sp, #135]	@ zero_extendqisi2
 682 00f6 4BEA430B 		orr	fp, fp, r3, lsl #1
 683 00fa 4FFA8BFB 		sxtb	fp, fp
 684 00fe 9DF98630 		ldrsb	r3, [sp, #134]
 685 0102 4BEA030B 		orr	fp, fp, r3
 686 0106 5FFA8BFB 		uxtb	fp, fp
 131:Src/LTC6811.c **** 	cmd[1] = (uint8_t) (WriteConfigurationRegisterGroup & 0xFF);
 687              		.loc 1 131 0
 688 010a 4FEAC903 		lsl	r3, r9, #3
 689 010e 03F07803 		and	r3, r3, #120
 690 0112 43F08003 		orr	r3, r3, #128
 691 0116 0370     		strb	r3, [r0]
 132:Src/LTC6811.c **** 	
 692              		.loc 1 132 0
 693 0118 0123     		movs	r3, #1
 694 011a 4370     		strb	r3, [r0, #1]
 134:Src/LTC6811.c **** 	
 695              		.loc 1 134 0
 696 011c 0146     		mov	r1, r0
 697 011e 0220     		movs	r0, #2
 698              	.LVL48:
 699 0120 FFF7FEFF 		bl	calculatePEC
 700              	.LVL49:
 136:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 701              		.loc 1 136 0
 702 0124 030A     		lsrs	r3, r0, #8
 703 0126 B370     		strb	r3, [r6, #2]
 137:Src/LTC6811.c **** 
 704              		.loc 1 137 0
 705 0128 F070     		strb	r0, [r6, #3]
 139:Src/LTC6811.c **** 	cmd[5] = config[1];
 706              		.loc 1 139 0
 707 012a 3571     		strb	r5, [r6, #4]
 140:Src/LTC6811.c **** 	cmd[6] = config[2];
 708              		.loc 1 140 0
 709 012c 86F805A0 		strb	r10, [r6, #5]
 141:Src/LTC6811.c **** 	cmd[7] = config[3];
 710              		.loc 1 141 0
 711 0130 B771     		strb	r7, [r6, #6]
 142:Src/LTC6811.c **** 	cmd[8] = config[4];
 712              		.loc 1 142 0
 713 0132 86F80780 		strb	r8, [r6, #7]
 143:Src/LTC6811.c **** 	cmd[9] = config[5];
 714              		.loc 1 143 0
 715 0136 3472     		strb	r4, [r6, #8]
ARM GAS  /tmp/ccouNvQA.s 			page 26


 144:Src/LTC6811.c **** 	
 716              		.loc 1 144 0
 717 0138 86F809B0 		strb	fp, [r6, #9]
 146:Src/LTC6811.c **** 
 718              		.loc 1 146 0
 719 013c 311D     		adds	r1, r6, #4
 720 013e 0620     		movs	r0, #6
 721              	.LVL50:
 722 0140 FFF7FEFF 		bl	calculatePEC
 723              	.LVL51:
 148:Src/LTC6811.c **** 	cmd[11] = PEC_return & 0xFF;
 724              		.loc 1 148 0
 725 0144 030A     		lsrs	r3, r0, #8
 726 0146 B372     		strb	r3, [r6, #10]
 149:Src/LTC6811.c **** 	
 727              		.loc 1 149 0
 728 0148 F072     		strb	r0, [r6, #11]
 151:Src/LTC6811.c **** 
 729              		.loc 1 151 0
 730 014a 0C21     		movs	r1, #12
 731 014c 3046     		mov	r0, r6
 732              	.LVL52:
 733 014e FFF7FEFF 		bl	SPIWrite
 734              	.LVL53:
 153:Src/LTC6811.c **** 	
 735              		.loc 1 153 0
 736 0152 6946     		mov	r1, sp
 737 0154 4846     		mov	r0, r9
 738 0156 FFF7FEFF 		bl	readConfig
 739              	.LVL54:
 155:Src/LTC6811.c **** 
 740              		.loc 1 155 0
 741 015a 3046     		mov	r0, r6
 742 015c FFF7FEFF 		bl	free
 743              	.LVL55:
 157:Src/LTC6811.c **** 
 744              		.loc 1 157 0
 745 0160 03B0     		add	sp, sp, #12
 746              	.LCFI10:
 747              		.cfi_def_cfa_offset 52
 748              		@ sp needed
 749 0162 BDE8F04F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 750              	.LCFI11:
 751              		.cfi_restore 14
 752              		.cfi_restore 11
 753              		.cfi_restore 10
 754              		.cfi_restore 9
 755              		.cfi_restore 8
 756              		.cfi_restore 7
 757              		.cfi_restore 6
 758              		.cfi_restore 5
 759              		.cfi_restore 4
 760              		.cfi_def_cfa_offset 16
 761              	.LVL56:
 762 0166 04B0     		add	sp, sp, #16
 763              	.LCFI12:
 764              		.cfi_def_cfa_offset 0
ARM GAS  /tmp/ccouNvQA.s 			page 27


 765 0168 7047     		bx	lr
 766              		.cfi_endproc
 767              	.LFE67:
 769              		.section	.text.writeConfigAll,"ax",%progbits
 770              		.align	1
 771              		.global	writeConfigAll
 772              		.syntax unified
 773              		.thumb
 774              		.thumb_func
 775              		.fpu softvfp
 777              	writeConfigAll:
 778              	.LFB68:
 159:Src/LTC6811.c **** 
 779              		.loc 1 159 0
 780              		.cfi_startproc
 781              		@ args = 96, pretend = 16, frame = 0
 782              		@ frame_needed = 0, uses_anonymous_args = 0
 783 0000 84B0     		sub	sp, sp, #16
 784              	.LCFI13:
 785              		.cfi_def_cfa_offset 16
 786 0002 10B5     		push	{r4, lr}
 787              	.LCFI14:
 788              		.cfi_def_cfa_offset 24
 789              		.cfi_offset 4, -24
 790              		.cfi_offset 14, -20
 791 0004 96B0     		sub	sp, sp, #88
 792              	.LCFI15:
 793              		.cfi_def_cfa_offset 112
 794 0006 18AC     		add	r4, sp, #96
 795 0008 84E80F00 		stm	r4, {r0, r1, r2, r3}
 796              	.LVL57:
 797              	.LBB7:
 161:Src/LTC6811.c **** 		writeConfigAddress(cfg, cfg.address[i]);
 798              		.loc 1 161 0
 799 000c 0024     		movs	r4, #0
 800 000e 0EE0     		b	.L42
 801              	.LVL58:
 802              	.L43:
 162:Src/LTC6811.c **** 	}
 803              		.loc 1 162 0 discriminator 3
 804 0010 18AB     		add	r3, sp, #96
 805 0012 2344     		add	r3, r3, r4
 806 0014 5B78     		ldrb	r3, [r3, #1]	@ zero_extendqisi2
 807 0016 1493     		str	r3, [sp, #80]
 808 0018 4E22     		movs	r2, #78
 809 001a 1CA9     		add	r1, sp, #112
 810 001c 6846     		mov	r0, sp
 811 001e FFF7FEFF 		bl	memcpy
 812              	.LVL59:
 813 0022 18AB     		add	r3, sp, #96
 814 0024 0FCB     		ldm	r3, {r0, r1, r2, r3}
 815 0026 FFF7FEFF 		bl	writeConfigAddress
 816              	.LVL60:
 161:Src/LTC6811.c **** 		writeConfigAddress(cfg, cfg.address[i]);
 817              		.loc 1 161 0 discriminator 3
 818 002a 0134     		adds	r4, r4, #1
 819              	.LVL61:
ARM GAS  /tmp/ccouNvQA.s 			page 28


 820 002c E4B2     		uxtb	r4, r4
 821              	.LVL62:
 822              	.L42:
 161:Src/LTC6811.c **** 		writeConfigAddress(cfg, cfg.address[i]);
 823              		.loc 1 161 0 is_stmt 0 discriminator 1
 824 002e 9DF86030 		ldrb	r3, [sp, #96]	@ zero_extendqisi2
 825 0032 A342     		cmp	r3, r4
 826 0034 ECD8     		bhi	.L43
 827              	.LBE7:
 164:Src/LTC6811.c **** 
 828              		.loc 1 164 0 is_stmt 1
 829 0036 16B0     		add	sp, sp, #88
 830              	.LCFI16:
 831              		.cfi_def_cfa_offset 24
 832              		@ sp needed
 833 0038 BDE81040 		pop	{r4, lr}
 834              	.LCFI17:
 835              		.cfi_restore 14
 836              		.cfi_restore 4
 837              		.cfi_def_cfa_offset 16
 838              	.LVL63:
 839 003c 04B0     		add	sp, sp, #16
 840              	.LCFI18:
 841              		.cfi_def_cfa_offset 0
 842 003e 7047     		bx	lr
 843              		.cfi_endproc
 844              	.LFE68:
 846              		.section	.text.dischargeCellGroups,"ax",%progbits
 847              		.align	1
 848              		.global	dischargeCellGroups
 849              		.syntax unified
 850              		.thumb
 851              		.thumb_func
 852              		.fpu softvfp
 854              	dischargeCellGroups:
 855              	.LFB75:
 416:Src/LTC6811.c **** 	
 856              		.loc 1 416 0
 857              		.cfi_startproc
 858              		@ args = 100, pretend = 16, frame = 0
 859              		@ frame_needed = 0, uses_anonymous_args = 0
 860              	.LVL64:
 861 0000 84B0     		sub	sp, sp, #16
 862              	.LCFI19:
 863              		.cfi_def_cfa_offset 16
 864 0002 30B5     		push	{r4, r5, lr}
 865              	.LCFI20:
 866              		.cfi_def_cfa_offset 28
 867              		.cfi_offset 4, -28
 868              		.cfi_offset 5, -24
 869              		.cfi_offset 14, -20
 870 0004 97B0     		sub	sp, sp, #92
 871              	.LCFI21:
 872              		.cfi_def_cfa_offset 120
 873 0006 1AAC     		add	r4, sp, #104
 874 0008 84E80F00 		stm	r4, {r0, r1, r2, r3}
 875 000c 329D     		ldr	r5, [sp, #200]
ARM GAS  /tmp/ccouNvQA.s 			page 29


 876              	.LVL65:
 877              	.LBB8:
 422:Src/LTC6811.c **** 
 878              		.loc 1 422 0
 879 000e 0024     		movs	r4, #0
 880              	.LVL66:
 881 0010 29E0     		b	.L46
 882              	.LVL67:
 883              	.L47:
 424:Src/LTC6811.c **** 		cfg->DischargeCell2 = cellDischarge[i][1];
 884              		.loc 1 424 0 discriminator 3
 885 0012 05EBC403 		add	r3, r5, r4, lsl #3
 886 0016 15F83420 		ldrb	r2, [r5, r4, lsl #3]	@ zero_extendqisi2
 887 001a 8DF8B620 		strb	r2, [sp, #182]
 425:Src/LTC6811.c **** 		cfg->DischargeCell3 = cellDischarge[i][2];
 888              		.loc 1 425 0 discriminator 3
 889 001e 5A78     		ldrb	r2, [r3, #1]	@ zero_extendqisi2
 890 0020 8DF8B720 		strb	r2, [sp, #183]
 426:Src/LTC6811.c **** 		cfg->DischargeCell4 = cellDischarge[i][3];
 891              		.loc 1 426 0 discriminator 3
 892 0024 9A78     		ldrb	r2, [r3, #2]	@ zero_extendqisi2
 893 0026 8DF8B820 		strb	r2, [sp, #184]
 427:Src/LTC6811.c **** 		cfg->DischargeCell7 = cellDischarge[i][4];
 894              		.loc 1 427 0 discriminator 3
 895 002a DA78     		ldrb	r2, [r3, #3]	@ zero_extendqisi2
 896 002c 8DF8B920 		strb	r2, [sp, #185]
 428:Src/LTC6811.c **** 		cfg->DischargeCell8 = cellDischarge[i][5];
 897              		.loc 1 428 0 discriminator 3
 898 0030 1A79     		ldrb	r2, [r3, #4]	@ zero_extendqisi2
 899 0032 8DF8BC20 		strb	r2, [sp, #188]
 429:Src/LTC6811.c **** 		cfg->DischargeCell9 = cellDischarge[i][6];
 900              		.loc 1 429 0 discriminator 3
 901 0036 5A79     		ldrb	r2, [r3, #5]	@ zero_extendqisi2
 902 0038 8DF8BD20 		strb	r2, [sp, #189]
 430:Src/LTC6811.c **** 		cfg->DischargeCell10 = cellDischarge[i][7];
 903              		.loc 1 430 0 discriminator 3
 904 003c 9A79     		ldrb	r2, [r3, #6]	@ zero_extendqisi2
 905 003e 8DF8BE20 		strb	r2, [sp, #190]
 431:Src/LTC6811.c **** 
 906              		.loc 1 431 0 discriminator 3
 907 0042 DB79     		ldrb	r3, [r3, #7]	@ zero_extendqisi2
 908 0044 8DF8BF30 		strb	r3, [sp, #191]
 433:Src/LTC6811.c **** 
 909              		.loc 1 433 0 discriminator 3
 910 0048 1AAB     		add	r3, sp, #104
 911              	.LVL68:
 912 004a 2344     		add	r3, r3, r4
 913              	.LVL69:
 914 004c 5B78     		ldrb	r3, [r3, #1]	@ zero_extendqisi2
 915 004e 1493     		str	r3, [sp, #80]
 916 0050 4E22     		movs	r2, #78
 917 0052 1EA9     		add	r1, sp, #120
 918 0054 6846     		mov	r0, sp
 919 0056 FFF7FEFF 		bl	memcpy
 920              	.LVL70:
 921 005a 1AAB     		add	r3, sp, #104
 922              	.LVL71:
ARM GAS  /tmp/ccouNvQA.s 			page 30


 923 005c 0FCB     		ldm	r3, {r0, r1, r2, r3}
 924              	.LVL72:
 925 005e FFF7FEFF 		bl	writeConfigAddress
 926              	.LVL73:
 422:Src/LTC6811.c **** 
 927              		.loc 1 422 0 discriminator 3
 928 0062 0134     		adds	r4, r4, #1
 929              	.LVL74:
 930 0064 E4B2     		uxtb	r4, r4
 931              	.LVL75:
 932              	.L46:
 422:Src/LTC6811.c **** 
 933              		.loc 1 422 0 is_stmt 0 discriminator 1
 934 0066 9DF86830 		ldrb	r3, [sp, #104]	@ zero_extendqisi2
 935 006a A342     		cmp	r3, r4
 936 006c D1D8     		bhi	.L47
 937              	.LBE8:
 448:Src/LTC6811.c **** 
 938              		.loc 1 448 0 is_stmt 1
 939 006e 0020     		movs	r0, #0
 940 0070 17B0     		add	sp, sp, #92
 941              	.LCFI22:
 942              		.cfi_def_cfa_offset 28
 943              		@ sp needed
 944 0072 BDE83040 		pop	{r4, r5, lr}
 945              	.LCFI23:
 946              		.cfi_restore 14
 947              		.cfi_restore 5
 948              		.cfi_restore 4
 949              		.cfi_def_cfa_offset 16
 950              	.LVL76:
 951 0076 04B0     		add	sp, sp, #16
 952              	.LCFI24:
 953              		.cfi_def_cfa_offset 0
 954              	.LVL77:
 955 0078 7047     		bx	lr
 956              		.cfi_endproc
 957              	.LFE75:
 959              		.section	.text.sendBroadcastCommand,"ax",%progbits
 960              		.align	1
 961              		.global	sendBroadcastCommand
 962              		.syntax unified
 963              		.thumb
 964              		.thumb_func
 965              		.fpu softvfp
 967              	sendBroadcastCommand:
 968              	.LFB77:
 569:Src/LTC6811.c **** 	
 969              		.loc 1 569 0
 970              		.cfi_startproc
 971              		@ args = 0, pretend = 0, frame = 8
 972              		@ frame_needed = 0, uses_anonymous_args = 0
 973              	.LVL78:
 974 0000 00B5     		push	{lr}
 975              	.LCFI25:
 976              		.cfi_def_cfa_offset 4
 977              		.cfi_offset 14, -4
ARM GAS  /tmp/ccouNvQA.s 			page 31


 978 0002 83B0     		sub	sp, sp, #12
 979              	.LCFI26:
 980              		.cfi_def_cfa_offset 16
 574:Src/LTC6811.c **** 	cmd[1] = (uint8_t) (command & 0xFF);
 981              		.loc 1 574 0
 982 0004 C0F30323 		ubfx	r3, r0, #8, #4
 983 0008 8DF80430 		strb	r3, [sp, #4]
 575:Src/LTC6811.c **** 	
 984              		.loc 1 575 0
 985 000c 8DF80500 		strb	r0, [sp, #5]
 577:Src/LTC6811.c **** 	
 986              		.loc 1 577 0
 987 0010 01A9     		add	r1, sp, #4
 988 0012 0220     		movs	r0, #2
 989              	.LVL79:
 990 0014 FFF7FEFF 		bl	calculatePEC
 991              	.LVL80:
 579:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 992              		.loc 1 579 0
 993 0018 030A     		lsrs	r3, r0, #8
 994 001a 8DF80630 		strb	r3, [sp, #6]
 580:Src/LTC6811.c **** 	
 995              		.loc 1 580 0
 996 001e 8DF80700 		strb	r0, [sp, #7]
 582:Src/LTC6811.c **** };
 997              		.loc 1 582 0
 998 0022 0421     		movs	r1, #4
 999 0024 0DEB0100 		add	r0, sp, r1
 1000              	.LVL81:
 1001 0028 FFF7FEFF 		bl	SPIWrite
 1002              	.LVL82:
 583:Src/LTC6811.c **** 
 1003              		.loc 1 583 0
 1004 002c 03B0     		add	sp, sp, #12
 1005              	.LCFI27:
 1006              		.cfi_def_cfa_offset 4
 1007              		@ sp needed
 1008 002e 5DF804FB 		ldr	pc, [sp], #4
 1009              		.cfi_endproc
 1010              	.LFE77:
 1012              		.section	.text.sendAddressCommand,"ax",%progbits
 1013              		.align	1
 1014              		.global	sendAddressCommand
 1015              		.syntax unified
 1016              		.thumb
 1017              		.thumb_func
 1018              		.fpu softvfp
 1020              	sendAddressCommand:
 1021              	.LFB78:
 585:Src/LTC6811.c **** 	
 1022              		.loc 1 585 0
 1023              		.cfi_startproc
 1024              		@ args = 0, pretend = 0, frame = 8
 1025              		@ frame_needed = 0, uses_anonymous_args = 0
 1026              	.LVL83:
 1027 0000 70B5     		push	{r4, r5, r6, lr}
 1028              	.LCFI28:
ARM GAS  /tmp/ccouNvQA.s 			page 32


 1029              		.cfi_def_cfa_offset 16
 1030              		.cfi_offset 4, -16
 1031              		.cfi_offset 5, -12
 1032              		.cfi_offset 6, -8
 1033              		.cfi_offset 14, -4
 1034 0002 82B0     		sub	sp, sp, #8
 1035              	.LCFI29:
 1036              		.cfi_def_cfa_offset 24
 1037 0004 0546     		mov	r5, r0
 1038 0006 0C46     		mov	r4, r1
 591:Src/LTC6811.c **** 	
 1039              		.loc 1 591 0
 1040 0008 0220     		movs	r0, #2
 1041              	.LVL84:
 1042 000a FFF7FEFF 		bl	malloc
 1043              	.LVL85:
 1044 000e 0646     		mov	r6, r0
 1045              	.LVL86:
 593:Src/LTC6811.c **** 	msbytes[1] = (uint8_t) (command & 0xFF);
 1046              		.loc 1 593 0
 1047 0010 E300     		lsls	r3, r4, #3
 1048 0012 03F07803 		and	r3, r3, #120
 1049 0016 63F07F03 		orn	r3, r3, #127
 1050 001a C5F30224 		ubfx	r4, r5, #8, #3
 1051 001e 2343     		orrs	r3, r3, r4
 1052 0020 DBB2     		uxtb	r3, r3
 1053 0022 0370     		strb	r3, [r0]
 594:Src/LTC6811.c **** 
 1054              		.loc 1 594 0
 1055 0024 EDB2     		uxtb	r5, r5
 1056 0026 4570     		strb	r5, [r0, #1]
 596:Src/LTC6811.c **** 	cmd[1] = msbytes[1];
 1057              		.loc 1 596 0
 1058 0028 8DF80430 		strb	r3, [sp, #4]
 597:Src/LTC6811.c **** 	
 1059              		.loc 1 597 0
 1060 002c 8DF80550 		strb	r5, [sp, #5]
 599:Src/LTC6811.c **** 	
 1061              		.loc 1 599 0
 1062 0030 0146     		mov	r1, r0
 1063 0032 0220     		movs	r0, #2
 1064              	.LVL87:
 1065 0034 FFF7FEFF 		bl	calculatePEC
 1066              	.LVL88:
 601:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 1067              		.loc 1 601 0
 1068 0038 030A     		lsrs	r3, r0, #8
 1069 003a 8DF80630 		strb	r3, [sp, #6]
 602:Src/LTC6811.c **** 	
 1070              		.loc 1 602 0
 1071 003e 8DF80700 		strb	r0, [sp, #7]
 604:Src/LTC6811.c **** 	
 1072              		.loc 1 604 0
 1073 0042 0421     		movs	r1, #4
 1074 0044 0DEB0100 		add	r0, sp, r1
 1075              	.LVL89:
 1076 0048 FFF7FEFF 		bl	SPIWrite
ARM GAS  /tmp/ccouNvQA.s 			page 33


 1077              	.LVL90:
 606:Src/LTC6811.c **** };
 1078              		.loc 1 606 0
 1079 004c 3046     		mov	r0, r6
 1080 004e FFF7FEFF 		bl	free
 1081              	.LVL91:
 607:Src/LTC6811.c **** 
 1082              		.loc 1 607 0
 1083 0052 02B0     		add	sp, sp, #8
 1084              	.LCFI30:
 1085              		.cfi_def_cfa_offset 16
 1086              		@ sp needed
 1087 0054 70BD     		pop	{r4, r5, r6, pc}
 1088              		.cfi_endproc
 1089              	.LFE78:
 1091              		.section	.text.readCellVoltage,"ax",%progbits
 1092              		.align	1
 1093              		.global	readCellVoltage
 1094              		.syntax unified
 1095              		.thumb
 1096              		.thumb_func
 1097              		.fpu softvfp
 1099              	readCellVoltage:
 1100              	.LFB69:
 166:Src/LTC6811.c **** 	
 1101              		.loc 1 166 0
 1102              		.cfi_startproc
 1103              		@ args = 0, pretend = 0, frame = 0
 1104              		@ frame_needed = 0, uses_anonymous_args = 0
 1105              	.LVL92:
 1106 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 1107              	.LCFI31:
 1108              		.cfi_def_cfa_offset 24
 1109              		.cfi_offset 3, -24
 1110              		.cfi_offset 4, -20
 1111              		.cfi_offset 5, -16
 1112              		.cfi_offset 6, -12
 1113              		.cfi_offset 7, -8
 1114              		.cfi_offset 14, -4
 1115 0002 0746     		mov	r7, r0
 1116 0004 0D46     		mov	r5, r1
 1117              	.LVL93:
 172:Src/LTC6811.c **** 	
 1118              		.loc 1 172 0
 1119 0006 1820     		movs	r0, #24
 1120              	.LVL94:
 1121 0008 FFF7FEFF 		bl	malloc
 1122              	.LVL95:
 1123 000c 0446     		mov	r4, r0
 1124              	.LVL96:
 174:Src/LTC6811.c **** 
 1125              		.loc 1 174 0
 1126 000e 3946     		mov	r1, r7
 1127 0010 4FF41870 		mov	r0, #608
 1128              	.LVL97:
 1129 0014 FFF7FEFF 		bl	sendAddressCommand
 1130              	.LVL98:
ARM GAS  /tmp/ccouNvQA.s 			page 34


 176:Src/LTC6811.c **** 	
 1131              		.loc 1 176 0
 1132 0018 0F20     		movs	r0, #15
 1133 001a FFF7FEFF 		bl	HAL_Delay
 1134              	.LVL99:
 178:Src/LTC6811.c **** 	//dataValid = dataValid & PEC_check;
 1135              		.loc 1 178 0
 1136 001e 2246     		mov	r2, r4
 1137 0020 3946     		mov	r1, r7
 1138 0022 0420     		movs	r0, #4
 1139 0024 FFF7FEFF 		bl	readRegister
 1140              	.LVL100:
 180:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 1141              		.loc 1 180 0
 1142 0028 2246     		mov	r2, r4
 1143 002a 3946     		mov	r1, r7
 1144 002c 0620     		movs	r0, #6
 1145 002e FFF7FEFF 		bl	readRegister
 1146              	.LVL101:
 1147 0032 0646     		mov	r6, r0
 1148              	.LVL102:
 182:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 1149              		.loc 1 182 0
 1150 0034 2246     		mov	r2, r4
 1151 0036 3946     		mov	r1, r7
 1152 0038 0820     		movs	r0, #8
 1153 003a FFF7FEFF 		bl	readRegister
 1154              	.LVL103:
 1155 003e 0640     		ands	r6, r6, r0
 1156              	.LVL104:
 1157 0040 F6B2     		uxtb	r6, r6
 1158              	.LVL105:
 184:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 1159              		.loc 1 184 0
 1160 0042 2246     		mov	r2, r4
 1161 0044 3946     		mov	r1, r7
 1162 0046 0A20     		movs	r0, #10
 1163              	.LVL106:
 1164 0048 FFF7FEFF 		bl	readRegister
 1165              	.LVL107:
 1166 004c 0640     		ands	r6, r6, r0
 1167              	.LVL108:
 186:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 1168              		.loc 1 186 0
 1169 004e 2246     		mov	r2, r4
 1170 0050 3946     		mov	r1, r7
 1171 0052 0420     		movs	r0, #4
 1172              	.LVL109:
 1173 0054 FFF7FEFF 		bl	readRegister
 1174              	.LVL110:
 1175 0058 0640     		ands	r6, r6, r0
 1176              	.LVL111:
 1177              	.LBB9:
 189:Src/LTC6811.c **** 		cellVoltage[i] = voltage[i];
 1178              		.loc 1 189 0
 1179 005a 0023     		movs	r3, #0
 1180 005c 05E0     		b	.L54
ARM GAS  /tmp/ccouNvQA.s 			page 35


 1181              	.LVL112:
 1182              	.L55:
 190:Src/LTC6811.c **** 	}
 1183              		.loc 1 190 0 discriminator 3
 1184 005e 34F81320 		ldrh	r2, [r4, r3, lsl #1]
 1185 0062 25F81320 		strh	r2, [r5, r3, lsl #1]	@ movhi
 189:Src/LTC6811.c **** 		cellVoltage[i] = voltage[i];
 1186              		.loc 1 189 0 discriminator 3
 1187 0066 0133     		adds	r3, r3, #1
 1188              	.LVL113:
 1189 0068 DBB2     		uxtb	r3, r3
 1190              	.LVL114:
 1191              	.L54:
 189:Src/LTC6811.c **** 		cellVoltage[i] = voltage[i];
 1192              		.loc 1 189 0 is_stmt 0 discriminator 1
 1193 006a 0B2B     		cmp	r3, #11
 1194 006c F7D9     		bls	.L55
 1195              	.LBE9:
 193:Src/LTC6811.c **** 	
 1196              		.loc 1 193 0 is_stmt 1
 1197 006e 2046     		mov	r0, r4
 1198              	.LVL115:
 1199 0070 FFF7FEFF 		bl	free
 1200              	.LVL116:
 197:Src/LTC6811.c **** 
 1201              		.loc 1 197 0
 1202 0074 3046     		mov	r0, r6
 1203 0076 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 1204              		.cfi_endproc
 1205              	.LFE69:
 1207              		.section	.text.readAllCellVoltages,"ax",%progbits
 1208              		.align	1
 1209              		.global	readAllCellVoltages
 1210              		.syntax unified
 1211              		.thumb
 1212              		.thumb_func
 1213              		.fpu softvfp
 1215              	readAllCellVoltages:
 1216              	.LFB70:
 199:Src/LTC6811.c **** 
 1217              		.loc 1 199 0
 1218              		.cfi_startproc
 1219              		@ args = 100, pretend = 16, frame = 0
 1220              		@ frame_needed = 1, uses_anonymous_args = 0
 1221              	.LVL117:
 1222 0000 84B0     		sub	sp, sp, #16
 1223              	.LCFI32:
 1224              		.cfi_def_cfa_offset 16
 1225 0002 2DE9F047 		push	{r4, r5, r6, r7, r8, r9, r10, lr}
 1226              	.LCFI33:
 1227              		.cfi_def_cfa_offset 48
 1228              		.cfi_offset 4, -48
 1229              		.cfi_offset 5, -44
 1230              		.cfi_offset 6, -40
 1231              		.cfi_offset 7, -36
 1232              		.cfi_offset 8, -32
 1233              		.cfi_offset 9, -28
ARM GAS  /tmp/ccouNvQA.s 			page 36


 1234              		.cfi_offset 10, -24
 1235              		.cfi_offset 14, -20
 1236 0006 00AF     		add	r7, sp, #0
 1237              	.LCFI34:
 1238              		.cfi_def_cfa_register 7
 1239 0008 07F12004 		add	r4, r7, #32
 1240 000c 84E80F00 		stm	r4, {r0, r1, r2, r3}
 1241 0010 D7F88040 		ldr	r4, [r7, #128]
 201:Src/LTC6811.c **** 	bool PEC_check[cfg.numOfICs];
 1242              		.loc 1 201 0
 1243 0014 97F84130 		ldrb	r3, [r7, #65]	@ zero_extendqisi2
 1244              	.LVL118:
 1245 0018 5B00     		lsls	r3, r3, #1
 1246              	.LVL119:
 1247 001a 0833     		adds	r3, r3, #8
 1248 001c 03F47E73 		and	r3, r3, #1016
 1249 0020 ADEB030D 		sub	sp, sp, r3
 1250 0024 6D46     		mov	r5, sp
 1251              	.LVL120:
 202:Src/LTC6811.c **** 	bool dataValid = true;
 1252              		.loc 1 202 0
 1253 0026 97F820A0 		ldrb	r10, [r7, #32]	@ zero_extendqisi2
 1254              	.LVL121:
 1255 002a 0AF10703 		add	r3, r10, #7
 1256 002e 03F4FC73 		and	r3, r3, #504
 1257 0032 ADEB030D 		sub	sp, sp, r3
 1258 0036 E946     		mov	r9, sp
 1259              	.LVL122:
 1260              	.LBB10:
 205:Src/LTC6811.c **** 
 1261              		.loc 1 205 0
 1262 0038 0026     		movs	r6, #0
 1263 003a 61E0     		b	.L58
 1264              	.LVL123:
 1265              	.L60:
 1266              	.LBB11:
 212:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][1] = (uint8_t) (0x02 & (PEC_check[board] << 1)); /
 1267              		.loc 1 212 0 discriminator 3
 1268 003c 03FB06F2 		mul	r2, r3, r6
 1269 0040 D2B2     		uxtb	r2, r2
 1270 0042 0A44     		add	r2, r2, r1
 1271 0044 D2B2     		uxtb	r2, r2
 1272 0046 03FB0813 		mla	r3, r3, r8, r1
 1273 004a 03EB4303 		add	r3, r3, r3, lsl #1
 1274 004e 4FEA430C 		lsl	ip, r3, #1
 1275 0052 04EB0C00 		add	r0, r4, ip
 1276 0056 531C     		adds	r3, r2, #1
 1277 0058 04F80C30 		strb	r3, [r4, ip]
 213:Src/LTC6811.c **** 		}
 1278              		.loc 1 213 0 discriminator 3
 1279 005c 19F80830 		ldrb	r3, [r9, r8]	@ zero_extendqisi2
 1280 0060 5B00     		lsls	r3, r3, #1
 1281 0062 03F00203 		and	r3, r3, #2
 1282 0066 4370     		strb	r3, [r0, #1]
 211:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][0] = (uint8_t) ((board * cfg.numOfCellsPerIC) + ce
 1283              		.loc 1 211 0 discriminator 3
 1284 0068 0131     		adds	r1, r1, #1
ARM GAS  /tmp/ccouNvQA.s 			page 37


 1285              	.LVL124:
 1286 006a C9B2     		uxtb	r1, r1
 1287              	.LVL125:
 1288              	.L59:
 211:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][0] = (uint8_t) ((board * cfg.numOfCellsPerIC) + ce
 1289              		.loc 1 211 0 is_stmt 0 discriminator 1
 1290 006c 97F84230 		ldrb	r3, [r7, #66]	@ zero_extendqisi2
 1291 0070 9942     		cmp	r1, r3
 1292 0072 E3D3     		bcc	.L60
 1293              	.LBE11:
 217:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 0][3] = (uint8_t) (boardVoltage[0] & 0xFF); //cell 1, vol
 1294              		.loc 1 217 0 is_stmt 1 discriminator 2
 1295 0074 2988     		ldrh	r1, [r5]
 1296              	.LVL126:
 1297 0076 03FB08F3 		mul	r3, r3, r8
 1298 007a 03EB4300 		add	r0, r3, r3, lsl #1
 1299 007e 4200     		lsls	r2, r0, #1
 1300 0080 A018     		adds	r0, r4, r2
 1301 0082 090A     		lsrs	r1, r1, #8
 1302 0084 8170     		strb	r1, [r0, #2]
 218:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 1][2] = (uint8_t) ((boardVoltage[1] >> 8) & 0xFF); //cell
 1303              		.loc 1 218 0 discriminator 2
 1304 0086 2978     		ldrb	r1, [r5]	@ zero_extendqisi2
 1305 0088 C170     		strb	r1, [r0, #3]
 219:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 1][3] = (uint8_t) (boardVoltage[1] & 0xFF); //cell 2, vol
 1306              		.loc 1 219 0 discriminator 2
 1307 008a 6888     		ldrh	r0, [r5, #2]
 1308 008c 0133     		adds	r3, r3, #1
 1309 008e 03EB4303 		add	r3, r3, r3, lsl #1
 1310 0092 5900     		lsls	r1, r3, #1
 1311 0094 6318     		adds	r3, r4, r1
 1312 0096 010A     		lsrs	r1, r0, #8
 1313 0098 9970     		strb	r1, [r3, #2]
 220:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 2][2] = (uint8_t) ((boardVoltage[2] >> 8) & 0xFF); //cell
 1314              		.loc 1 220 0 discriminator 2
 1315 009a A978     		ldrb	r1, [r5, #2]	@ zero_extendqisi2
 1316 009c D970     		strb	r1, [r3, #3]
 221:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 2][3] = (uint8_t) (boardVoltage[2] & 0xFF); //cell 3, vol
 1317              		.loc 1 221 0 discriminator 2
 1318 009e A988     		ldrh	r1, [r5, #4]
 1319 00a0 02F10C03 		add	r3, r2, #12
 1320 00a4 2344     		add	r3, r3, r4
 1321 00a6 090A     		lsrs	r1, r1, #8
 1322 00a8 9970     		strb	r1, [r3, #2]
 222:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 3][2] = (uint8_t) ((boardVoltage[3] >> 8) & 0xFF); //cell
 1323              		.loc 1 222 0 discriminator 2
 1324 00aa 2979     		ldrb	r1, [r5, #4]	@ zero_extendqisi2
 1325 00ac D970     		strb	r1, [r3, #3]
 223:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 3][3] = (uint8_t) (boardVoltage[3] & 0xFF); //cell 4, vol
 1326              		.loc 1 223 0 discriminator 2
 1327 00ae E988     		ldrh	r1, [r5, #6]
 1328 00b0 02F11203 		add	r3, r2, #18
 1329 00b4 2344     		add	r3, r3, r4
 1330 00b6 090A     		lsrs	r1, r1, #8
 1331 00b8 9970     		strb	r1, [r3, #2]
 224:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 4][2] = (uint8_t) ((boardVoltage[6] >> 8) & 0xFF); //cell
 1332              		.loc 1 224 0 discriminator 2
ARM GAS  /tmp/ccouNvQA.s 			page 38


 1333 00ba A979     		ldrb	r1, [r5, #6]	@ zero_extendqisi2
 1334 00bc D970     		strb	r1, [r3, #3]
 225:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 4][3] = (uint8_t) (boardVoltage[6] & 0xFF); //cell 7, vol
 1335              		.loc 1 225 0 discriminator 2
 1336 00be A989     		ldrh	r1, [r5, #12]
 1337 00c0 02F11803 		add	r3, r2, #24
 1338 00c4 2344     		add	r3, r3, r4
 1339 00c6 090A     		lsrs	r1, r1, #8
 1340 00c8 9970     		strb	r1, [r3, #2]
 226:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 5][2] = (uint8_t) ((boardVoltage[7] >> 8) & 0xFF); //cell
 1341              		.loc 1 226 0 discriminator 2
 1342 00ca 297B     		ldrb	r1, [r5, #12]	@ zero_extendqisi2
 1343 00cc D970     		strb	r1, [r3, #3]
 227:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 5][3] = (uint8_t) (boardVoltage[7] & 0xFF); //cell 8, vol
 1344              		.loc 1 227 0 discriminator 2
 1345 00ce E989     		ldrh	r1, [r5, #14]
 1346 00d0 02F11E03 		add	r3, r2, #30
 1347 00d4 2344     		add	r3, r3, r4
 1348 00d6 090A     		lsrs	r1, r1, #8
 1349 00d8 9970     		strb	r1, [r3, #2]
 228:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 6][2] = (uint8_t) ((boardVoltage[8] >> 8) & 0xFF); //cell
 1350              		.loc 1 228 0 discriminator 2
 1351 00da A97B     		ldrb	r1, [r5, #14]	@ zero_extendqisi2
 1352 00dc D970     		strb	r1, [r3, #3]
 229:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 6][3] = (uint8_t) (boardVoltage[8] & 0xFF); //cell 9, vol
 1353              		.loc 1 229 0 discriminator 2
 1354 00de 298A     		ldrh	r1, [r5, #16]
 1355 00e0 02F12403 		add	r3, r2, #36
 1356 00e4 2344     		add	r3, r3, r4
 1357 00e6 090A     		lsrs	r1, r1, #8
 1358 00e8 9970     		strb	r1, [r3, #2]
 230:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 7][2] = (uint8_t) ((boardVoltage[9] >> 8) & 0xFF); //cell
 1359              		.loc 1 230 0 discriminator 2
 1360 00ea 297C     		ldrb	r1, [r5, #16]	@ zero_extendqisi2
 1361 00ec D970     		strb	r1, [r3, #3]
 231:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 7][3] = (uint8_t) (boardVoltage[9] & 0xFF); //cell 10, vo
 1362              		.loc 1 231 0 discriminator 2
 1363 00ee 6B8A     		ldrh	r3, [r5, #18]
 1364 00f0 2A32     		adds	r2, r2, #42
 1365 00f2 2244     		add	r2, r2, r4
 1366 00f4 1B0A     		lsrs	r3, r3, #8
 1367 00f6 9370     		strb	r3, [r2, #2]
 232:Src/LTC6811.c **** 	
 1368              		.loc 1 232 0 discriminator 2
 1369 00f8 AB7C     		ldrb	r3, [r5, #18]	@ zero_extendqisi2
 1370 00fa D370     		strb	r3, [r2, #3]
 205:Src/LTC6811.c **** 
 1371              		.loc 1 205 0 discriminator 2
 1372 00fc 0136     		adds	r6, r6, #1
 1373              	.LVL127:
 1374 00fe F6B2     		uxtb	r6, r6
 1375              	.LVL128:
 1376              	.L58:
 205:Src/LTC6811.c **** 
 1377              		.loc 1 205 0 is_stmt 0 discriminator 1
 1378 0100 5645     		cmp	r6, r10
 1379 0102 0BD2     		bcs	.L67
ARM GAS  /tmp/ccouNvQA.s 			page 39


 208:Src/LTC6811.c **** 
 1380              		.loc 1 208 0 is_stmt 1
 1381 0104 B046     		mov	r8, r6
 1382 0106 07F12003 		add	r3, r7, #32
 1383 010a 3344     		add	r3, r3, r6
 1384 010c 2946     		mov	r1, r5
 1385 010e 5878     		ldrb	r0, [r3, #1]	@ zero_extendqisi2
 1386 0110 FFF7FEFF 		bl	readCellVoltage
 1387              	.LVL129:
 1388 0114 09F80600 		strb	r0, [r9, r6]
 1389              	.LVL130:
 1390              	.LBB12:
 211:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][0] = (uint8_t) ((board * cfg.numOfCellsPerIC) + ce
 1391              		.loc 1 211 0
 1392 0118 0021     		movs	r1, #0
 1393 011a A7E7     		b	.L59
 1394              	.LVL131:
 1395              	.L67:
 1396              	.LBE12:
 1397              	.LBE10:
 1398              	.LBB13:
 236:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 1399              		.loc 1 236 0
 1400 011c 0023     		movs	r3, #0
 1401              	.LBE13:
 203:Src/LTC6811.c **** 
 1402              		.loc 1 203 0
 1403 011e 0120     		movs	r0, #1
 1404 0120 01E0     		b	.L62
 1405              	.LVL132:
 1406              	.L63:
 1407              	.LBB14:
 236:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 1408              		.loc 1 236 0 discriminator 2
 1409 0122 0133     		adds	r3, r3, #1
 1410              	.LVL133:
 1411 0124 DBB2     		uxtb	r3, r3
 1412              	.LVL134:
 1413              	.L62:
 236:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 1414              		.loc 1 236 0 is_stmt 0 discriminator 1
 1415 0126 5345     		cmp	r3, r10
 1416 0128 05D2     		bcs	.L68
 237:Src/LTC6811.c **** 			dataValid = false;
 1417              		.loc 1 237 0 is_stmt 1
 1418 012a 19F80320 		ldrb	r2, [r9, r3]	@ zero_extendqisi2
 1419 012e 002A     		cmp	r2, #0
 1420 0130 F7D1     		bne	.L63
 238:Src/LTC6811.c **** 	}
 1421              		.loc 1 238 0
 1422 0132 1046     		mov	r0, r2
 1423              	.LVL135:
 1424 0134 F5E7     		b	.L63
 1425              	.LVL136:
 1426              	.L68:
 1427              	.LBE14:
 242:Src/LTC6811.c **** 
ARM GAS  /tmp/ccouNvQA.s 			page 40


 1428              		.loc 1 242 0
 1429 0136 BD46     		mov	sp, r7
 1430              	.LCFI35:
 1431              		.cfi_def_cfa_register 13
 1432              		@ sp needed
 1433 0138 BDE8F047 		pop	{r4, r5, r6, r7, r8, r9, r10, lr}
 1434              	.LCFI36:
 1435              		.cfi_restore 14
 1436              		.cfi_restore 10
 1437              		.cfi_restore 9
 1438              		.cfi_restore 8
 1439              		.cfi_restore 7
 1440              		.cfi_restore 6
 1441              		.cfi_restore 5
 1442              		.cfi_restore 4
 1443              		.cfi_def_cfa_offset 16
 1444              	.LVL137:
 1445 013c 04B0     		add	sp, sp, #16
 1446              	.LCFI37:
 1447              		.cfi_def_cfa_offset 0
 1448 013e 7047     		bx	lr
 1449              		.cfi_endproc
 1450              	.LFE70:
 1452              		.section	.text.checkAllCellConnections,"ax",%progbits
 1453              		.align	1
 1454              		.global	checkAllCellConnections
 1455              		.syntax unified
 1456              		.thumb
 1457              		.thumb_func
 1458              		.fpu softvfp
 1460              	checkAllCellConnections:
 1461              	.LFB74:
 380:Src/LTC6811.c **** 	
 1462              		.loc 1 380 0
 1463              		.cfi_startproc
 1464              		@ args = 100, pretend = 16, frame = 0
 1465              		@ frame_needed = 1, uses_anonymous_args = 0
 1466              	.LVL138:
 1467 0000 84B0     		sub	sp, sp, #16
 1468              	.LCFI38:
 1469              		.cfi_def_cfa_offset 16
 1470 0002 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 1471              	.LCFI39:
 1472              		.cfi_def_cfa_offset 40
 1473              		.cfi_offset 4, -40
 1474              		.cfi_offset 5, -36
 1475              		.cfi_offset 6, -32
 1476              		.cfi_offset 7, -28
 1477              		.cfi_offset 8, -24
 1478              		.cfi_offset 14, -20
 1479 0006 00AF     		add	r7, sp, #0
 1480              	.LCFI40:
 1481              		.cfi_def_cfa_register 7
 1482 0008 07F11804 		add	r4, r7, #24
 1483 000c 84E80F00 		stm	r4, {r0, r1, r2, r3}
 1484 0010 D7F87880 		ldr	r8, [r7, #120]
 382:Src/LTC6811.c **** 	uint16_t cellVoltage;
ARM GAS  /tmp/ccouNvQA.s 			page 41


 1485              		.loc 1 382 0
 1486 0014 97F83930 		ldrb	r3, [r7, #57]	@ zero_extendqisi2
 1487              	.LVL139:
 1488 0018 5B00     		lsls	r3, r3, #1
 1489              	.LVL140:
 1490 001a 0833     		adds	r3, r3, #8
 1491 001c 03F47E73 		and	r3, r3, #1016
 1492 0020 ADEB030D 		sub	sp, sp, r3
 1493 0024 6D46     		mov	r5, sp
 1494              	.LVL141:
 387:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 1495              		.loc 1 387 0
 1496 0026 40F22920 		movw	r0, #553
 1497 002a FFF7FEFF 		bl	sendBroadcastCommand
 1498              	.LVL142:
 388:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 1499              		.loc 1 388 0
 1500 002e 40F22920 		movw	r0, #553
 1501 0032 FFF7FEFF 		bl	sendBroadcastCommand
 1502              	.LVL143:
 389:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 1503              		.loc 1 389 0
 1504 0036 40F22920 		movw	r0, #553
 1505 003a FFF7FEFF 		bl	sendBroadcastCommand
 1506              	.LVL144:
 390:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 1507              		.loc 1 390 0
 1508 003e 40F22920 		movw	r0, #553
 1509 0042 FFF7FEFF 		bl	sendBroadcastCommand
 1510              	.LVL145:
 391:Src/LTC6811.c **** 
 1511              		.loc 1 391 0
 1512 0046 40F22920 		movw	r0, #553
 1513 004a FFF7FEFF 		bl	sendBroadcastCommand
 1514              	.LVL146:
 393:Src/LTC6811.c **** 
 1515              		.loc 1 393 0
 1516 004e 0F20     		movs	r0, #15
 1517 0050 FFF7FEFF 		bl	HAL_Delay
 1518              	.LVL147:
 1519              	.LBB15:
 395:Src/LTC6811.c **** 
 1520              		.loc 1 395 0
 1521 0054 0024     		movs	r4, #0
 1522 0056 22E0     		b	.L70
 1523              	.LVL148:
 1524              	.L72:
 1525              	.LBB16:
 409:Src/LTC6811.c **** 		}
 1526              		.loc 1 409 0
 1527 0058 5A78     		ldrb	r2, [r3, #1]	@ zero_extendqisi2
 1528 005a 42F00102 		orr	r2, r2, #1
 1529 005e 5A70     		strb	r2, [r3, #1]
 1530              	.LVL149:
 1531              	.L73:
 399:Src/LTC6811.c **** 
 1532              		.loc 1 399 0 discriminator 2
ARM GAS  /tmp/ccouNvQA.s 			page 42


 1533 0060 0131     		adds	r1, r1, #1
 1534              	.LVL150:
 1535 0062 C9B2     		uxtb	r1, r1
 1536              	.LVL151:
 1537              	.L71:
 399:Src/LTC6811.c **** 
 1538              		.loc 1 399 0 is_stmt 0 discriminator 1
 1539 0064 97F83A30 		ldrb	r3, [r7, #58]	@ zero_extendqisi2
 1540 0068 9942     		cmp	r1, r3
 1541 006a 16D2     		bcs	.L77
 1542              	.LVL152:
 402:Src/LTC6811.c **** 			cellVoltage = cellVoltage << 8;
 1543              		.loc 1 402 0 is_stmt 1
 1544 006c 03FB0613 		mla	r3, r3, r6, r1
 1545 0070 03EB4303 		add	r3, r3, r3, lsl #1
 1546 0074 5A00     		lsls	r2, r3, #1
 1547 0076 08EB0203 		add	r3, r8, r2
 1548 007a 9878     		ldrb	r0, [r3, #2]	@ zero_extendqisi2
 1549              	.LVL153:
 404:Src/LTC6811.c **** 
 1550              		.loc 1 404 0
 1551 007c DA78     		ldrb	r2, [r3, #3]	@ zero_extendqisi2
 1552 007e 02EB0022 		add	r2, r2, r0, lsl #8
 1553 0082 92B2     		uxth	r2, r2
 1554              	.LVL154:
 406:Src/LTC6811.c **** 				bmsData[(board * cfg.numOfCellsPerIC) + cell][1] &= 0xFE;
 1555              		.loc 1 406 0
 1556 0084 35F81100 		ldrh	r0, [r5, r1, lsl #1]
 1557 0088 121A     		subs	r2, r2, r0
 1558              	.LVL155:
 1559 008a B2F57A7F 		cmp	r2, #1000
 1560 008e E3DD     		ble	.L72
 407:Src/LTC6811.c **** 			else
 1561              		.loc 1 407 0
 1562 0090 5A78     		ldrb	r2, [r3, #1]	@ zero_extendqisi2
 1563 0092 22F00102 		bic	r2, r2, #1
 1564 0096 5A70     		strb	r2, [r3, #1]
 1565 0098 E2E7     		b	.L73
 1566              	.LVL156:
 1567              	.L77:
 1568              	.LBE16:
 395:Src/LTC6811.c **** 
 1569              		.loc 1 395 0 discriminator 2
 1570 009a 0134     		adds	r4, r4, #1
 1571              	.LVL157:
 1572 009c E4B2     		uxtb	r4, r4
 1573              	.LVL158:
 1574              	.L70:
 395:Src/LTC6811.c **** 
 1575              		.loc 1 395 0 is_stmt 0 discriminator 1
 1576 009e 3B7E     		ldrb	r3, [r7, #24]	@ zero_extendqisi2
 1577 00a0 9C42     		cmp	r4, r3
 1578 00a2 09D2     		bcs	.L78
 397:Src/LTC6811.c **** 
 1579              		.loc 1 397 0 is_stmt 1
 1580 00a4 2646     		mov	r6, r4
 1581 00a6 07F11803 		add	r3, r7, #24
ARM GAS  /tmp/ccouNvQA.s 			page 43


 1582 00aa 2344     		add	r3, r3, r4
 1583 00ac 2946     		mov	r1, r5
 1584 00ae 5878     		ldrb	r0, [r3, #1]	@ zero_extendqisi2
 1585 00b0 FFF7FEFF 		bl	readCellVoltage
 1586              	.LVL159:
 1587              	.LBB17:
 399:Src/LTC6811.c **** 
 1588              		.loc 1 399 0
 1589 00b4 0021     		movs	r1, #0
 1590 00b6 D5E7     		b	.L71
 1591              	.LVL160:
 1592              	.L78:
 1593              	.LBE17:
 1594              	.LBE15:
 414:Src/LTC6811.c **** 
 1595              		.loc 1 414 0
 1596 00b8 0020     		movs	r0, #0
 1597 00ba BD46     		mov	sp, r7
 1598              	.LCFI41:
 1599              		.cfi_def_cfa_register 13
 1600              		@ sp needed
 1601 00bc BDE8F041 		pop	{r4, r5, r6, r7, r8, lr}
 1602              	.LCFI42:
 1603              		.cfi_restore 14
 1604              		.cfi_restore 8
 1605              		.cfi_restore 7
 1606              		.cfi_restore 6
 1607              		.cfi_restore 5
 1608              		.cfi_restore 4
 1609              		.cfi_def_cfa_offset 16
 1610              	.LVL161:
 1611 00c0 04B0     		add	sp, sp, #16
 1612              	.LCFI43:
 1613              		.cfi_def_cfa_offset 0
 1614 00c2 7047     		bx	lr
 1615              		.cfi_endproc
 1616              	.LFE74:
 1618              		.global	__aeabi_ui2d
 1619              		.global	__aeabi_ddiv
 1620              		.global	__aeabi_dmul
 1621              		.global	__aeabi_dsub
 1622              		.global	__aeabi_dadd
 1623              		.global	__aeabi_d2uiz
 1624              		.section	.text.readCellTemp,"ax",%progbits
 1625              		.align	1
 1626              		.global	readCellTemp
 1627              		.syntax unified
 1628              		.thumb
 1629              		.thumb_func
 1630              		.fpu softvfp
 1632              	readCellTemp:
 1633              	.LFB71:
 244:Src/LTC6811.c **** 	
 1634              		.loc 1 244 0
 1635              		.cfi_startproc
 1636              		@ args = 0, pretend = 0, frame = 16
 1637              		@ frame_needed = 0, uses_anonymous_args = 0
ARM GAS  /tmp/ccouNvQA.s 			page 44


 1638              	.LVL162:
 1639 0000 2DE9F04F 		push	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 1640              	.LCFI44:
 1641              		.cfi_def_cfa_offset 36
 1642              		.cfi_offset 4, -36
 1643              		.cfi_offset 5, -32
 1644              		.cfi_offset 6, -28
 1645              		.cfi_offset 7, -24
 1646              		.cfi_offset 8, -20
 1647              		.cfi_offset 9, -16
 1648              		.cfi_offset 10, -12
 1649              		.cfi_offset 11, -8
 1650              		.cfi_offset 14, -4
 1651 0004 85B0     		sub	sp, sp, #20
 1652              	.LCFI45:
 1653              		.cfi_def_cfa_offset 56
 1654 0006 0446     		mov	r4, r0
 1655 0008 8B46     		mov	fp, r1
 1656 000a 1646     		mov	r6, r2
 1657 000c 1F46     		mov	r7, r3
 1658              	.LVL163:
 252:Src/LTC6811.c **** 	
 1659              		.loc 1 252 0
 1660 000e 0820     		movs	r0, #8
 1661              	.LVL164:
 1662 0010 FFF7FEFF 		bl	malloc
 1663              	.LVL165:
 1664 0014 8246     		mov	r10, r0
 1665              	.LVL166:
 254:Src/LTC6811.c **** 	
 1666              		.loc 1 254 0
 1667 0016 2146     		mov	r1, r4
 1668 0018 4FF48C60 		mov	r0, #1120
 1669              	.LVL167:
 1670 001c FFF7FEFF 		bl	sendAddressCommand
 1671              	.LVL168:
 256:Src/LTC6811.c **** 	
 1672              		.loc 1 256 0
 1673 0020 0F20     		movs	r0, #15
 1674 0022 FFF7FEFF 		bl	HAL_Delay
 1675              	.LVL169:
 258:Src/LTC6811.c **** 	//dataValid = dataValid & PEC_check;
 1676              		.loc 1 258 0
 1677 0026 5246     		mov	r2, r10
 1678 0028 2146     		mov	r1, r4
 1679 002a 0C20     		movs	r0, #12
 1680 002c FFF7FEFF 		bl	readRegister
 1681              	.LVL170:
 260:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 1682              		.loc 1 260 0
 1683 0030 5246     		mov	r2, r10
 1684 0032 2146     		mov	r1, r4
 1685 0034 0E20     		movs	r0, #14
 1686 0036 FFF7FEFF 		bl	readRegister
 1687              	.LVL171:
 1688 003a 0546     		mov	r5, r0
 1689              	.LVL172:
ARM GAS  /tmp/ccouNvQA.s 			page 45


 262:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 1690              		.loc 1 262 0
 1691 003c 5246     		mov	r2, r10
 1692 003e 2146     		mov	r1, r4
 1693 0040 0C20     		movs	r0, #12
 1694 0042 FFF7FEFF 		bl	readRegister
 1695              	.LVL173:
 1696 0046 2840     		ands	r0, r0, r5
 1697              	.LVL174:
 1698 0048 C3B2     		uxtb	r3, r0
 1699 004a 0393     		str	r3, [sp, #12]
 1700              	.LVL175:
 1701              	.LBB18:
 265:Src/LTC6811.c **** 		if ((temp[i] > 24400) || (temp[i] < 13000)) {
 1702              		.loc 1 265 0
 1703 004c 0025     		movs	r5, #0
 1704 004e 10E0     		b	.L80
 1705              	.LVL176:
 1706              	.L81:
 271:Src/LTC6811.c **** 		
 1707              		.loc 1 271 0
 1708 0050 0023     		movs	r3, #0
 1709 0052 7355     		strb	r3, [r6, r5]
 1710 0054 21E0     		b	.L82
 1711              	.L83:
 278:Src/LTC6811.c **** 		
 1712              		.loc 1 278 0
 1713 0056 0023     		movs	r3, #0
 1714 0058 BB54     		strb	r3, [r7, r2]
 1715              	.L84:
 280:Src/LTC6811.c **** 			dummy[i] = (double) temp[i] / 10000; // convert from ADC value to voltage
 1716              		.loc 1 280 0
 1717 005a 3AF80400 		ldrh	r0, [r10, r4]
 1718 005e A0F56B53 		sub	r3, r0, #15040
 1719 0062 3C3B     		subs	r3, r3, #60
 1720 0064 9BB2     		uxth	r3, r3
 1721 0066 42F25442 		movw	r2, #9300
 1722 006a 9342     		cmp	r3, r2
 1723 006c 26D9     		bls	.L88
 1724              	.L85:
 265:Src/LTC6811.c **** 		if ((temp[i] > 24400) || (temp[i] < 13000)) {
 1725              		.loc 1 265 0 discriminator 2
 1726 006e 0135     		adds	r5, r5, #1
 1727              	.LVL177:
 1728 0070 EDB2     		uxtb	r5, r5
 1729              	.LVL178:
 1730              	.L80:
 265:Src/LTC6811.c **** 		if ((temp[i] > 24400) || (temp[i] < 13000)) {
 1731              		.loc 1 265 0 is_stmt 0 discriminator 1
 1732 0072 032D     		cmp	r5, #3
 1733 0074 00F2A480 		bhi	.L89
 266:Src/LTC6811.c **** 			dcFault[i] = true;
 1734              		.loc 1 266 0 is_stmt 1
 1735 0078 2A46     		mov	r2, r5
 1736 007a 6C00     		lsls	r4, r5, #1
 1737 007c 3AF81530 		ldrh	r3, [r10, r5, lsl #1]
 1738 0080 A3F54B53 		sub	r3, r3, #12992
ARM GAS  /tmp/ccouNvQA.s 			page 46


 1739 0084 083B     		subs	r3, r3, #8
 1740 0086 9BB2     		uxth	r3, r3
 1741 0088 42F68841 		movw	r1, #11400
 1742 008c 8B42     		cmp	r3, r1
 1743 008e DFD9     		bls	.L81
 267:Src/LTC6811.c **** 			cellTemp[i] = 0x0000;
 1744              		.loc 1 267 0
 1745 0090 0123     		movs	r3, #1
 1746 0092 7355     		strb	r3, [r6, r5]
 268:Src/LTC6811.c **** 		}
 1747              		.loc 1 268 0
 1748 0094 0023     		movs	r3, #0
 1749 0096 2BF81530 		strh	r3, [fp, r5, lsl #1]	@ movhi
 1750              	.L82:
 273:Src/LTC6811.c **** 			tempFault[i] = true;
 1751              		.loc 1 273 0
 1752 009a 3AF80430 		ldrh	r3, [r10, r4]
 1753 009e A3F54B53 		sub	r3, r3, #12992
 1754 00a2 083B     		subs	r3, r3, #8
 1755 00a4 9BB2     		uxth	r3, r3
 1756 00a6 40F63301 		movw	r1, #2099
 1757 00aa 8B42     		cmp	r3, r1
 1758 00ac D3D8     		bhi	.L83
 274:Src/LTC6811.c **** 			cellTemp[i] = 0xFFFF;
 1759              		.loc 1 274 0
 1760 00ae 0123     		movs	r3, #1
 1761 00b0 BB54     		strb	r3, [r7, r2]
 275:Src/LTC6811.c **** 		}
 1762              		.loc 1 275 0
 1763 00b2 4FF6FF73 		movw	r3, #65535
 1764 00b6 2BF80430 		strh	r3, [fp, r4]	@ movhi
 1765 00ba CEE7     		b	.L84
 1766              	.L88:
 281:Src/LTC6811.c **** 			// convert from voltage to temperature
 1767              		.loc 1 281 0
 1768 00bc FFF7FEFF 		bl	__aeabi_ui2d
 1769              	.LVL179:
 1770 00c0 43A3     		adr	r3, .L90
 1771 00c2 D3E90023 		ldrd	r2, [r3]
 1772 00c6 FFF7FEFF 		bl	__aeabi_ddiv
 1773              	.LVL180:
 1774 00ca CDE90001 		strd	r0, [sp]
 283:Src/LTC6811.c **** 			conversion[i] = 500 * (conversion[i] + 20); // map value to larger range
 1775              		.loc 1 283 0
 1776 00ce 42A3     		adr	r3, .L90+8
 1777 00d0 D3E90023 		ldrd	r2, [r3]
 1778 00d4 FFF7FEFF 		bl	__aeabi_dmul
 1779              	.LVL181:
 1780 00d8 0246     		mov	r2, r0
 1781 00da 0B46     		mov	r3, r1
 1782 00dc 40A1     		adr	r1, .L90+16
 1783 00de D1E90001 		ldrd	r0, [r1]
 1784 00e2 FFF7FEFF 		bl	__aeabi_dsub
 1785              	.LVL182:
 1786 00e6 8046     		mov	r8, r0
 1787 00e8 8946     		mov	r9, r1
 1788 00ea 0022     		movs	r2, #0
ARM GAS  /tmp/ccouNvQA.s 			page 47


 1789 00ec 4FF08043 		mov	r3, #1073741824
 1790 00f0 DDE90001 		ldrd	r0, [sp]
 1791 00f4 FFF7FEFF 		bl	pow
 1792              	.LVL183:
 1793 00f8 3BA3     		adr	r3, .L90+24
 1794 00fa D3E90023 		ldrd	r2, [r3]
 1795 00fe FFF7FEFF 		bl	__aeabi_dmul
 1796              	.LVL184:
 1797 0102 0246     		mov	r2, r0
 1798 0104 0B46     		mov	r3, r1
 1799 0106 4046     		mov	r0, r8
 1800 0108 4946     		mov	r1, r9
 1801 010a FFF7FEFF 		bl	__aeabi_dadd
 1802              	.LVL185:
 1803 010e 8046     		mov	r8, r0
 1804 0110 8946     		mov	r9, r1
 1805 0112 0022     		movs	r2, #0
 1806 0114 3E4B     		ldr	r3, .L90+64
 1807 0116 DDE90001 		ldrd	r0, [sp]
 1808 011a FFF7FEFF 		bl	pow
 1809              	.LVL186:
 1810 011e 34A3     		adr	r3, .L90+32
 1811 0120 D3E90023 		ldrd	r2, [r3]
 1812 0124 FFF7FEFF 		bl	__aeabi_dmul
 1813              	.LVL187:
 1814 0128 0246     		mov	r2, r0
 1815 012a 0B46     		mov	r3, r1
 1816 012c 4046     		mov	r0, r8
 1817 012e 4946     		mov	r1, r9
 1818 0130 FFF7FEFF 		bl	__aeabi_dsub
 1819              	.LVL188:
 1820 0134 8046     		mov	r8, r0
 1821 0136 8946     		mov	r9, r1
 1822 0138 0022     		movs	r2, #0
 1823 013a 364B     		ldr	r3, .L90+68
 1824 013c DDE90001 		ldrd	r0, [sp]
 1825 0140 FFF7FEFF 		bl	pow
 1826              	.LVL189:
 1827 0144 2CA3     		adr	r3, .L90+40
 1828 0146 D3E90023 		ldrd	r2, [r3]
 1829 014a FFF7FEFF 		bl	__aeabi_dmul
 1830              	.LVL190:
 1831 014e 0246     		mov	r2, r0
 1832 0150 0B46     		mov	r3, r1
 1833 0152 4046     		mov	r0, r8
 1834 0154 4946     		mov	r1, r9
 1835 0156 FFF7FEFF 		bl	__aeabi_dadd
 1836              	.LVL191:
 1837 015a 8046     		mov	r8, r0
 1838 015c 8946     		mov	r9, r1
 1839 015e 0022     		movs	r2, #0
 1840 0160 2D4B     		ldr	r3, .L90+72
 1841 0162 DDE90001 		ldrd	r0, [sp]
 1842 0166 FFF7FEFF 		bl	pow
 1843              	.LVL192:
 1844 016a 25A3     		adr	r3, .L90+48
 1845 016c D3E90023 		ldrd	r2, [r3]
ARM GAS  /tmp/ccouNvQA.s 			page 48


 1846 0170 FFF7FEFF 		bl	__aeabi_dmul
 1847              	.LVL193:
 1848 0174 0246     		mov	r2, r0
 1849 0176 0B46     		mov	r3, r1
 1850 0178 4046     		mov	r0, r8
 1851 017a 4946     		mov	r1, r9
 1852 017c FFF7FEFF 		bl	__aeabi_dsub
 1853              	.LVL194:
 1854 0180 8046     		mov	r8, r0
 1855 0182 8946     		mov	r9, r1
 1856 0184 0022     		movs	r2, #0
 1857 0186 254B     		ldr	r3, .L90+76
 1858 0188 DDE90001 		ldrd	r0, [sp]
 1859 018c FFF7FEFF 		bl	pow
 1860              	.LVL195:
 1861 0190 1DA3     		adr	r3, .L90+56
 1862 0192 D3E90023 		ldrd	r2, [r3]
 1863 0196 FFF7FEFF 		bl	__aeabi_dmul
 1864              	.LVL196:
 1865 019a 0246     		mov	r2, r0
 1866 019c 0B46     		mov	r3, r1
 1867 019e 4046     		mov	r0, r8
 1868 01a0 4946     		mov	r1, r9
 1869 01a2 FFF7FEFF 		bl	__aeabi_dadd
 1870              	.LVL197:
 284:Src/LTC6811.c **** 			cellTemp[i] = (uint16_t) conversion[i];
 1871              		.loc 1 284 0
 1872 01a6 0022     		movs	r2, #0
 1873 01a8 1D4B     		ldr	r3, .L90+80
 1874 01aa FFF7FEFF 		bl	__aeabi_dadd
 1875              	.LVL198:
 1876 01ae 0022     		movs	r2, #0
 1877 01b0 1C4B     		ldr	r3, .L90+84
 1878 01b2 FFF7FEFF 		bl	__aeabi_dmul
 1879              	.LVL199:
 285:Src/LTC6811.c **** 		}
 1880              		.loc 1 285 0
 1881 01b6 FFF7FEFF 		bl	__aeabi_d2uiz
 1882              	.LVL200:
 1883 01ba 2BF80400 		strh	r0, [fp, r4]	@ movhi
 1884 01be 56E7     		b	.L85
 1885              	.L89:
 1886              	.LBE18:
 289:Src/LTC6811.c **** 	
 1887              		.loc 1 289 0
 1888 01c0 5046     		mov	r0, r10
 1889 01c2 FFF7FEFF 		bl	free
 1890              	.LVL201:
 293:Src/LTC6811.c **** 
 1891              		.loc 1 293 0
 1892 01c6 0398     		ldr	r0, [sp, #12]
 1893 01c8 05B0     		add	sp, sp, #20
 1894              	.LCFI46:
 1895              		.cfi_def_cfa_offset 36
 1896              		@ sp needed
 1897 01ca BDE8F08F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, pc}
 1898              	.LVL202:
ARM GAS  /tmp/ccouNvQA.s 			page 49


 1899              	.L91:
 1900 01ce 00BF     		.align	3
 1901              	.L90:
 1902 01d0 00000000 		.word	0
 1903 01d4 0088C340 		.word	1086556160
 1904 01d8 00000000 		.word	0
 1905 01dc 30D0FB40 		.word	1090244656
 1906 01e0 00000000 		.word	0
 1907 01e4 E06CE240 		.word	1088580832
 1908 01e8 00000000 		.word	0
 1909 01ec 386A0141 		.word	1090611768
 1910 01f0 00000000 		.word	0
 1911 01f4 1010F740 		.word	1089933328
 1912 01f8 00000000 		.word	0
 1913 01fc E0FDE040 		.word	1088486880
 1914 0200 00000000 		.word	0
 1915 0204 005DBA40 		.word	1085955328
 1916 0208 7B14AE47 		.word	1202590843
 1917 020c E1C88040 		.word	1082181857
 1918 0210 00000840 		.word	1074266112
 1919 0214 00001040 		.word	1074790400
 1920 0218 00001440 		.word	1075052544
 1921 021c 00001840 		.word	1075314688
 1922 0220 00003440 		.word	1077149696
 1923 0224 00407F40 		.word	1082081280
 1924              		.cfi_endproc
 1925              	.LFE71:
 1927              		.section	.text.readAllCellTemps,"ax",%progbits
 1928              		.align	1
 1929              		.global	readAllCellTemps
 1930              		.syntax unified
 1931              		.thumb
 1932              		.thumb_func
 1933              		.fpu softvfp
 1935              	readAllCellTemps:
 1936              	.LFB72:
 295:Src/LTC6811.c **** 
 1937              		.loc 1 295 0
 1938              		.cfi_startproc
 1939              		@ args = 100, pretend = 16, frame = 8
 1940              		@ frame_needed = 1, uses_anonymous_args = 0
 1941              	.LVL203:
 1942 0000 84B0     		sub	sp, sp, #16
 1943              	.LCFI47:
 1944              		.cfi_def_cfa_offset 16
 1945 0002 2DE9F04F 		push	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 1946              	.LCFI48:
 1947              		.cfi_def_cfa_offset 52
 1948              		.cfi_offset 4, -52
 1949              		.cfi_offset 5, -48
 1950              		.cfi_offset 6, -44
 1951              		.cfi_offset 7, -40
 1952              		.cfi_offset 8, -36
 1953              		.cfi_offset 9, -32
 1954              		.cfi_offset 10, -28
 1955              		.cfi_offset 11, -24
 1956              		.cfi_offset 14, -20
ARM GAS  /tmp/ccouNvQA.s 			page 50


 1957 0006 83B0     		sub	sp, sp, #12
 1958              	.LCFI49:
 1959              		.cfi_def_cfa_offset 64
 1960 0008 00AF     		add	r7, sp, #0
 1961              	.LCFI50:
 1962              		.cfi_def_cfa_register 7
 1963 000a 07F13004 		add	r4, r7, #48
 1964 000e 84E80F00 		stm	r4, {r0, r1, r2, r3}
 1965 0012 D7F89050 		ldr	r5, [r7, #144]
 297:Src/LTC6811.c **** 	bool boardDCFault[cfg.numOfTempPerIC];
 1966              		.loc 1 297 0
 1967 0016 97F85330 		ldrb	r3, [r7, #83]	@ zero_extendqisi2
 1968              	.LVL204:
 1969 001a 5A00     		lsls	r2, r3, #1
 1970 001c 0832     		adds	r2, r2, #8
 1971 001e 02F47E72 		and	r2, r2, #1016
 1972 0022 ADEB020D 		sub	sp, sp, r2
 1973 0026 6C46     		mov	r4, sp
 1974              	.LVL205:
 298:Src/LTC6811.c **** 	bool boardTempFault[cfg.numOfTempPerIC];
 1975              		.loc 1 298 0
 1976 0028 0733     		adds	r3, r3, #7
 1977              	.LVL206:
 1978 002a 03F4FC73 		and	r3, r3, #504
 1979              	.LVL207:
 1980 002e ADEB030D 		sub	sp, sp, r3
 1981 0032 EB46     		mov	fp, sp
 1982              	.LVL208:
 299:Src/LTC6811.c **** 	bool PEC_check[cfg.numOfICs];
 1983              		.loc 1 299 0
 1984 0034 ADEB030D 		sub	sp, sp, r3
 1985 0038 EA46     		mov	r10, sp
 1986              	.LVL209:
 300:Src/LTC6811.c **** 	bool dataValid = true;
 1987              		.loc 1 300 0
 1988 003a 97F83030 		ldrb	r3, [r7, #48]	@ zero_extendqisi2
 1989 003e 7B60     		str	r3, [r7, #4]
 1990              	.LVL210:
 1991 0040 0733     		adds	r3, r3, #7
 1992              	.LVL211:
 1993 0042 03F4FC73 		and	r3, r3, #504
 1994 0046 ADEB030D 		sub	sp, sp, r3
 1995 004a E946     		mov	r9, sp
 1996              	.LVL212:
 1997              	.LBB19:
 303:Src/LTC6811.c **** 
 1998              		.loc 1 303 0
 1999 004c 4FF00008 		mov	r8, #0
 2000 0050 66E0     		b	.L93
 2001              	.LVL213:
 2002              	.L95:
 2003              	.LBB20:
 310:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][1] |= (boardTempFault[cell / 2] << 4);
 2004              		.loc 1 310 0 discriminator 3
 2005 0052 06FB0313 		mla	r3, r6, r3, r1
 2006 0056 03EB4303 		add	r3, r3, r3, lsl #1
 2007 005a 5A00     		lsls	r2, r3, #1
ARM GAS  /tmp/ccouNvQA.s 			page 51


 2008 005c 2A44     		add	r2, r2, r5
 2009 005e 19F80600 		ldrb	r0, [r9, r6]	@ zero_extendqisi2
 2010 0062 5378     		ldrb	r3, [r2, #1]	@ zero_extendqisi2
 2011 0064 03EA4003 		and	r3, r3, r0, lsl #1
 2012 0068 5BB2     		sxtb	r3, r3
 2013 006a 5370     		strb	r3, [r2, #1]
 311:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][1] |= (boardDCFault[cell / 2] >> 3);
 2014              		.loc 1 311 0 discriminator 3
 2015 006c 4808     		lsrs	r0, r1, #1
 2016 006e 1AF800C0 		ldrb	ip, [r10, r0]	@ zero_extendqisi2
 2017 0072 43EA0C13 		orr	r3, r3, ip, lsl #4
 2018 0076 5BB2     		sxtb	r3, r3
 2019 0078 5370     		strb	r3, [r2, #1]
 312:Src/LTC6811.c **** 		}
 2020              		.loc 1 312 0 discriminator 3
 2021 007a 1BF80000 		ldrb	r0, [fp, r0]	@ zero_extendqisi2
 2022 007e 43EAE003 		orr	r3, r3, r0, asr #3
 2023 0082 5370     		strb	r3, [r2, #1]
 309:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][1] &= (PEC_check[board] << 1);
 2024              		.loc 1 309 0 discriminator 3
 2025 0084 0131     		adds	r1, r1, #1
 2026              	.LVL214:
 2027 0086 C9B2     		uxtb	r1, r1
 2028              	.LVL215:
 2029              	.L94:
 309:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][1] &= (PEC_check[board] << 1);
 2030              		.loc 1 309 0 is_stmt 0 discriminator 1
 2031 0088 97F85230 		ldrb	r3, [r7, #82]	@ zero_extendqisi2
 2032 008c 9942     		cmp	r1, r3
 2033 008e E0D3     		bcc	.L95
 2034              	.LBE20:
 316:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 0][5] = (uint8_t) (boardTemp[0] & 0xFF); //temp1 L
 2035              		.loc 1 316 0 is_stmt 1 discriminator 2
 2036 0090 2288     		ldrh	r2, [r4]
 2037 0092 03FB06F6 		mul	r6, r3, r6
 2038 0096 06EB4601 		add	r1, r6, r6, lsl #1
 2039              	.LVL216:
 2040 009a 4B00     		lsls	r3, r1, #1
 2041 009c E918     		adds	r1, r5, r3
 2042 009e 120A     		lsrs	r2, r2, #8
 2043 00a0 0A71     		strb	r2, [r1, #4]
 317:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 1][4] = (uint8_t) ((boardTemp[0] >> 8) & 0xFF); //temp1 H
 2044              		.loc 1 317 0 discriminator 2
 2045 00a2 2278     		ldrb	r2, [r4]	@ zero_extendqisi2
 2046 00a4 4A71     		strb	r2, [r1, #5]
 318:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 1][5] = (uint8_t) (boardTemp[0] & 0xFF); //temp1 L
 2047              		.loc 1 318 0 discriminator 2
 2048 00a6 2188     		ldrh	r1, [r4]
 2049 00a8 0136     		adds	r6, r6, #1
 2050 00aa 06EB4606 		add	r6, r6, r6, lsl #1
 2051 00ae 7200     		lsls	r2, r6, #1
 2052 00b0 2A44     		add	r2, r2, r5
 2053 00b2 090A     		lsrs	r1, r1, #8
 2054 00b4 1171     		strb	r1, [r2, #4]
 319:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 2][4] = (uint8_t) ((boardTemp[1] >> 8) & 0xFF); //temp2 H
 2055              		.loc 1 319 0 discriminator 2
 2056 00b6 2178     		ldrb	r1, [r4]	@ zero_extendqisi2
ARM GAS  /tmp/ccouNvQA.s 			page 52


 2057 00b8 5171     		strb	r1, [r2, #5]
 320:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 2][5] = (uint8_t) (boardTemp[1] & 0xFF); //temp2 L
 2058              		.loc 1 320 0 discriminator 2
 2059 00ba 6188     		ldrh	r1, [r4, #2]
 2060 00bc 03F10C02 		add	r2, r3, #12
 2061 00c0 2A44     		add	r2, r2, r5
 2062 00c2 090A     		lsrs	r1, r1, #8
 2063 00c4 1171     		strb	r1, [r2, #4]
 321:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 3][4] = (uint8_t) ((boardTemp[1] >> 8) & 0xFF); //temp2 H
 2064              		.loc 1 321 0 discriminator 2
 2065 00c6 A178     		ldrb	r1, [r4, #2]	@ zero_extendqisi2
 2066 00c8 5171     		strb	r1, [r2, #5]
 322:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 3][5] = (uint8_t) (boardTemp[1] & 0xFF); //temp2 L
 2067              		.loc 1 322 0 discriminator 2
 2068 00ca 6188     		ldrh	r1, [r4, #2]
 2069 00cc 03F11202 		add	r2, r3, #18
 2070 00d0 2A44     		add	r2, r2, r5
 2071 00d2 090A     		lsrs	r1, r1, #8
 2072 00d4 1171     		strb	r1, [r2, #4]
 323:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 4][4] = (uint8_t) ((boardTemp[2] >> 8) & 0xFF); //temp3 H
 2073              		.loc 1 323 0 discriminator 2
 2074 00d6 A178     		ldrb	r1, [r4, #2]	@ zero_extendqisi2
 2075 00d8 5171     		strb	r1, [r2, #5]
 324:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 4][5] = (uint8_t) (boardTemp[2] & 0xFF); //temp3 L
 2076              		.loc 1 324 0 discriminator 2
 2077 00da A188     		ldrh	r1, [r4, #4]
 2078 00dc 03F11802 		add	r2, r3, #24
 2079 00e0 2A44     		add	r2, r2, r5
 2080 00e2 090A     		lsrs	r1, r1, #8
 2081 00e4 1171     		strb	r1, [r2, #4]
 325:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 5][4] = (uint8_t) ((boardTemp[2] >> 8) & 0xFF); //temp3 H
 2082              		.loc 1 325 0 discriminator 2
 2083 00e6 2179     		ldrb	r1, [r4, #4]	@ zero_extendqisi2
 2084 00e8 5171     		strb	r1, [r2, #5]
 326:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 5][5] = (uint8_t) (boardTemp[2] & 0xFF); //temp3 L
 2085              		.loc 1 326 0 discriminator 2
 2086 00ea A188     		ldrh	r1, [r4, #4]
 2087 00ec 03F11E02 		add	r2, r3, #30
 2088 00f0 2A44     		add	r2, r2, r5
 2089 00f2 090A     		lsrs	r1, r1, #8
 2090 00f4 1171     		strb	r1, [r2, #4]
 327:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 6][4] = (uint8_t) ((boardTemp[3] >> 8) & 0xFF); //temp4 H
 2091              		.loc 1 327 0 discriminator 2
 2092 00f6 2179     		ldrb	r1, [r4, #4]	@ zero_extendqisi2
 2093 00f8 5171     		strb	r1, [r2, #5]
 328:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 6][5] = (uint8_t) (boardTemp[3] & 0xFF); //temp4 L
 2094              		.loc 1 328 0 discriminator 2
 2095 00fa E188     		ldrh	r1, [r4, #6]
 2096 00fc 03F12402 		add	r2, r3, #36
 2097 0100 2A44     		add	r2, r2, r5
 2098 0102 090A     		lsrs	r1, r1, #8
 2099 0104 1171     		strb	r1, [r2, #4]
 329:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 7][4] = (uint8_t) ((boardTemp[3] >> 8) & 0xFF); //temp4 H
 2100              		.loc 1 329 0 discriminator 2
 2101 0106 A179     		ldrb	r1, [r4, #6]	@ zero_extendqisi2
 2102 0108 5171     		strb	r1, [r2, #5]
 330:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 7][5] = (uint8_t) (boardTemp[3] & 0xFF); //temp4 L
ARM GAS  /tmp/ccouNvQA.s 			page 53


 2103              		.loc 1 330 0 discriminator 2
 2104 010a E288     		ldrh	r2, [r4, #6]
 2105 010c 2A33     		adds	r3, r3, #42
 2106 010e 2B44     		add	r3, r3, r5
 2107 0110 120A     		lsrs	r2, r2, #8
 2108 0112 1A71     		strb	r2, [r3, #4]
 331:Src/LTC6811.c **** 	}
 2109              		.loc 1 331 0 discriminator 2
 2110 0114 A279     		ldrb	r2, [r4, #6]	@ zero_extendqisi2
 2111 0116 5A71     		strb	r2, [r3, #5]
 303:Src/LTC6811.c **** 
 2112              		.loc 1 303 0 discriminator 2
 2113 0118 08F10108 		add	r8, r8, #1
 2114              	.LVL217:
 2115 011c 5FFA88F8 		uxtb	r8, r8
 2116              	.LVL218:
 2117              	.L93:
 303:Src/LTC6811.c **** 
 2118              		.loc 1 303 0 is_stmt 0 discriminator 1
 2119 0120 7B68     		ldr	r3, [r7, #4]
 2120 0122 9845     		cmp	r8, r3
 2121 0124 0ED2     		bcs	.L102
 306:Src/LTC6811.c **** 
 2122              		.loc 1 306 0 is_stmt 1
 2123 0126 4646     		mov	r6, r8
 2124 0128 07F13003 		add	r3, r7, #48
 2125 012c 03EB0800 		add	r0, r3, r8
 2126 0130 5346     		mov	r3, r10
 2127 0132 5A46     		mov	r2, fp
 2128 0134 2146     		mov	r1, r4
 2129 0136 4078     		ldrb	r0, [r0, #1]	@ zero_extendqisi2
 2130 0138 FFF7FEFF 		bl	readCellTemp
 2131              	.LVL219:
 2132 013c 09F80800 		strb	r0, [r9, r8]
 2133              	.LVL220:
 2134              	.LBB21:
 309:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][1] &= (PEC_check[board] << 1);
 2135              		.loc 1 309 0
 2136 0140 0021     		movs	r1, #0
 2137 0142 A1E7     		b	.L94
 2138              	.LVL221:
 2139              	.L102:
 2140              	.LBE21:
 2141              	.LBE19:
 2142              	.LBB22:
 334:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 2143              		.loc 1 334 0
 2144 0144 0023     		movs	r3, #0
 2145              	.LBE22:
 301:Src/LTC6811.c **** 
 2146              		.loc 1 301 0
 2147 0146 0120     		movs	r0, #1
 2148 0148 01E0     		b	.L97
 2149              	.LVL222:
 2150              	.L98:
 2151              	.LBB23:
 334:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
ARM GAS  /tmp/ccouNvQA.s 			page 54


 2152              		.loc 1 334 0 discriminator 2
 2153 014a 0133     		adds	r3, r3, #1
 2154              	.LVL223:
 2155 014c DBB2     		uxtb	r3, r3
 2156              	.LVL224:
 2157              	.L97:
 334:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 2158              		.loc 1 334 0 is_stmt 0 discriminator 1
 2159 014e 7A68     		ldr	r2, [r7, #4]
 2160 0150 9342     		cmp	r3, r2
 2161 0152 05D2     		bcs	.L103
 335:Src/LTC6811.c **** 			dataValid = false;
 2162              		.loc 1 335 0 is_stmt 1
 2163 0154 19F80320 		ldrb	r2, [r9, r3]	@ zero_extendqisi2
 2164 0158 002A     		cmp	r2, #0
 2165 015a F6D1     		bne	.L98
 336:Src/LTC6811.c **** 	}
 2166              		.loc 1 336 0
 2167 015c 1046     		mov	r0, r2
 2168              	.LVL225:
 2169 015e F4E7     		b	.L98
 2170              	.LVL226:
 2171              	.L103:
 2172              	.LBE23:
 340:Src/LTC6811.c **** 
 2173              		.loc 1 340 0
 2174 0160 0C37     		adds	r7, r7, #12
 2175              	.LCFI51:
 2176              		.cfi_def_cfa_offset 52
 2177 0162 BD46     		mov	sp, r7
 2178              	.LCFI52:
 2179              		.cfi_def_cfa_register 13
 2180              		@ sp needed
 2181 0164 BDE8F04F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 2182              	.LCFI53:
 2183              		.cfi_restore 14
 2184              		.cfi_restore 11
 2185              		.cfi_restore 10
 2186              		.cfi_restore 9
 2187              		.cfi_restore 8
 2188              		.cfi_restore 7
 2189              		.cfi_restore 6
 2190              		.cfi_restore 5
 2191              		.cfi_restore 4
 2192              		.cfi_def_cfa_offset 16
 2193              	.LVL227:
 2194 0168 04B0     		add	sp, sp, #16
 2195              	.LCFI54:
 2196              		.cfi_def_cfa_offset 0
 2197 016a 7047     		bx	lr
 2198              		.cfi_endproc
 2199              	.LFE72:
 2201              		.global	CRC15_POLY
 2202              		.comm	pec15Table,512,4
 2203              		.section	.data.CRC15_POLY,"aw",%progbits
 2204              		.align	1
 2205              		.set	.LANCHOR0,. + 0
ARM GAS  /tmp/ccouNvQA.s 			page 55


 2208              	CRC15_POLY:
 2209 0000 9945     		.short	17817
 2210              		.text
 2211              	.Letext0:
 2212              		.file 2 "/usr/include/newlib/machine/_default_types.h"
 2213              		.file 3 "/usr/include/newlib/sys/_stdint.h"
 2214              		.file 4 "Drivers/CMSIS/Include/core_cm3.h"
 2215              		.file 5 "Drivers/CMSIS/Device/ST/STM32F1xx/Include/system_stm32f1xx.h"
 2216              		.file 6 "/usr/include/newlib/sys/lock.h"
 2217              		.file 7 "/usr/include/newlib/sys/_types.h"
 2218              		.file 8 "/usr/lib/gcc/arm-none-eabi/7.3.1/include/stddef.h"
 2219              		.file 9 "/usr/include/newlib/sys/reent.h"
 2220              		.file 10 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal.h"
 2221              		.file 11 "/usr/include/newlib/stdlib.h"
 2222              		.file 12 "Inc/BMSconfig.h"
 2223              		.file 13 "/usr/include/newlib/math.h"
 2224              		.file 14 "Inc/LTC6811.h"
 2225              		.file 15 "Inc/SPI.h"
 2226              		.file 16 "<built-in>"
ARM GAS  /tmp/ccouNvQA.s 			page 56


DEFINED SYMBOLS
                            *ABS*:0000000000000000 LTC6811.c
     /tmp/ccouNvQA.s:16     .text.initPECTable:0000000000000000 $t
     /tmp/ccouNvQA.s:23     .text.initPECTable:0000000000000000 initPECTable
     /tmp/ccouNvQA.s:97     .text.initPECTable:0000000000000038 $d
                            *COM*:0000000000000200 pec15Table
     /tmp/ccouNvQA.s:103    .text.calculatePEC:0000000000000000 $t
     /tmp/ccouNvQA.s:110    .text.calculatePEC:0000000000000000 calculatePEC
     /tmp/ccouNvQA.s:171    .text.calculatePEC:000000000000002c $d
     /tmp/ccouNvQA.s:176    .text.readRegister:0000000000000000 $t
     /tmp/ccouNvQA.s:183    .text.readRegister:0000000000000000 readRegister
     /tmp/ccouNvQA.s:497    .text.readConfig:0000000000000000 $t
     /tmp/ccouNvQA.s:504    .text.readConfig:0000000000000000 readConfig
     /tmp/ccouNvQA.s:565    .text.writeConfigAddress:0000000000000000 $t
     /tmp/ccouNvQA.s:572    .text.writeConfigAddress:0000000000000000 writeConfigAddress
     /tmp/ccouNvQA.s:770    .text.writeConfigAll:0000000000000000 $t
     /tmp/ccouNvQA.s:777    .text.writeConfigAll:0000000000000000 writeConfigAll
     /tmp/ccouNvQA.s:847    .text.dischargeCellGroups:0000000000000000 $t
     /tmp/ccouNvQA.s:854    .text.dischargeCellGroups:0000000000000000 dischargeCellGroups
     /tmp/ccouNvQA.s:960    .text.sendBroadcastCommand:0000000000000000 $t
     /tmp/ccouNvQA.s:967    .text.sendBroadcastCommand:0000000000000000 sendBroadcastCommand
     /tmp/ccouNvQA.s:1013   .text.sendAddressCommand:0000000000000000 $t
     /tmp/ccouNvQA.s:1020   .text.sendAddressCommand:0000000000000000 sendAddressCommand
     /tmp/ccouNvQA.s:1092   .text.readCellVoltage:0000000000000000 $t
     /tmp/ccouNvQA.s:1099   .text.readCellVoltage:0000000000000000 readCellVoltage
     /tmp/ccouNvQA.s:1208   .text.readAllCellVoltages:0000000000000000 $t
     /tmp/ccouNvQA.s:1215   .text.readAllCellVoltages:0000000000000000 readAllCellVoltages
     /tmp/ccouNvQA.s:1453   .text.checkAllCellConnections:0000000000000000 $t
     /tmp/ccouNvQA.s:1460   .text.checkAllCellConnections:0000000000000000 checkAllCellConnections
     /tmp/ccouNvQA.s:1625   .text.readCellTemp:0000000000000000 $t
     /tmp/ccouNvQA.s:1632   .text.readCellTemp:0000000000000000 readCellTemp
     /tmp/ccouNvQA.s:1902   .text.readCellTemp:00000000000001d0 $d
     /tmp/ccouNvQA.s:1928   .text.readAllCellTemps:0000000000000000 $t
     /tmp/ccouNvQA.s:1935   .text.readAllCellTemps:0000000000000000 readAllCellTemps
     /tmp/ccouNvQA.s:2208   .data.CRC15_POLY:0000000000000000 CRC15_POLY
     /tmp/ccouNvQA.s:2204   .data.CRC15_POLY:0000000000000000 $d

UNDEFINED SYMBOLS
malloc
SPIWriteRead
SPIWrite
free
memcpy
HAL_Delay
__aeabi_ui2d
__aeabi_ddiv
__aeabi_dmul
__aeabi_dsub
__aeabi_dadd
__aeabi_d2uiz
pow
