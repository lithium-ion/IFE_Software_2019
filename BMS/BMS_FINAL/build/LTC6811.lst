ARM GAS  /tmp/ccbi9fCp.s 			page 1


   1              		.cpu cortex-m3
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 1
   9              		.eabi_attribute 34, 1
  10              		.eabi_attribute 18, 4
  11              		.file	"LTC6811.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.section	.text.initPECTable,"ax",%progbits
  16              		.align	1
  17              		.global	initPECTable
  18              		.syntax unified
  19              		.thumb
  20              		.thumb_func
  21              		.fpu softvfp
  23              	initPECTable:
  24              	.LFB66:
  25              		.file 1 "Src/LTC6811.c"
   1:Src/LTC6811.c **** /*
   2:Src/LTC6811.c **** 	LTC6811 Command Functions
   3:Src/LTC6811.c **** 	Matt Vlasaty
   4:Src/LTC6811.c **** 	March 29th, 2019
   5:Src/LTC6811.c **** 	
   6:Src/LTC6811.c **** 	General Functions
   7:Src/LTC6811.c **** 		sendBroadcastCommand: void sendBroadcastCommand(CommandCodeTypedef command);
   8:Src/LTC6811.c **** 			- sends specified write-only command to every LTC in the chain (ex: ADCV)
   9:Src/LTC6811.c **** 			- CommandCodeTypedef enum contains every command code used
  10:Src/LTC6811.c **** 		sendAddressCommand: void sendAddressCommand(CommandCodeTypedef command, uint8_t address);
  11:Src/LTC6811.c **** 			- sends specified write-only command to LTC with specified address
  12:Src/LTC6811.c **** 		readRegister: bool readRegister(CommandCodeTypedef command, uint8_t address, uint16_t *data);
  13:Src/LTC6811.c **** 			- reads register specified in command from specified board
  14:Src/LTC6811.c **** 			- ex: ReadCellVoltageRegisterGroup1to3, ReadAuxiliaryGroupA, ReadConfigurationRegisterGroup
  15:Src/LTC6811.c **** 			- returns true if received PEC matches calculated PEC
  16:Src/LTC6811.c **** 		
  17:Src/LTC6811.c **** 	Configuration Functions
  18:Src/LTC6811.c **** 		writeConfigAll: void writeConfigAll(BMSconfigStructTypedef cfg);
  19:Src/LTC6811.c **** 			- writes configuration data from BMSconfig struct into LTC configuration register
  20:Src/LTC6811.c **** 			- BMSconfig struct includes ADCMode, UV, OV, and discharge enable for each cell
  21:Src/LTC6811.c **** 			- BMSconfig struct also contains number of ICs and array of addresses used
  22:Src/LTC6811.c **** 		writeConfigAddress: void writeConfigAddress(BMSconfigStructTypedef cfg, uint8_t address);
  23:Src/LTC6811.c **** 			- this is only used for cellDischarge command
  24:Src/LTC6811.c **** 			- writes configuration data to LTC with specified address
  25:Src/LTC6811.c **** 		readConfig: bool readConfig(uint8_t address, uint8_t cfg[6]);
  26:Src/LTC6811.c **** 			- uses general readRegister function to check current state of LTC configuration register
  27:Src/LTC6811.c **** 			- this is mostly for testing purposes
  28:Src/LTC6811.c **** 			- returns true if received PEC matches calculated PEC (same as readRegister)
  29:Src/LTC6811.c **** 		
  30:Src/LTC6811.c **** 	Cell Voltage Functions
  31:Src/LTC6811.c **** 		readCellVoltage: bool readCellVoltage(uint8_t address, uint16_t cellVoltage[12]);
  32:Src/LTC6811.c **** 			- sends ADCV command that begins conversion for every cell to specified LTC
  33:Src/LTC6811.c **** 			- reads all cell voltage registers using general readRegister function
ARM GAS  /tmp/ccbi9fCp.s 			page 2


  34:Src/LTC6811.c **** 			- used cell inputs (1, 2, 3, 4, 7, 8, 9, 10) must be chosen from cellVoltage[12] later
  35:Src/LTC6811.c **** 			- returns true if received PEC matches calculated PEC for every register read
  36:Src/LTC6811.c **** 		readAllCellVoltages: bool readAllCellVoltages(BMSconfigStructTypedef cfg, uint8_t bmsData[96][6])
  37:Src/LTC6811.c **** 			- stores cell number, cell voltage, and data valid bit into bmsData
  38:Src/LTC6811.c **** 			- returns true if no PEC for any register read for any board
  39:Src/LTC6811.c **** 	Cell Temperature Functions
  40:Src/LTC6811.c **** 		readCellTemp: bool readCellTemp(uint8_t address, uint16_t cellTemp[4], bool dcFault[4], bool temp
  41:Src/LTC6811.c **** 			- initiates ADC conversion for GPIO inputs connected to temperature sensors
  42:Src/LTC6811.c **** 			- reads auxiliary register groups using general readRegister function
  43:Src/LTC6811.c **** 			- converts measured voltage into temperature based on temperature sensor response
  44:Src/LTC6811.c **** 			- checks for disconnected temperature sensor and overtemperature faults for each LTC and stores 
  45:Src/LTC6811.c **** 		readAllCellTemps: bool readAllCellTemps(uint8_t numBoards, uint16_t cellTemp[numBoards][4], bool 
  46:Src/LTC6811.c **** 			- not tested
  47:Src/LTC6811.c **** 			- using order of ICs in BMSconfig, stores cell temperature for every cell on every board into 2D
  48:Src/LTC6811.c **** 			- returns false if any readCellTemp returns false
  49:Src/LTC6811.c **** 	
  50:Src/LTC6811.c **** 	Cell Connection Functions
  51:Src/LTC6811.c **** 		checkCellConnection: void checkCellConnection(uint16_t cellVoltage[12], bool cellConnection[12]);
  52:Src/LTC6811.c **** 			- needs previously obtained cell voltage measurements
  53:Src/LTC6811.c **** 			- initiates ADOW command with PUP = 0 to source 100uA while measuring cell voltage
  54:Src/LTC6811.c **** 			- reads cell voltages with readCellVoltage function
  55:Src/LTC6811.c **** 			- compares previously measured values to open wire check values
  56:Src/LTC6811.c **** 			- if there is a significant drop in voltage (should be configurable), cell is disconnected
  57:Src/LTC6811.c **** 			- stores 1 into cellConnection if cell is connected
  58:Src/LTC6811.c **** 			- stores 0 into cellConnection if cell is disconnected
  59:Src/LTC6811.c **** 		checkAllCellConnections: 
  60:Src/LTC6811.c **** 	
  61:Src/LTC6811.c **** 	PEC Functions
  62:Src/LTC6811.c **** 		initPECTable: void initPECTable(void);
  63:Src/LTC6811.c **** 			- taken from LTC6811 datasheet
  64:Src/LTC6811.c **** 			- generates PEC look-up table
  65:Src/LTC6811.c **** 			- should be called on start-up
  66:Src/LTC6811.c **** 		calculatePEC: uint16_t calculatePEC(uint8_t len, uint8_t *data);
  67:Src/LTC6811.c **** 			- taken from LTC6811 datasheet
  68:Src/LTC6811.c **** 			- used when sending command to calculate necessary PEC bytes to follow command bytes
  69:Src/LTC6811.c **** 			- used when receiving data to compare received PEC with the PEC that should have been received b
  70:Src/LTC6811.c **** 			- returns uint16_t PEC value
  71:Src/LTC6811.c **** 			
  72:Src/LTC6811.c **** 	TODO:
  73:Src/LTC6811.c **** 		- checkCellConnection return value needs to disregard unused cell inputs
  74:Src/LTC6811.c **** 		- resolve issue with writeConfig not changing every bit in the first register group
  75:Src/LTC6811.c **** 		- test functions used to read from every board (readAllCellVoltages should be [12][8])
  76:Src/LTC6811.c **** 		- minor changes (using more user-defined constants, changing return values)
  77:Src/LTC6811.c **** 		
  78:Src/LTC6811.c **** 	NOTES:
  79:Src/LTC6811.c **** 		- writeConfig is called every loop for every LTC because dischargeCells is called every loop for 
  80:Src/LTC6811.c **** 		- always take measurements, only send when not charging? (CAN messages for charging?)
  81:Src/LTC6811.c **** 		- every 'readAll' function starts with address = 0 and increases sequentially
  82:Src/LTC6811.c **** 		
  83:Src/LTC6811.c **** 		- in temp read, faults are determined but not transferred
  84:Src/LTC6811.c **** 		- temperature conversion works, but error is +/- 1 degree
  85:Src/LTC6811.c **** */
  86:Src/LTC6811.c **** 
  87:Src/LTC6811.c **** 
  88:Src/LTC6811.c **** #include "LTC6811.h"
  89:Src/LTC6811.c **** 
  90:Src/LTC6811.c **** uint16_t pec15Table[256];
ARM GAS  /tmp/ccbi9fCp.s 			page 3


  91:Src/LTC6811.c **** uint16_t CRC15_POLY = 0x4599;
  92:Src/LTC6811.c **** 
  93:Src/LTC6811.c **** void initPECTable(void) {
  26              		.loc 1 93 0
  27              		.cfi_startproc
  28              		@ args = 0, pretend = 0, frame = 0
  29              		@ frame_needed = 0, uses_anonymous_args = 0
  30              		@ link register save eliminated.
  31              	.LVL0:
  32              	.LBB2:
  94:Src/LTC6811.c **** 	
  95:Src/LTC6811.c **** 	uint16_t remainder;
  96:Src/LTC6811.c **** 	
  97:Src/LTC6811.c **** 	for (int i = 0; i < 256; i++) {
  33              		.loc 1 97 0
  34 0000 0020     		movs	r0, #0
  35 0002 11E0     		b	.L2
  36              	.LVL1:
  37              	.L4:
  38              	.LBB3:
  98:Src/LTC6811.c **** 		remainder = i << 7;
  99:Src/LTC6811.c **** 		for (int bit = 8; bit > 0; bit--) {
 100:Src/LTC6811.c **** 			if (remainder & 0x4000) {
 101:Src/LTC6811.c **** 				remainder = ((remainder << 1));
 102:Src/LTC6811.c **** 				remainder = (remainder ^ CRC15_POLY);
 103:Src/LTC6811.c **** 			}
 104:Src/LTC6811.c **** 			else {
 105:Src/LTC6811.c **** 				remainder = ((remainder << 1));
  39              		.loc 1 105 0
  40 0004 5B00     		lsls	r3, r3, #1
  41              	.LVL2:
  42 0006 9BB2     		uxth	r3, r3
  43              	.LVL3:
  44              	.L5:
  99:Src/LTC6811.c **** 			if (remainder & 0x4000) {
  45              		.loc 1 99 0 discriminator 2
  46 0008 013A     		subs	r2, r2, #1
  47              	.LVL4:
  48              	.L3:
  99:Src/LTC6811.c **** 			if (remainder & 0x4000) {
  49              		.loc 1 99 0 is_stmt 0 discriminator 1
  50 000a 002A     		cmp	r2, #0
  51 000c 08DD     		ble	.L8
 100:Src/LTC6811.c **** 				remainder = ((remainder << 1));
  52              		.loc 1 100 0 is_stmt 1
  53 000e 13F4804F 		tst	r3, #16384
  54 0012 F7D0     		beq	.L4
 101:Src/LTC6811.c **** 				remainder = (remainder ^ CRC15_POLY);
  55              		.loc 1 101 0
  56 0014 5B00     		lsls	r3, r3, #1
  57              	.LVL5:
  58 0016 9BB2     		uxth	r3, r3
  59              	.LVL6:
 102:Src/LTC6811.c **** 			}
  60              		.loc 1 102 0
  61 0018 0749     		ldr	r1, .L10
  62 001a 0988     		ldrh	r1, [r1]
ARM GAS  /tmp/ccbi9fCp.s 			page 4


  63 001c 4B40     		eors	r3, r3, r1
  64              	.LVL7:
  65 001e F3E7     		b	.L5
  66              	.L8:
  67              	.LBE3:
 106:Src/LTC6811.c **** 			}
 107:Src/LTC6811.c **** 		}
 108:Src/LTC6811.c **** 		pec15Table[i] = remainder & 0xFFFF;
  68              		.loc 1 108 0 discriminator 2
  69 0020 064A     		ldr	r2, .L10+4
  70              	.LVL8:
  71 0022 22F81030 		strh	r3, [r2, r0, lsl #1]	@ movhi
  97:Src/LTC6811.c **** 		remainder = i << 7;
  72              		.loc 1 97 0 discriminator 2
  73 0026 0130     		adds	r0, r0, #1
  74              	.LVL9:
  75              	.L2:
  97:Src/LTC6811.c **** 		remainder = i << 7;
  76              		.loc 1 97 0 is_stmt 0 discriminator 1
  77 0028 FF28     		cmp	r0, #255
  78 002a 04DC     		bgt	.L9
  98:Src/LTC6811.c **** 		for (int bit = 8; bit > 0; bit--) {
  79              		.loc 1 98 0 is_stmt 1
  80 002c 83B2     		uxth	r3, r0
  81 002e DB01     		lsls	r3, r3, #7
  82 0030 9BB2     		uxth	r3, r3
  83              	.LVL10:
  84              	.LBB4:
  99:Src/LTC6811.c **** 			if (remainder & 0x4000) {
  85              		.loc 1 99 0
  86 0032 0822     		movs	r2, #8
  87 0034 E9E7     		b	.L3
  88              	.LVL11:
  89              	.L9:
  90              	.LBE4:
  91              	.LBE2:
 109:Src/LTC6811.c **** 	}
 110:Src/LTC6811.c **** };
  92              		.loc 1 110 0
  93 0036 7047     		bx	lr
  94              	.L11:
  95              		.align	2
  96              	.L10:
  97 0038 00000000 		.word	.LANCHOR0
  98 003c 00000000 		.word	pec15Table
  99              		.cfi_endproc
 100              	.LFE66:
 102              		.section	.text.calculatePEC,"ax",%progbits
 103              		.align	1
 104              		.global	calculatePEC
 105              		.syntax unified
 106              		.thumb
 107              		.thumb_func
 108              		.fpu softvfp
 110              	calculatePEC:
 111              	.LFB79:
 111:Src/LTC6811.c **** 
ARM GAS  /tmp/ccbi9fCp.s 			page 5


 112:Src/LTC6811.c **** void writeConfigAddress(BMSconfigStructTypedef cfg, uint8_t address) {
 113:Src/LTC6811.c **** 
 114:Src/LTC6811.c **** 	uint8_t config[6];
 115:Src/LTC6811.c **** 	uint8_t *cmd;
 116:Src/LTC6811.c **** 	uint8_t cmd_len = 12;
 117:Src/LTC6811.c **** 	uint16_t PEC_return;
 118:Src/LTC6811.c **** 	uint8_t dummy[8];
 119:Src/LTC6811.c **** 
 120:Src/LTC6811.c **** 	// readConfig(address, dummy);
 121:Src/LTC6811.c **** 	
 122:Src/LTC6811.c **** 	cmd = (uint8_t *)malloc(cmd_len*sizeof(uint8_t));
 123:Src/LTC6811.c **** 	
 124:Src/LTC6811.c **** 	config[0] = (uint8_t) (cfg.GPIO5PulldownOff << 7) | (cfg.GPIO4PulldownOff << 6) | (cfg.GPIO3Pulldo
 125:Src/LTC6811.c **** 	config[1] = (uint8_t) (cfg.UndervoltageComparisonVoltage & 0xFF);
 126:Src/LTC6811.c **** 	config[2] = (uint8_t) ((cfg.OvervoltageComparisonVoltage << 4) & 0xF0) | ((cfg.UndervoltageCompari
 127:Src/LTC6811.c **** 	config[3] = (uint8_t) ((cfg.OvervoltageComparisonVoltage >> 4) & 0xFF);
 128:Src/LTC6811.c **** 	config[4] = (uint8_t) (cfg.DischargeCell8 << 7) | (cfg.DischargeCell7 << 6) | (cfg.DischargeCell6 
 129:Src/LTC6811.c **** 	config[5] = (uint8_t) ((cfg.DischargeTimeoutValue << 4) & 0xF0) | (cfg.DischargeCell12 << 3) | (cf
 130:Src/LTC6811.c **** 	
 131:Src/LTC6811.c **** 	cmd[0] = (uint8_t) (0x80 | ((address << 3) & 0x78) | ((WriteConfigurationRegisterGroup >> 8) & 0x0
 132:Src/LTC6811.c **** 	cmd[1] = (uint8_t) (WriteConfigurationRegisterGroup & 0xFF);
 133:Src/LTC6811.c **** 	
 134:Src/LTC6811.c **** 	PEC_return = calculatePEC(2, cmd);
 135:Src/LTC6811.c **** 	
 136:Src/LTC6811.c **** 	cmd[2] = (PEC_return >> 8) & 0xFF;
 137:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 138:Src/LTC6811.c **** 
 139:Src/LTC6811.c **** 	cmd[4] = config[0];
 140:Src/LTC6811.c **** 	cmd[5] = config[1];
 141:Src/LTC6811.c **** 	cmd[6] = config[2];
 142:Src/LTC6811.c **** 	cmd[7] = config[3];
 143:Src/LTC6811.c **** 	cmd[8] = config[4];
 144:Src/LTC6811.c **** 	cmd[9] = config[5];
 145:Src/LTC6811.c **** 	
 146:Src/LTC6811.c **** 	PEC_return = calculatePEC(6, cmd + 4);
 147:Src/LTC6811.c **** 
 148:Src/LTC6811.c **** 	cmd[10] = (PEC_return >> 8) & 0xFF;
 149:Src/LTC6811.c **** 	cmd[11] = PEC_return & 0xFF;
 150:Src/LTC6811.c **** 	
 151:Src/LTC6811.c **** 	SPIWrite(cmd, cmd_len);
 152:Src/LTC6811.c **** 
 153:Src/LTC6811.c **** 	readConfig(address, dummy);
 154:Src/LTC6811.c **** 	
 155:Src/LTC6811.c **** 	free(cmd);
 156:Src/LTC6811.c **** 
 157:Src/LTC6811.c **** };
 158:Src/LTC6811.c **** 
 159:Src/LTC6811.c **** void writeConfigAll(BMSconfigStructTypedef cfg) {
 160:Src/LTC6811.c **** 
 161:Src/LTC6811.c **** 	uint32_t delay = 15;
 162:Src/LTC6811.c **** 	HAL_GPIO_WritePin(GPIOA, GPIO_PIN_4, GPIO_PIN_RESET);
 163:Src/LTC6811.c **** 	while(delay--);
 164:Src/LTC6811.c **** 	HAL_GPIO_WritePin(GPIOA, GPIO_PIN_4, GPIO_PIN_SET);
 165:Src/LTC6811.c **** 
 166:Src/LTC6811.c **** 	for (uint8_t i = 0; i < cfg.numOfICs; i++) {
 167:Src/LTC6811.c **** 		writeConfigAddress(cfg, cfg.address[i]);
 168:Src/LTC6811.c **** 	}
ARM GAS  /tmp/ccbi9fCp.s 			page 6


 169:Src/LTC6811.c **** };
 170:Src/LTC6811.c **** 
 171:Src/LTC6811.c **** bool readCellVoltage(uint8_t address, uint16_t cellVoltage[12]) {
 172:Src/LTC6811.c **** 	
 173:Src/LTC6811.c **** 	bool PEC_check = false;
 174:Src/LTC6811.c **** 	bool dataValid = true;
 175:Src/LTC6811.c **** 	uint16_t *voltage;
 176:Src/LTC6811.c **** 	
 177:Src/LTC6811.c **** 	voltage = (uint16_t *)malloc(12*sizeof(uint16_t));
 178:Src/LTC6811.c **** 	
 179:Src/LTC6811.c **** 	// sendAddressCommand(0x711, address); // clear cell voltage groups
 180:Src/LTC6811.c **** 	// sendAddressCommand(StartCellVoltageADCConversionAll, address); // start conversion for every ce
 181:Src/LTC6811.c **** 	// sendAddressCommand(0x261, address); // 1 and 7
 182:Src/LTC6811.c **** 	// sendAddressCommand(0x264, address); // 4 and 10
 183:Src/LTC6811.c **** 
 184:Src/LTC6811.c **** 	// HAL_Delay(50); // conversion time is 12.8ms at 422Hz, so wait 15ms
 185:Src/LTC6811.c **** 	
 186:Src/LTC6811.c **** 	PEC_check = readRegister(ReadCellVoltageRegisterGroup1to3, address, voltage);
 187:Src/LTC6811.c **** 	//dataValid = dataValid & PEC_check;
 188:Src/LTC6811.c **** 	PEC_check = readRegister(ReadCellVoltageRegisterGroup4to6, address, voltage);
 189:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 190:Src/LTC6811.c **** 	PEC_check = readRegister(ReadCellVoltageRegisterGroup7to9, address, voltage);
 191:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 192:Src/LTC6811.c **** 	PEC_check = readRegister(ReadCellVoltageRegisterGroup10to12, address, voltage);
 193:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 194:Src/LTC6811.c **** 	PEC_check = readRegister(ReadCellVoltageRegisterGroup1to3, address, voltage);
 195:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 196:Src/LTC6811.c **** 	
 197:Src/LTC6811.c **** 	for (uint8_t i = 0; i < 12; i++) {
 198:Src/LTC6811.c **** 		cellVoltage[i] = voltage[i];
 199:Src/LTC6811.c **** 	}
 200:Src/LTC6811.c **** 	
 201:Src/LTC6811.c **** 	free(voltage);
 202:Src/LTC6811.c **** 	
 203:Src/LTC6811.c **** 	return(dataValid);
 204:Src/LTC6811.c **** 	
 205:Src/LTC6811.c **** };
 206:Src/LTC6811.c **** 
 207:Src/LTC6811.c **** bool readAllCellVoltages(BMSconfigStructTypedef cfg, uint8_t bmsData[96][6]) {
 208:Src/LTC6811.c **** 
 209:Src/LTC6811.c **** 	/*
 210:Src/LTC6811.c **** 	uint16_t boardVoltage[cfg.numOfCellInputs];
 211:Src/LTC6811.c **** 	bool PEC_check[cfg.numOfICs];
 212:Src/LTC6811.c **** 	bool dataValid = true;
 213:Src/LTC6811.c **** 
 214:Src/LTC6811.c **** 	for (uint8_t board = 0; board < cfg.numOfICs; board++) {
 215:Src/LTC6811.c **** 
 216:Src/LTC6811.c **** 		//read voltage of every cell input (1-12) for a specific address, store in boardVoltage
 217:Src/LTC6811.c **** 		PEC_check[board] = readCellVoltage(cfg.address[board], boardVoltage);
 218:Src/LTC6811.c **** 
 219:Src/LTC6811.c **** 		//store cell number and valid data bit in bmsData
 220:Src/LTC6811.c **** 		for (uint8_t cell = 0; cell < cfg.numOfCellsPerIC; cell++) {
 221:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][0] = (uint8_t) ((board * cfg.numOfCellsPerIC) + ce
 222:Src/LTC6811.c **** 			bmsData[(board * cfg.numOfCellsPerIC) + cell][1] = (uint8_t) (0x02 & (PEC_check[board] << 1)); /
 223:Src/LTC6811.c **** 		}
 224:Src/LTC6811.c **** 
 225:Src/LTC6811.c **** 		//store cell voltage in bmsData
ARM GAS  /tmp/ccbi9fCp.s 			page 7


 226:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 0][2] = (uint8_t) ((boardVoltage[0] >> 8) & 0xFF); //cell
 227:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 0][3] = (uint8_t) (boardVoltage[0] & 0xFF); //cell 1, vol
 228:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 1][2] = (uint8_t) ((boardVoltage[1] >> 8) & 0xFF); //cell
 229:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 1][3] = (uint8_t) (boardVoltage[1] & 0xFF); //cell 2, vol
 230:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 2][2] = (uint8_t) ((boardVoltage[2] >> 8) & 0xFF); //cell
 231:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 2][3] = (uint8_t) (boardVoltage[2] & 0xFF); //cell 3, vol
 232:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 3][2] = (uint8_t) ((boardVoltage[3] >> 8) & 0xFF); //cell
 233:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 3][3] = (uint8_t) (boardVoltage[3] & 0xFF); //cell 4, vol
 234:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 4][2] = (uint8_t) ((boardVoltage[6] >> 8) & 0xFF); //cell
 235:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 4][3] = (uint8_t) (boardVoltage[6] & 0xFF); //cell 7, vol
 236:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 5][2] = (uint8_t) ((boardVoltage[7] >> 8) & 0xFF); //cell
 237:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 5][3] = (uint8_t) (boardVoltage[7] & 0xFF); //cell 8, vol
 238:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 6][2] = (uint8_t) ((boardVoltage[8] >> 8) & 0xFF); //cell
 239:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 6][3] = (uint8_t) (boardVoltage[8] & 0xFF); //cell 9, vol
 240:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 7][2] = (uint8_t) ((boardVoltage[9] >> 8) & 0xFF); //cell
 241:Src/LTC6811.c **** 		bmsData[(board * cfg.numOfCellsPerIC) + 7][3] = (uint8_t) (boardVoltage[9] & 0xFF); //cell 10, vo
 242:Src/LTC6811.c **** 	
 243:Src/LTC6811.c **** 	}
 244:Src/LTC6811.c **** 
 245:Src/LTC6811.c **** 	for (uint8_t board = 0; board < cfg.numOfICs; board++) {
 246:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 247:Src/LTC6811.c **** 			dataValid = false;
 248:Src/LTC6811.c **** 	}
 249:Src/LTC6811.c **** 
 250:Src/LTC6811.c **** 	return dataValid; //return true if no PEC errors for any board
 251:Src/LTC6811.c **** 	*/
 252:Src/LTC6811.c **** 
 253:Src/LTC6811.c **** 	uint16_t boardVoltage[12];
 254:Src/LTC6811.c **** 	bool PEC_check[12];
 255:Src/LTC6811.c **** 	bool dataValid = true;
 256:Src/LTC6811.c **** 
 257:Src/LTC6811.c **** 	sendBroadcastCommand(ClearRegisters);
 258:Src/LTC6811.c **** 	sendBroadcastCommand(StartCellVoltageADCConversionAll);
 259:Src/LTC6811.c **** 	HAL_Delay(20);
 260:Src/LTC6811.c **** 
 261:Src/LTC6811.c **** 	uint32_t delay = 15;
 262:Src/LTC6811.c **** 	HAL_GPIO_WritePin(GPIOA, GPIO_PIN_4, GPIO_PIN_RESET);
 263:Src/LTC6811.c **** 	while(delay--);
 264:Src/LTC6811.c **** 	HAL_GPIO_WritePin(GPIOA, GPIO_PIN_4, GPIO_PIN_SET);
 265:Src/LTC6811.c **** 
 266:Src/LTC6811.c **** 	for (uint8_t board = 0; board < 12; board++) {
 267:Src/LTC6811.c **** 
 268:Src/LTC6811.c **** 		//read voltage of every cell input (1-12) for a specific address, store in boardVoltage
 269:Src/LTC6811.c **** 		PEC_check[board] = readCellVoltage(board, boardVoltage);
 270:Src/LTC6811.c **** 
 271:Src/LTC6811.c **** 		//store cell number and valid data bit in bmsData
 272:Src/LTC6811.c **** 		for (uint8_t cell = 0; cell < 8; cell++) {
 273:Src/LTC6811.c **** 			bmsData[(board * 8) + cell][0] = (uint8_t) ((board * 8) + cell + 1); //cell number
 274:Src/LTC6811.c **** 			bmsData[(board * 8) + cell][1] = (uint8_t) (0x02 & (PEC_check[board] << 1)); //valid data bit in
 275:Src/LTC6811.c **** 		}
 276:Src/LTC6811.c **** 
 277:Src/LTC6811.c **** 		//store cell voltage in bmsData
 278:Src/LTC6811.c **** 		bmsData[(board * 8) + 0][2] = (uint8_t) ((boardVoltage[0] >> 8) & 0xFF); //cell 1, voltage H
 279:Src/LTC6811.c **** 		bmsData[(board * 8) + 0][3] = (uint8_t) (boardVoltage[0] & 0xFF); //cell 1, voltage L
 280:Src/LTC6811.c **** 		bmsData[(board * 8) + 1][2] = (uint8_t) ((boardVoltage[1] >> 8) & 0xFF); //cell 2, voltage H
 281:Src/LTC6811.c **** 		bmsData[(board * 8) + 1][3] = (uint8_t) (boardVoltage[1] & 0xFF); //cell 2, voltage L
 282:Src/LTC6811.c **** 		bmsData[(board * 8) + 2][2] = (uint8_t) ((boardVoltage[2] >> 8) & 0xFF); //cell 3, voltage H
ARM GAS  /tmp/ccbi9fCp.s 			page 8


 283:Src/LTC6811.c **** 		bmsData[(board * 8) + 2][3] = (uint8_t) (boardVoltage[2] & 0xFF); //cell 3, voltage L
 284:Src/LTC6811.c **** 		bmsData[(board * 8) + 3][2] = (uint8_t) ((boardVoltage[3] >> 8) & 0xFF); //cell 4, voltage H
 285:Src/LTC6811.c **** 		bmsData[(board * 8) + 3][3] = (uint8_t) (boardVoltage[3] & 0xFF); //cell 4, voltage L 
 286:Src/LTC6811.c **** 		bmsData[(board * 8) + 4][2] = (uint8_t) ((boardVoltage[6] >> 8) & 0xFF); //cell 7, voltage H
 287:Src/LTC6811.c **** 		bmsData[(board * 8) + 4][3] = (uint8_t) (boardVoltage[6] & 0xFF); //cell 7, voltage L 
 288:Src/LTC6811.c **** 		bmsData[(board * 8) + 5][2] = (uint8_t) ((boardVoltage[7] >> 8) & 0xFF); //cell 8, voltage H
 289:Src/LTC6811.c **** 		bmsData[(board * 8) + 5][3] = (uint8_t) (boardVoltage[7] & 0xFF); //cell 8, voltage L
 290:Src/LTC6811.c **** 		bmsData[(board * 8) + 6][2] = (uint8_t) ((boardVoltage[8] >> 8) & 0xFF); //cell 9, voltage H
 291:Src/LTC6811.c **** 		bmsData[(board * 8) + 6][3] = (uint8_t) (boardVoltage[8] & 0xFF); //cell 9, voltage L
 292:Src/LTC6811.c **** 		bmsData[(board * 8) + 7][2] = (uint8_t) ((boardVoltage[9] >> 8) & 0xFF); //cell 10, voltage H
 293:Src/LTC6811.c **** 		bmsData[(board * 8) + 7][3] = (uint8_t) (boardVoltage[9] & 0xFF); //cell 10, voltage L
 294:Src/LTC6811.c **** 	
 295:Src/LTC6811.c **** 	}
 296:Src/LTC6811.c **** 
 297:Src/LTC6811.c **** 	for (uint8_t board = 0; board < 12; board++) {
 298:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 299:Src/LTC6811.c **** 			dataValid = false;
 300:Src/LTC6811.c **** 	}
 301:Src/LTC6811.c **** 
 302:Src/LTC6811.c **** 	return dataValid; //return true if no PEC errors for any board
 303:Src/LTC6811.c **** }
 304:Src/LTC6811.c **** 
 305:Src/LTC6811.c **** bool readCellTemp(uint8_t address, uint16_t cellTemp[4], bool dcFault[4], bool tempFault[4]) {
 306:Src/LTC6811.c **** 	
 307:Src/LTC6811.c **** 	bool PEC_check = false;
 308:Src/LTC6811.c **** 	bool dataValid = true;
 309:Src/LTC6811.c **** 	uint16_t *temp;
 310:Src/LTC6811.c **** 	double dummy[4];
 311:Src/LTC6811.c **** 	double conversion[4];
 312:Src/LTC6811.c **** 	
 313:Src/LTC6811.c **** 	temp = (uint16_t *)malloc(4*sizeof(uint16_t));
 314:Src/LTC6811.c **** 	
 315:Src/LTC6811.c **** 	sendAddressCommand(StartCellTempVoltageADCConversionAll, address);
 316:Src/LTC6811.c **** 	
 317:Src/LTC6811.c **** 	HAL_Delay(50); // conversion time is 12.8ms at 422Hz, so wait 15ms
 318:Src/LTC6811.c **** 	
 319:Src/LTC6811.c **** 	PEC_check = readRegister(ReadAuxiliaryGroupA, address, temp);
 320:Src/LTC6811.c **** 	//dataValid = dataValid & PEC_check;
 321:Src/LTC6811.c **** 	PEC_check = readRegister(ReadAuxiliaryGroupB, address, temp);
 322:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 323:Src/LTC6811.c **** 	PEC_check = readRegister(ReadAuxiliaryGroupA, address, temp);
 324:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 325:Src/LTC6811.c **** 	
 326:Src/LTC6811.c **** 	for (uint8_t i = 0; i < 4; i++) {
 327:Src/LTC6811.c **** 		if ((temp[i] > 24400) || (temp[i] < 13000)) {
 328:Src/LTC6811.c **** 			dcFault[i] = true;
 329:Src/LTC6811.c **** 			cellTemp[i] = 0x0000;
 330:Src/LTC6811.c **** 		}
 331:Src/LTC6811.c **** 		else
 332:Src/LTC6811.c **** 			dcFault[i] = false;
 333:Src/LTC6811.c **** 		
 334:Src/LTC6811.c **** 		if ((temp[i] >= 13000) && (temp[i] < 15100)) {
 335:Src/LTC6811.c **** 			tempFault[i] = true;
 336:Src/LTC6811.c **** 			cellTemp[i] = 0xFFFF;
 337:Src/LTC6811.c **** 		}
 338:Src/LTC6811.c **** 		else
 339:Src/LTC6811.c **** 			tempFault[i] = false;
ARM GAS  /tmp/ccbi9fCp.s 			page 9


 340:Src/LTC6811.c **** 		
 341:Src/LTC6811.c **** 		if ((temp[i] >= 15100) && (temp[i] <= 24400)) {
 342:Src/LTC6811.c **** 			dummy[i] = (double) temp[i] / 10000; // convert from ADC value to voltage
 343:Src/LTC6811.c **** 			// convert from voltage to temperature
 344:Src/LTC6811.c **** 			conversion[i] = 37735 - 113923 * dummy[i] + 142663 * pow(dummy[i], 2) - 94465 * pow(dummy[i], 3)
 345:Src/LTC6811.c **** 			conversion[i] = 500 * (conversion[i] + 20); // map value to larger range
 346:Src/LTC6811.c **** 			cellTemp[i] = (uint16_t) conversion[i];
 347:Src/LTC6811.c **** 		}
 348:Src/LTC6811.c **** 	}
 349:Src/LTC6811.c **** 	
 350:Src/LTC6811.c **** 	free(temp);
 351:Src/LTC6811.c **** 	
 352:Src/LTC6811.c **** 	return (dataValid);
 353:Src/LTC6811.c **** 	
 354:Src/LTC6811.c **** };
 355:Src/LTC6811.c **** 
 356:Src/LTC6811.c **** bool readAllCellTemps(BMSconfigStructTypedef cfg, uint8_t bmsData[96][6]) {
 357:Src/LTC6811.c **** 
 358:Src/LTC6811.c **** 	uint16_t boardTemp[4];
 359:Src/LTC6811.c **** 	bool boardDCFault[4];
 360:Src/LTC6811.c **** 	bool boardTempFault[4];
 361:Src/LTC6811.c **** 	bool PEC_check[12];
 362:Src/LTC6811.c **** 	bool dataValid = true;
 363:Src/LTC6811.c **** 
 364:Src/LTC6811.c **** 	for (uint8_t board = 0; board < 12; board++) {
 365:Src/LTC6811.c **** 
 366:Src/LTC6811.c **** 		//read temperature, check for OT and temp DC
 367:Src/LTC6811.c **** 		PEC_check[board] = readCellTemp(board, boardTemp, boardDCFault, boardTempFault);
 368:Src/LTC6811.c **** 
 369:Src/LTC6811.c **** 		//store OT and temp DC bits in status byte
 370:Src/LTC6811.c **** 		for (uint8_t cell = 0; cell < 8; cell++) {
 371:Src/LTC6811.c **** 			bmsData[(board * 8) + cell][1] &= (PEC_check[board] << 1);
 372:Src/LTC6811.c **** 			bmsData[(board * 8) + cell][1] |= (boardTempFault[cell / 2] << 4);
 373:Src/LTC6811.c **** 			bmsData[(board * 8) + cell][1] |= (boardDCFault[cell / 2] << 3);
 374:Src/LTC6811.c **** 		}
 375:Src/LTC6811.c **** 
 376:Src/LTC6811.c **** 		//store cell temperature in bmsData
 377:Src/LTC6811.c **** 		bmsData[(board * 8) + 0][4] = (uint8_t) ((boardTemp[0] >> 8) & 0xFF); //temp1 H
 378:Src/LTC6811.c **** 		bmsData[(board * 8) + 0][5] = (uint8_t) (boardTemp[0] & 0xFF); //temp1 L
 379:Src/LTC6811.c **** 		bmsData[(board * 8) + 1][4] = (uint8_t) ((boardTemp[0] >> 8) & 0xFF); //temp1 H
 380:Src/LTC6811.c **** 		bmsData[(board * 8) + 1][5] = (uint8_t) (boardTemp[0] & 0xFF); //temp1 L
 381:Src/LTC6811.c **** 		bmsData[(board * 8) + 2][4] = (uint8_t) ((boardTemp[1] >> 8) & 0xFF); //temp2 H
 382:Src/LTC6811.c **** 		bmsData[(board * 8) + 2][5] = (uint8_t) (boardTemp[1] & 0xFF); //temp2 L
 383:Src/LTC6811.c **** 		bmsData[(board * 8) + 3][4] = (uint8_t) ((boardTemp[1] >> 8) & 0xFF); //temp2 H
 384:Src/LTC6811.c **** 		bmsData[(board * 8) + 3][5] = (uint8_t) (boardTemp[1] & 0xFF); //temp2 L
 385:Src/LTC6811.c **** 		bmsData[(board * 8) + 4][4] = (uint8_t) ((boardTemp[2] >> 8) & 0xFF); //temp3 H
 386:Src/LTC6811.c **** 		bmsData[(board * 8) + 4][5] = (uint8_t) (boardTemp[2] & 0xFF); //temp3 L
 387:Src/LTC6811.c **** 		bmsData[(board * 8) + 5][4] = (uint8_t) ((boardTemp[2] >> 8) & 0xFF); //temp3 H
 388:Src/LTC6811.c **** 		bmsData[(board * 8) + 5][5] = (uint8_t) (boardTemp[2] & 0xFF); //temp3 L
 389:Src/LTC6811.c **** 		bmsData[(board * 8) + 6][4] = (uint8_t) ((boardTemp[3] >> 8) & 0xFF); //temp4 H
 390:Src/LTC6811.c **** 		bmsData[(board * 8) + 6][5] = (uint8_t) (boardTemp[3] & 0xFF); //temp4 L
 391:Src/LTC6811.c **** 		bmsData[(board * 8) + 7][4] = (uint8_t) ((boardTemp[3] >> 8) & 0xFF); //temp4 H
 392:Src/LTC6811.c **** 		bmsData[(board * 8) + 7][5] = (uint8_t) (boardTemp[3] & 0xFF); //temp4 L
 393:Src/LTC6811.c **** 	}
 394:Src/LTC6811.c **** 	
 395:Src/LTC6811.c **** 	for (uint8_t board = 0; board < 12; board++) {
 396:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
ARM GAS  /tmp/ccbi9fCp.s 			page 10


 397:Src/LTC6811.c **** 			dataValid = false;
 398:Src/LTC6811.c **** 	}
 399:Src/LTC6811.c **** 
 400:Src/LTC6811.c **** 	return dataValid;
 401:Src/LTC6811.c **** }
 402:Src/LTC6811.c **** 
 403:Src/LTC6811.c **** bool readConfig(uint8_t address, uint8_t cfg[8]) {
 404:Src/LTC6811.c **** 	
 405:Src/LTC6811.c **** 	uint16_t *config;
 406:Src/LTC6811.c **** 	bool dataValid = false;
 407:Src/LTC6811.c **** 	
 408:Src/LTC6811.c **** 	config = (uint16_t *)malloc(4*sizeof(uint16_t));
 409:Src/LTC6811.c **** 	
 410:Src/LTC6811.c **** 	dataValid = readRegister(ReadConfigurationRegisterGroup, address, config);
 411:Src/LTC6811.c **** 	
 412:Src/LTC6811.c **** 	cfg[0] = (uint8_t) ((config[0] >> 8) & 0xFF);
 413:Src/LTC6811.c **** 	cfg[1] = (uint8_t) (config[0] & 0xFF);
 414:Src/LTC6811.c **** 	cfg[2] = (uint8_t) ((config[1] >> 8) & 0xFF);
 415:Src/LTC6811.c **** 	cfg[3] = (uint8_t) (config[1] & 0xFF);
 416:Src/LTC6811.c **** 	cfg[4] = (uint8_t) ((config[2] >> 8) & 0xFF);
 417:Src/LTC6811.c **** 	cfg[5] = (uint8_t) (config[2] & 0xFF);
 418:Src/LTC6811.c **** 	cfg[6] = (uint8_t) ((config[3] >> 8) & 0xFF);
 419:Src/LTC6811.c **** 	cfg[7] = (uint8_t) (config[3] & 0xFF);
 420:Src/LTC6811.c **** 	
 421:Src/LTC6811.c **** 	return dataValid;
 422:Src/LTC6811.c **** }
 423:Src/LTC6811.c **** 
 424:Src/LTC6811.c **** /*bool checkCellConnection(uint8_t address, uint16_t cellVoltage[12], bool cellConnection[12]) {
 425:Src/LTC6811.c **** 		
 426:Src/LTC6811.c **** 
 427:Src/LTC6811.c **** 	
 428:Src/LTC6811.c **** 	for (uint8_t i = 0; i < 12; i++) {
 429:Src/LTC6811.c **** 		// if voltage fell by > 100mV
 430:Src/LTC6811.c **** 		if ((cellVoltage[i] - ADOWvoltage[i]) > 1000) {
 431:Src/LTC6811.c **** 			cellConnection[i] = 0; // cell is disconnected
 432:Src/LTC6811.c **** 			disconnect = true;
 433:Src/LTC6811.c **** 		}
 434:Src/LTC6811.c **** 		else {
 435:Src/LTC6811.c **** 			cellConnection[i] = 1;
 436:Src/LTC6811.c **** 		}
 437:Src/LTC6811.c **** 	}
 438:Src/LTC6811.c **** 	return disconnect;
 439:Src/LTC6811.c **** }*/
 440:Src/LTC6811.c **** 
 441:Src/LTC6811.c **** bool checkAllCellConnections(BMSconfigStructTypedef cfg, uint8_t bmsData[96][6]) {
 442:Src/LTC6811.c **** 	
 443:Src/LTC6811.c **** 	uint16_t ADOWvoltage[cfg.numOfCellInputs];
 444:Src/LTC6811.c **** 	uint16_t cellVoltage;
 445:Src/LTC6811.c **** 	bool disconnect = false;
 446:Src/LTC6811.c **** 
 447:Src/LTC6811.c **** 	//at least 2
 448:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 449:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 450:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 451:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 452:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 453:Src/LTC6811.c **** 
ARM GAS  /tmp/ccbi9fCp.s 			page 11


 454:Src/LTC6811.c **** 	HAL_Delay(15);
 455:Src/LTC6811.c **** 
 456:Src/LTC6811.c **** 	for (uint8_t board = 0; board < cfg.numOfICs; board++) {
 457:Src/LTC6811.c **** 
 458:Src/LTC6811.c **** 		readCellVoltage(cfg.address[board], ADOWvoltage);
 459:Src/LTC6811.c **** 
 460:Src/LTC6811.c **** 		for (uint8_t cell = 0; cell < cfg.numOfCellsPerIC; cell++) {
 461:Src/LTC6811.c **** 
 462:Src/LTC6811.c **** 			cellVoltage = 0;
 463:Src/LTC6811.c **** 			cellVoltage = (uint16_t) (bmsData[(board * cfg.numOfCellsPerIC) + cell][2]);
 464:Src/LTC6811.c **** 			cellVoltage = cellVoltage << 8;
 465:Src/LTC6811.c **** 			cellVoltage += (uint16_t) (bmsData[(board * cfg.numOfCellsPerIC) + cell][3]);
 466:Src/LTC6811.c **** 
 467:Src/LTC6811.c **** 			if ((cellVoltage - ADOWvoltage[cell]) > 1000)
 468:Src/LTC6811.c **** 				bmsData[(board * cfg.numOfCellsPerIC) + cell][1] &= 0xFE;
 469:Src/LTC6811.c **** 			else
 470:Src/LTC6811.c **** 				bmsData[(board * cfg.numOfCellsPerIC) + cell][1] |= 0x01;
 471:Src/LTC6811.c **** 		}
 472:Src/LTC6811.c **** 	}
 473:Src/LTC6811.c **** 
 474:Src/LTC6811.c **** 	return 0;
 475:Src/LTC6811.c **** }
 476:Src/LTC6811.c **** 
 477:Src/LTC6811.c **** bool dischargeCellGroups(BMSconfigStructTypedef config, bool cellDischarge[12][8]) {
 478:Src/LTC6811.c **** 	
 479:Src/LTC6811.c **** 	BMSconfigStructTypedef *cfg;
 480:Src/LTC6811.c **** 
 481:Src/LTC6811.c **** 	cfg = &config;
 482:Src/LTC6811.c **** 
 483:Src/LTC6811.c **** 	for (uint8_t i = 0; i < config.numOfICs; i++) {
 484:Src/LTC6811.c **** 
 485:Src/LTC6811.c **** 		cfg->DischargeCell1 = cellDischarge[i][0];
 486:Src/LTC6811.c **** 		cfg->DischargeCell2 = cellDischarge[i][1];
 487:Src/LTC6811.c **** 		cfg->DischargeCell3 = cellDischarge[i][2];
 488:Src/LTC6811.c **** 		cfg->DischargeCell4 = cellDischarge[i][3];
 489:Src/LTC6811.c **** 		cfg->DischargeCell7 = cellDischarge[i][4];
 490:Src/LTC6811.c **** 		cfg->DischargeCell8 = cellDischarge[i][5];
 491:Src/LTC6811.c **** 		cfg->DischargeCell9 = cellDischarge[i][6];
 492:Src/LTC6811.c **** 		cfg->DischargeCell10 = cellDischarge[i][7];
 493:Src/LTC6811.c **** 
 494:Src/LTC6811.c **** 		writeConfigAddress(config, config.address[i]);
 495:Src/LTC6811.c **** 
 496:Src/LTC6811.c **** 	}
 497:Src/LTC6811.c **** 
 498:Src/LTC6811.c **** 	cfg->DischargeCell1 = 0;
 499:Src/LTC6811.c **** 	cfg->DischargeCell2 = 0;
 500:Src/LTC6811.c **** 	cfg->DischargeCell3 = 0;
 501:Src/LTC6811.c **** 	cfg->DischargeCell4 = 0;
 502:Src/LTC6811.c **** 	cfg->DischargeCell7 = 0;
 503:Src/LTC6811.c **** 	cfg->DischargeCell8 = 0;
 504:Src/LTC6811.c **** 	cfg->DischargeCell9 = 0;
 505:Src/LTC6811.c **** 	cfg->DischargeCell10 = 0;
 506:Src/LTC6811.c **** 
 507:Src/LTC6811.c **** 	return 0;
 508:Src/LTC6811.c **** 	
 509:Src/LTC6811.c **** }
 510:Src/LTC6811.c **** 
ARM GAS  /tmp/ccbi9fCp.s 			page 12


 511:Src/LTC6811.c **** /*bool dischargeCell(BMSconfigStructTypedef config, bool cellDischarge[8]) {
 512:Src/LTC6811.c **** 	
 513:Src/LTC6811.c **** 	BMSconfigStructTypedef *cfg;
 514:Src/LTC6811.c **** 	cfg = &config;
 515:Src/LTC6811.c **** 	
 516:Src/LTC6811.c **** 	cfg->DischargeCell1 = cellDischarge[0];
 517:Src/LTC6811.c **** 	cfg->DischargeCell2 = cellDischarge[1];
 518:Src/LTC6811.c **** 	cfg->DischargeCell3 = cellDischarge[2];
 519:Src/LTC6811.c **** 	cfg->DischargeCell4 = cellDischarge[3];
 520:Src/LTC6811.c **** 	cfg->DischargeCell7 = cellDischarge[4];
 521:Src/LTC6811.c **** 	cfg->DischargeCell8 = cellDischarge[5];
 522:Src/LTC6811.c **** 	cfg->DischargeCell9 = cellDischarge[6];
 523:Src/LTC6811.c **** 	cfg->DischargeCell10 = cellDischarge[7];
 524:Src/LTC6811.c **** 	
 525:Src/LTC6811.c **** 	writeConfig(config, 0, 1);
 526:Src/LTC6811.c **** 	
 527:Src/LTC6811.c **** 	return 0;
 528:Src/LTC6811.c **** 	
 529:Src/LTC6811.c **** }*/
 530:Src/LTC6811.c **** 
 531:Src/LTC6811.c **** bool readRegister(CommandCodeTypedef command, uint8_t address, uint16_t *data) {
 532:Src/LTC6811.c **** 	
 533:Src/LTC6811.c **** 	uint8_t cmd[12];
 534:Src/LTC6811.c **** 	uint8_t rx_data[12];
 535:Src/LTC6811.c **** 	uint16_t PEC_return;
 536:Src/LTC6811.c **** 	uint8_t *PEC_send;
 537:Src/LTC6811.c **** 	bool dataValid = true;
 538:Src/LTC6811.c **** 
 539:Src/LTC6811.c **** 	PEC_send = (uint8_t *)malloc(6*sizeof(uint8_t));
 540:Src/LTC6811.c **** 	
 541:Src/LTC6811.c **** 	PEC_send[0] = (uint8_t) (0x80 | ((address << 3) & 0x78) | ((command >> 8) & 0x07));
 542:Src/LTC6811.c **** 	PEC_send[1] = (uint8_t) (command & 0xFF);
 543:Src/LTC6811.c **** 
 544:Src/LTC6811.c **** 	cmd[0] = PEC_send[0];
 545:Src/LTC6811.c **** 	cmd[1] = PEC_send[1];
 546:Src/LTC6811.c **** 	
 547:Src/LTC6811.c **** 	PEC_return = calculatePEC(2, PEC_send);
 548:Src/LTC6811.c **** 	
 549:Src/LTC6811.c **** 	cmd[2] = (PEC_return >> 8) & 0xFF;
 550:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 551:Src/LTC6811.c **** 	
 552:Src/LTC6811.c **** 	cmd[4] = 0;
 553:Src/LTC6811.c **** 	cmd[5] = 0;
 554:Src/LTC6811.c **** 	cmd[6] = 0;
 555:Src/LTC6811.c **** 	cmd[7] = 0;
 556:Src/LTC6811.c **** 	cmd[8] = 0;
 557:Src/LTC6811.c **** 	cmd[9] = 0;
 558:Src/LTC6811.c **** 	cmd[10] = 0;
 559:Src/LTC6811.c **** 	cmd[11] = 0;
 560:Src/LTC6811.c **** 	
 561:Src/LTC6811.c **** 	SPIWriteRead(cmd, rx_data, sizeof(cmd)); // send 4 command bytes, receive 6 cell voltage bytes (4-
 562:Src/LTC6811.c **** 	
 563:Src/LTC6811.c **** 	// calculate PEC based on cell voltage data received
 564:Src/LTC6811.c **** 	PEC_send[0] = rx_data[4]; // cell 1 voltage low bytes
 565:Src/LTC6811.c **** 	PEC_send[1] = rx_data[5]; // cell 1 voltage high bytes
 566:Src/LTC6811.c **** 	PEC_send[2] = rx_data[6]; // cell 2 voltage low bytes
 567:Src/LTC6811.c **** 	PEC_send[3] = rx_data[7]; // cell 2 voltage high bytes
ARM GAS  /tmp/ccbi9fCp.s 			page 13


 568:Src/LTC6811.c **** 	PEC_send[4] = rx_data[8]; // cell 3 voltage low bytes
 569:Src/LTC6811.c **** 	PEC_send[5] = rx_data[9]; // cell 3 voltage high bytes
 570:Src/LTC6811.c **** 	
 571:Src/LTC6811.c **** 	PEC_return = calculatePEC(6, PEC_send);
 572:Src/LTC6811.c **** 	
 573:Src/LTC6811.c **** 	// check if received PEC matches calculated PEC
 574:Src/LTC6811.c **** 	if (PEC_return != (((rx_data[10] << 8) & 0xFF00) | (rx_data[11] & 0x00FF))) {
 575:Src/LTC6811.c **** 		dataValid = false;
 576:Src/LTC6811.c **** 	}
 577:Src/LTC6811.c **** 	
 578:Src/LTC6811.c **** 	if (command == ReadCellVoltageRegisterGroup1to3) {
 579:Src/LTC6811.c **** 		
 580:Src/LTC6811.c **** 		data[0] = (uint16_t) ((rx_data[5] << 8) & 0xFF00) | (rx_data[4] & 0x00FF);
 581:Src/LTC6811.c **** 		data[1] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 582:Src/LTC6811.c **** 		data[2] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 583:Src/LTC6811.c **** 		//data[3] = (uint16_t) ((rx_data[10] << 8) & 0xFF00) | (rx_data[11] & 0x00FF);
 584:Src/LTC6811.c **** 		//data[4] = PEC_return;
 585:Src/LTC6811.c **** 	}
 586:Src/LTC6811.c **** 
 587:Src/LTC6811.c **** 	if (command == ReadCellVoltageRegisterGroup4to6) {
 588:Src/LTC6811.c **** 		
 589:Src/LTC6811.c **** 		data[3] = (uint16_t) ((rx_data[5] << 8) & 0xFF00) | (rx_data[4] & 0x00FF);
 590:Src/LTC6811.c **** 		data[4] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 591:Src/LTC6811.c **** 		data[5] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 592:Src/LTC6811.c **** 	}
 593:Src/LTC6811.c **** 	
 594:Src/LTC6811.c **** 	if (command == ReadCellVoltageRegisterGroup7to9) {
 595:Src/LTC6811.c **** 		
 596:Src/LTC6811.c **** 		data[6] = (uint16_t) ((rx_data[5] << 8) & 0xFF00) | (rx_data[4] & 0x00FF);
 597:Src/LTC6811.c **** 		data[7] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 598:Src/LTC6811.c **** 		data[8] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 599:Src/LTC6811.c **** 	}
 600:Src/LTC6811.c **** 	
 601:Src/LTC6811.c **** 	if (command == ReadCellVoltageRegisterGroup10to12) {
 602:Src/LTC6811.c **** 		
 603:Src/LTC6811.c **** 		data[9] = (uint16_t) ((rx_data[5] << 8) & 0xFF00) | (rx_data[4] & 0x00FF);
 604:Src/LTC6811.c **** 		data[10] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 605:Src/LTC6811.c **** 		data[11] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 606:Src/LTC6811.c **** 	}
 607:Src/LTC6811.c **** 	
 608:Src/LTC6811.c **** 	if (command == ReadAuxiliaryGroupA) {
 609:Src/LTC6811.c **** 		
 610:Src/LTC6811.c **** 		data[0] = (uint16_t) ((rx_data[5] << 8) & 0xFF00) | (rx_data[4] & 0x00FF);
 611:Src/LTC6811.c **** 		data[1] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 612:Src/LTC6811.c **** 		data[2] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 613:Src/LTC6811.c **** 	}
 614:Src/LTC6811.c **** 	
 615:Src/LTC6811.c **** 	if (command == ReadAuxiliaryGroupB) {
 616:Src/LTC6811.c **** 		data[3] = (uint16_t) ((rx_data[5] << 8) & 0xFF00) | (rx_data[4] & 0x00FF);
 617:Src/LTC6811.c **** 	}
 618:Src/LTC6811.c **** 	
 619:Src/LTC6811.c **** 	if (command == ReadConfigurationRegisterGroup) {
 620:Src/LTC6811.c **** 		data[0] = (uint16_t) ((rx_data[4] << 8) & 0xFF00) | (rx_data[5] & 0x00FF);
 621:Src/LTC6811.c **** 		data[1] = (uint16_t) ((rx_data[6] << 8) & 0xFF00) | (rx_data[7] & 0x00FF);
 622:Src/LTC6811.c **** 		data[2] = (uint16_t) ((rx_data[8] << 8) & 0xFF00) | (rx_data[9] & 0x00FF);
 623:Src/LTC6811.c **** 		data[3] = (uint16_t) ((rx_data[10] << 8) & 0xFF00) | (rx_data[11] & 0x00FF);
 624:Src/LTC6811.c **** 	}
ARM GAS  /tmp/ccbi9fCp.s 			page 14


 625:Src/LTC6811.c **** 	
 626:Src/LTC6811.c **** 	return(dataValid);
 627:Src/LTC6811.c **** 	
 628:Src/LTC6811.c **** };
 629:Src/LTC6811.c **** 
 630:Src/LTC6811.c **** void sendBroadcastCommand(CommandCodeTypedef command) {
 631:Src/LTC6811.c **** 	
 632:Src/LTC6811.c **** 	uint8_t cmd[4];
 633:Src/LTC6811.c **** 	uint16_t PEC_return;
 634:Src/LTC6811.c **** 	
 635:Src/LTC6811.c **** 	cmd[0] = (uint8_t) ((command >> 8) & 0x0F);
 636:Src/LTC6811.c **** 	cmd[1] = (uint8_t) (command & 0xFF);
 637:Src/LTC6811.c **** 	
 638:Src/LTC6811.c **** 	PEC_return = calculatePEC(2, (uint8_t *)&(cmd));
 639:Src/LTC6811.c **** 	
 640:Src/LTC6811.c **** 	cmd[2] = (PEC_return >> 8) & 0xFF;
 641:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 642:Src/LTC6811.c **** 	
 643:Src/LTC6811.c **** 	SPIWrite(cmd, 4);
 644:Src/LTC6811.c **** };
 645:Src/LTC6811.c **** 
 646:Src/LTC6811.c **** void sendAddressCommand(CommandCodeTypedef command, uint8_t address) {
 647:Src/LTC6811.c **** 	
 648:Src/LTC6811.c **** 	uint8_t cmd[4];
 649:Src/LTC6811.c **** 	uint16_t PEC_return;
 650:Src/LTC6811.c **** 	uint8_t *msbytes;
 651:Src/LTC6811.c **** 	
 652:Src/LTC6811.c **** 	msbytes = (uint8_t *)malloc(2*sizeof(uint8_t));
 653:Src/LTC6811.c **** 	
 654:Src/LTC6811.c **** 	msbytes[0] = (uint8_t) (0x80 | ((address << 3) & 0x78) | ((command >> 8) & 0x07));
 655:Src/LTC6811.c **** 	msbytes[1] = (uint8_t) (command & 0xFF);
 656:Src/LTC6811.c **** 
 657:Src/LTC6811.c **** 	cmd[0] = msbytes[0];
 658:Src/LTC6811.c **** 	cmd[1] = msbytes[1];
 659:Src/LTC6811.c **** 	
 660:Src/LTC6811.c **** 	PEC_return = calculatePEC(2, msbytes);
 661:Src/LTC6811.c **** 	
 662:Src/LTC6811.c **** 	cmd[2] = (PEC_return >> 8) & 0xFF;
 663:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 664:Src/LTC6811.c **** 	
 665:Src/LTC6811.c **** 	SPIWrite(cmd, 4);
 666:Src/LTC6811.c **** 	
 667:Src/LTC6811.c **** 	free(msbytes);
 668:Src/LTC6811.c **** };
 669:Src/LTC6811.c **** 
 670:Src/LTC6811.c **** uint16_t calculatePEC(uint8_t len, uint8_t *data) {
 112              		.loc 1 670 0
 113              		.cfi_startproc
 114              		@ args = 0, pretend = 0, frame = 0
 115              		@ frame_needed = 0, uses_anonymous_args = 0
 116              		@ link register save eliminated.
 117              	.LVL12:
 118 0000 30B4     		push	{r4, r5}
 119              	.LCFI0:
 120              		.cfi_def_cfa_offset 8
 121              		.cfi_offset 4, -8
 122              		.cfi_offset 5, -4
ARM GAS  /tmp/ccbi9fCp.s 			page 15


 123              	.LVL13:
 124              	.LBB5:
 671:Src/LTC6811.c **** 	
 672:Src/LTC6811.c **** 	uint16_t remainder, address;
 673:Src/LTC6811.c **** 	remainder = 16; //PEC seed
 674:Src/LTC6811.c **** 	
 675:Src/LTC6811.c **** 	for (int i = 0; i < len; i++) {
 125              		.loc 1 675 0
 126 0002 0024     		movs	r4, #0
 127              	.LBE5:
 673:Src/LTC6811.c **** 	
 128              		.loc 1 673 0
 129 0004 1023     		movs	r3, #16
 130              	.LBB6:
 131              		.loc 1 675 0
 132 0006 0AE0     		b	.L13
 133              	.LVL14:
 134              	.L14:
 676:Src/LTC6811.c **** 		address = ((remainder >> 7) ^ data[i]) & 0xFF; //calculate PEC table address
 135              		.loc 1 676 0 discriminator 3
 136 0008 0A5D     		ldrb	r2, [r1, r4]	@ zero_extendqisi2
 137 000a 82EAD312 		eor	r2, r2, r3, lsr #7
 138 000e D2B2     		uxtb	r2, r2
 139              	.LVL15:
 677:Src/LTC6811.c **** 		remainder = (remainder << 8) ^ pec15Table[address];
 140              		.loc 1 677 0 discriminator 3
 141 0010 064D     		ldr	r5, .L16
 142 0012 35F91220 		ldrsh	r2, [r5, r2, lsl #1]
 143              	.LVL16:
 144 0016 82EA0323 		eor	r3, r2, r3, lsl #8
 145              	.LVL17:
 146 001a 9BB2     		uxth	r3, r3
 147              	.LVL18:
 675:Src/LTC6811.c **** 		address = ((remainder >> 7) ^ data[i]) & 0xFF; //calculate PEC table address
 148              		.loc 1 675 0 discriminator 3
 149 001c 0134     		adds	r4, r4, #1
 150              	.LVL19:
 151              	.L13:
 675:Src/LTC6811.c **** 		address = ((remainder >> 7) ^ data[i]) & 0xFF; //calculate PEC table address
 152              		.loc 1 675 0 is_stmt 0 discriminator 1
 153 001e A042     		cmp	r0, r4
 154 0020 F2DC     		bgt	.L14
 155              	.LBE6:
 678:Src/LTC6811.c **** 	}
 679:Src/LTC6811.c **** 	
 680:Src/LTC6811.c **** 	return (remainder * 2); //The CRC15 has a 0 in the LSB so the final value must be multiplied by 2
 156              		.loc 1 680 0 is_stmt 1
 157 0022 5800     		lsls	r0, r3, #1
 158              	.LVL20:
 159 0024 80B2     		uxth	r0, r0
 681:Src/LTC6811.c **** };
 160              		.loc 1 681 0
 161 0026 30BC     		pop	{r4, r5}
 162              	.LCFI1:
 163              		.cfi_restore 5
 164              		.cfi_restore 4
 165              		.cfi_def_cfa_offset 0
ARM GAS  /tmp/ccbi9fCp.s 			page 16


 166              	.LVL21:
 167 0028 7047     		bx	lr
 168              	.L17:
 169 002a 00BF     		.align	2
 170              	.L16:
 171 002c 00000000 		.word	pec15Table
 172              		.cfi_endproc
 173              	.LFE79:
 175              		.section	.text.readRegister,"ax",%progbits
 176              		.align	1
 177              		.global	readRegister
 178              		.syntax unified
 179              		.thumb
 180              		.thumb_func
 181              		.fpu softvfp
 183              	readRegister:
 184              	.LFB76:
 531:Src/LTC6811.c **** 	
 185              		.loc 1 531 0
 186              		.cfi_startproc
 187              		@ args = 0, pretend = 0, frame = 24
 188              		@ frame_needed = 0, uses_anonymous_args = 0
 189              	.LVL22:
 190 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 191              	.LCFI2:
 192              		.cfi_def_cfa_offset 20
 193              		.cfi_offset 4, -20
 194              		.cfi_offset 5, -16
 195              		.cfi_offset 6, -12
 196              		.cfi_offset 7, -8
 197              		.cfi_offset 14, -4
 198 0002 87B0     		sub	sp, sp, #28
 199              	.LCFI3:
 200              		.cfi_def_cfa_offset 48
 201 0004 0646     		mov	r6, r0
 202 0006 0C46     		mov	r4, r1
 203 0008 1746     		mov	r7, r2
 204              	.LVL23:
 539:Src/LTC6811.c **** 	
 205              		.loc 1 539 0
 206 000a 0620     		movs	r0, #6
 207              	.LVL24:
 208 000c FFF7FEFF 		bl	malloc
 209              	.LVL25:
 210 0010 0546     		mov	r5, r0
 211              	.LVL26:
 541:Src/LTC6811.c **** 	PEC_send[1] = (uint8_t) (command & 0xFF);
 212              		.loc 1 541 0
 213 0012 E300     		lsls	r3, r4, #3
 214 0014 03F07803 		and	r3, r3, #120
 215 0018 63F07F03 		orn	r3, r3, #127
 216 001c C6F30224 		ubfx	r4, r6, #8, #3
 217 0020 2343     		orrs	r3, r3, r4
 218 0022 DBB2     		uxtb	r3, r3
 219 0024 0370     		strb	r3, [r0]
 542:Src/LTC6811.c **** 
 220              		.loc 1 542 0
ARM GAS  /tmp/ccbi9fCp.s 			page 17


 221 0026 F2B2     		uxtb	r2, r6
 222 0028 4270     		strb	r2, [r0, #1]
 544:Src/LTC6811.c **** 	cmd[1] = PEC_send[1];
 223              		.loc 1 544 0
 224 002a 8DF80C30 		strb	r3, [sp, #12]
 545:Src/LTC6811.c **** 	
 225              		.loc 1 545 0
 226 002e 8DF80D20 		strb	r2, [sp, #13]
 547:Src/LTC6811.c **** 	
 227              		.loc 1 547 0
 228 0032 0146     		mov	r1, r0
 229 0034 0220     		movs	r0, #2
 230              	.LVL27:
 231 0036 FFF7FEFF 		bl	calculatePEC
 232              	.LVL28:
 549:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 233              		.loc 1 549 0
 234 003a 030A     		lsrs	r3, r0, #8
 235 003c 8DF80E30 		strb	r3, [sp, #14]
 550:Src/LTC6811.c **** 	
 236              		.loc 1 550 0
 237 0040 8DF80F00 		strb	r0, [sp, #15]
 552:Src/LTC6811.c **** 	cmd[5] = 0;
 238              		.loc 1 552 0
 239 0044 0023     		movs	r3, #0
 240 0046 8DF81030 		strb	r3, [sp, #16]
 553:Src/LTC6811.c **** 	cmd[6] = 0;
 241              		.loc 1 553 0
 242 004a 8DF81130 		strb	r3, [sp, #17]
 554:Src/LTC6811.c **** 	cmd[7] = 0;
 243              		.loc 1 554 0
 244 004e 8DF81230 		strb	r3, [sp, #18]
 555:Src/LTC6811.c **** 	cmd[8] = 0;
 245              		.loc 1 555 0
 246 0052 8DF81330 		strb	r3, [sp, #19]
 556:Src/LTC6811.c **** 	cmd[9] = 0;
 247              		.loc 1 556 0
 248 0056 8DF81430 		strb	r3, [sp, #20]
 557:Src/LTC6811.c **** 	cmd[10] = 0;
 249              		.loc 1 557 0
 250 005a 8DF81530 		strb	r3, [sp, #21]
 558:Src/LTC6811.c **** 	cmd[11] = 0;
 251              		.loc 1 558 0
 252 005e 8DF81630 		strb	r3, [sp, #22]
 559:Src/LTC6811.c **** 	
 253              		.loc 1 559 0
 254 0062 8DF81730 		strb	r3, [sp, #23]
 561:Src/LTC6811.c **** 	
 255              		.loc 1 561 0
 256 0066 0C22     		movs	r2, #12
 257 0068 6946     		mov	r1, sp
 258 006a 0DEB0200 		add	r0, sp, r2
 259              	.LVL29:
 260 006e FFF7FEFF 		bl	SPIWriteRead
 261              	.LVL30:
 564:Src/LTC6811.c **** 	PEC_send[1] = rx_data[5]; // cell 1 voltage high bytes
 262              		.loc 1 564 0
ARM GAS  /tmp/ccbi9fCp.s 			page 18


 263 0072 9DF80430 		ldrb	r3, [sp, #4]	@ zero_extendqisi2
 264 0076 2B70     		strb	r3, [r5]
 565:Src/LTC6811.c **** 	PEC_send[2] = rx_data[6]; // cell 2 voltage low bytes
 265              		.loc 1 565 0
 266 0078 9DF80530 		ldrb	r3, [sp, #5]	@ zero_extendqisi2
 267 007c 6B70     		strb	r3, [r5, #1]
 566:Src/LTC6811.c **** 	PEC_send[3] = rx_data[7]; // cell 2 voltage high bytes
 268              		.loc 1 566 0
 269 007e 9DF80630 		ldrb	r3, [sp, #6]	@ zero_extendqisi2
 270 0082 AB70     		strb	r3, [r5, #2]
 567:Src/LTC6811.c **** 	PEC_send[4] = rx_data[8]; // cell 3 voltage low bytes
 271              		.loc 1 567 0
 272 0084 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 273 0088 EB70     		strb	r3, [r5, #3]
 568:Src/LTC6811.c **** 	PEC_send[5] = rx_data[9]; // cell 3 voltage high bytes
 274              		.loc 1 568 0
 275 008a 9DF80830 		ldrb	r3, [sp, #8]	@ zero_extendqisi2
 276 008e 2B71     		strb	r3, [r5, #4]
 569:Src/LTC6811.c **** 	
 277              		.loc 1 569 0
 278 0090 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 279 0094 6B71     		strb	r3, [r5, #5]
 571:Src/LTC6811.c **** 	
 280              		.loc 1 571 0
 281 0096 2946     		mov	r1, r5
 282 0098 0620     		movs	r0, #6
 283 009a FFF7FEFF 		bl	calculatePEC
 284              	.LVL31:
 574:Src/LTC6811.c **** 		dataValid = false;
 285              		.loc 1 574 0
 286 009e 9DF80A20 		ldrb	r2, [sp, #10]	@ zero_extendqisi2
 287 00a2 9DF80B30 		ldrb	r3, [sp, #11]	@ zero_extendqisi2
 288 00a6 43EA0223 		orr	r3, r3, r2, lsl #8
 289 00aa 9842     		cmp	r0, r3
 290 00ac 12D0     		beq	.L29
 575:Src/LTC6811.c **** 	}
 291              		.loc 1 575 0
 292 00ae 0020     		movs	r0, #0
 293              	.LVL32:
 294              	.L19:
 578:Src/LTC6811.c **** 		
 295              		.loc 1 578 0
 296 00b0 042E     		cmp	r6, #4
 297 00b2 11D0     		beq	.L30
 298              	.L20:
 587:Src/LTC6811.c **** 		
 299              		.loc 1 587 0
 300 00b4 062E     		cmp	r6, #6
 301 00b6 28D0     		beq	.L31
 302              	.L21:
 594:Src/LTC6811.c **** 		
 303              		.loc 1 594 0
 304 00b8 082E     		cmp	r6, #8
 305 00ba 3FD0     		beq	.L32
 306              	.L22:
 601:Src/LTC6811.c **** 		
 307              		.loc 1 601 0
ARM GAS  /tmp/ccbi9fCp.s 			page 19


 308 00bc 0A2E     		cmp	r6, #10
 309 00be 56D0     		beq	.L33
 310              	.L23:
 608:Src/LTC6811.c **** 		
 311              		.loc 1 608 0
 312 00c0 0C2E     		cmp	r6, #12
 313 00c2 6DD0     		beq	.L34
 314              	.L24:
 615:Src/LTC6811.c **** 		data[3] = (uint16_t) ((rx_data[5] << 8) & 0xFF00) | (rx_data[4] & 0x00FF);
 315              		.loc 1 615 0
 316 00c4 0E2E     		cmp	r6, #14
 317 00c6 00F08480 		beq	.L35
 318              	.L25:
 619:Src/LTC6811.c **** 		data[0] = (uint16_t) ((rx_data[4] << 8) & 0xFF00) | (rx_data[5] & 0x00FF);
 319              		.loc 1 619 0
 320 00ca 022E     		cmp	r6, #2
 321 00cc 00F08A80 		beq	.L36
 322              	.L26:
 628:Src/LTC6811.c **** 
 323              		.loc 1 628 0
 324 00d0 07B0     		add	sp, sp, #28
 325              	.LCFI4:
 326              		.cfi_remember_state
 327              		.cfi_def_cfa_offset 20
 328              		@ sp needed
 329 00d2 F0BD     		pop	{r4, r5, r6, r7, pc}
 330              	.LVL33:
 331              	.L29:
 332              	.LCFI5:
 333              		.cfi_restore_state
 537:Src/LTC6811.c **** 
 334              		.loc 1 537 0
 335 00d4 0120     		movs	r0, #1
 336              	.LVL34:
 337 00d6 EBE7     		b	.L19
 338              	.LVL35:
 339              	.L30:
 580:Src/LTC6811.c **** 		data[1] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 340              		.loc 1 580 0
 341 00d8 9DF80530 		ldrb	r3, [sp, #5]	@ zero_extendqisi2
 342 00dc 1B02     		lsls	r3, r3, #8
 343 00de 1BB2     		sxth	r3, r3
 344 00e0 9DF80420 		ldrb	r2, [sp, #4]	@ zero_extendqisi2
 345 00e4 1343     		orrs	r3, r3, r2
 346 00e6 3B80     		strh	r3, [r7]	@ movhi
 581:Src/LTC6811.c **** 		data[2] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 347              		.loc 1 581 0
 348 00e8 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 349 00ec 1B02     		lsls	r3, r3, #8
 350 00ee 1BB2     		sxth	r3, r3
 351 00f0 9DF80620 		ldrb	r2, [sp, #6]	@ zero_extendqisi2
 352 00f4 1343     		orrs	r3, r3, r2
 353 00f6 7B80     		strh	r3, [r7, #2]	@ movhi
 582:Src/LTC6811.c **** 		//data[3] = (uint16_t) ((rx_data[10] << 8) & 0xFF00) | (rx_data[11] & 0x00FF);
 354              		.loc 1 582 0
 355 00f8 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 356 00fc 1B02     		lsls	r3, r3, #8
ARM GAS  /tmp/ccbi9fCp.s 			page 20


 357 00fe 1BB2     		sxth	r3, r3
 358 0100 9DF80820 		ldrb	r2, [sp, #8]	@ zero_extendqisi2
 359 0104 1343     		orrs	r3, r3, r2
 360 0106 BB80     		strh	r3, [r7, #4]	@ movhi
 361 0108 D4E7     		b	.L20
 362              	.L31:
 589:Src/LTC6811.c **** 		data[4] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 363              		.loc 1 589 0
 364 010a 9DF80530 		ldrb	r3, [sp, #5]	@ zero_extendqisi2
 365 010e 1B02     		lsls	r3, r3, #8
 366 0110 1BB2     		sxth	r3, r3
 367 0112 9DF80420 		ldrb	r2, [sp, #4]	@ zero_extendqisi2
 368 0116 1343     		orrs	r3, r3, r2
 369 0118 FB80     		strh	r3, [r7, #6]	@ movhi
 590:Src/LTC6811.c **** 		data[5] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 370              		.loc 1 590 0
 371 011a 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 372 011e 1B02     		lsls	r3, r3, #8
 373 0120 1BB2     		sxth	r3, r3
 374 0122 9DF80620 		ldrb	r2, [sp, #6]	@ zero_extendqisi2
 375 0126 1343     		orrs	r3, r3, r2
 376 0128 3B81     		strh	r3, [r7, #8]	@ movhi
 591:Src/LTC6811.c **** 	}
 377              		.loc 1 591 0
 378 012a 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 379 012e 1B02     		lsls	r3, r3, #8
 380 0130 1BB2     		sxth	r3, r3
 381 0132 9DF80820 		ldrb	r2, [sp, #8]	@ zero_extendqisi2
 382 0136 1343     		orrs	r3, r3, r2
 383 0138 7B81     		strh	r3, [r7, #10]	@ movhi
 384 013a BDE7     		b	.L21
 385              	.L32:
 596:Src/LTC6811.c **** 		data[7] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 386              		.loc 1 596 0
 387 013c 9DF80530 		ldrb	r3, [sp, #5]	@ zero_extendqisi2
 388 0140 1B02     		lsls	r3, r3, #8
 389 0142 1BB2     		sxth	r3, r3
 390 0144 9DF80420 		ldrb	r2, [sp, #4]	@ zero_extendqisi2
 391 0148 1343     		orrs	r3, r3, r2
 392 014a BB81     		strh	r3, [r7, #12]	@ movhi
 597:Src/LTC6811.c **** 		data[8] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 393              		.loc 1 597 0
 394 014c 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 395 0150 1B02     		lsls	r3, r3, #8
 396 0152 1BB2     		sxth	r3, r3
 397 0154 9DF80620 		ldrb	r2, [sp, #6]	@ zero_extendqisi2
 398 0158 1343     		orrs	r3, r3, r2
 399 015a FB81     		strh	r3, [r7, #14]	@ movhi
 598:Src/LTC6811.c **** 	}
 400              		.loc 1 598 0
 401 015c 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 402 0160 1B02     		lsls	r3, r3, #8
 403 0162 1BB2     		sxth	r3, r3
 404 0164 9DF80820 		ldrb	r2, [sp, #8]	@ zero_extendqisi2
 405 0168 1343     		orrs	r3, r3, r2
 406 016a 3B82     		strh	r3, [r7, #16]	@ movhi
 407 016c A6E7     		b	.L22
ARM GAS  /tmp/ccbi9fCp.s 			page 21


 408              	.L33:
 603:Src/LTC6811.c **** 		data[10] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 409              		.loc 1 603 0
 410 016e 9DF80530 		ldrb	r3, [sp, #5]	@ zero_extendqisi2
 411 0172 1B02     		lsls	r3, r3, #8
 412 0174 1BB2     		sxth	r3, r3
 413 0176 9DF80420 		ldrb	r2, [sp, #4]	@ zero_extendqisi2
 414 017a 1343     		orrs	r3, r3, r2
 415 017c 7B82     		strh	r3, [r7, #18]	@ movhi
 604:Src/LTC6811.c **** 		data[11] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 416              		.loc 1 604 0
 417 017e 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 418 0182 1B02     		lsls	r3, r3, #8
 419 0184 1BB2     		sxth	r3, r3
 420 0186 9DF80620 		ldrb	r2, [sp, #6]	@ zero_extendqisi2
 421 018a 1343     		orrs	r3, r3, r2
 422 018c BB82     		strh	r3, [r7, #20]	@ movhi
 605:Src/LTC6811.c **** 	}
 423              		.loc 1 605 0
 424 018e 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 425 0192 1B02     		lsls	r3, r3, #8
 426 0194 1BB2     		sxth	r3, r3
 427 0196 9DF80820 		ldrb	r2, [sp, #8]	@ zero_extendqisi2
 428 019a 1343     		orrs	r3, r3, r2
 429 019c FB82     		strh	r3, [r7, #22]	@ movhi
 430 019e 8FE7     		b	.L23
 431              	.L34:
 610:Src/LTC6811.c **** 		data[1] = (uint16_t) ((rx_data[7] << 8) & 0xFF00) | (rx_data[6] & 0x00FF);
 432              		.loc 1 610 0
 433 01a0 9DF80530 		ldrb	r3, [sp, #5]	@ zero_extendqisi2
 434 01a4 1B02     		lsls	r3, r3, #8
 435 01a6 1BB2     		sxth	r3, r3
 436 01a8 9DF80420 		ldrb	r2, [sp, #4]	@ zero_extendqisi2
 437 01ac 1343     		orrs	r3, r3, r2
 438 01ae 3B80     		strh	r3, [r7]	@ movhi
 611:Src/LTC6811.c **** 		data[2] = (uint16_t) ((rx_data[9] << 8) & 0xFF00) | (rx_data[8] & 0x00FF);
 439              		.loc 1 611 0
 440 01b0 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 441 01b4 1B02     		lsls	r3, r3, #8
 442 01b6 1BB2     		sxth	r3, r3
 443 01b8 9DF80620 		ldrb	r2, [sp, #6]	@ zero_extendqisi2
 444 01bc 1343     		orrs	r3, r3, r2
 445 01be 7B80     		strh	r3, [r7, #2]	@ movhi
 612:Src/LTC6811.c **** 	}
 446              		.loc 1 612 0
 447 01c0 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 448 01c4 1B02     		lsls	r3, r3, #8
 449 01c6 1BB2     		sxth	r3, r3
 450 01c8 9DF80820 		ldrb	r2, [sp, #8]	@ zero_extendqisi2
 451 01cc 1343     		orrs	r3, r3, r2
 452 01ce BB80     		strh	r3, [r7, #4]	@ movhi
 453 01d0 78E7     		b	.L24
 454              	.L35:
 616:Src/LTC6811.c **** 	}
 455              		.loc 1 616 0
 456 01d2 9DF80530 		ldrb	r3, [sp, #5]	@ zero_extendqisi2
 457 01d6 1B02     		lsls	r3, r3, #8
ARM GAS  /tmp/ccbi9fCp.s 			page 22


 458 01d8 1BB2     		sxth	r3, r3
 459 01da 9DF80420 		ldrb	r2, [sp, #4]	@ zero_extendqisi2
 460 01de 1343     		orrs	r3, r3, r2
 461 01e0 FB80     		strh	r3, [r7, #6]	@ movhi
 462 01e2 72E7     		b	.L25
 463              	.L36:
 620:Src/LTC6811.c **** 		data[1] = (uint16_t) ((rx_data[6] << 8) & 0xFF00) | (rx_data[7] & 0x00FF);
 464              		.loc 1 620 0
 465 01e4 9DF80430 		ldrb	r3, [sp, #4]	@ zero_extendqisi2
 466 01e8 1B02     		lsls	r3, r3, #8
 467 01ea 1BB2     		sxth	r3, r3
 468 01ec 9DF80520 		ldrb	r2, [sp, #5]	@ zero_extendqisi2
 469 01f0 1343     		orrs	r3, r3, r2
 470 01f2 3B80     		strh	r3, [r7]	@ movhi
 621:Src/LTC6811.c **** 		data[2] = (uint16_t) ((rx_data[8] << 8) & 0xFF00) | (rx_data[9] & 0x00FF);
 471              		.loc 1 621 0
 472 01f4 9DF80630 		ldrb	r3, [sp, #6]	@ zero_extendqisi2
 473 01f8 1B02     		lsls	r3, r3, #8
 474 01fa 1BB2     		sxth	r3, r3
 475 01fc 9DF80720 		ldrb	r2, [sp, #7]	@ zero_extendqisi2
 476 0200 1343     		orrs	r3, r3, r2
 477 0202 7B80     		strh	r3, [r7, #2]	@ movhi
 622:Src/LTC6811.c **** 		data[3] = (uint16_t) ((rx_data[10] << 8) & 0xFF00) | (rx_data[11] & 0x00FF);
 478              		.loc 1 622 0
 479 0204 9DF80830 		ldrb	r3, [sp, #8]	@ zero_extendqisi2
 480 0208 1B02     		lsls	r3, r3, #8
 481 020a 1BB2     		sxth	r3, r3
 482 020c 9DF80920 		ldrb	r2, [sp, #9]	@ zero_extendqisi2
 483 0210 1343     		orrs	r3, r3, r2
 484 0212 BB80     		strh	r3, [r7, #4]	@ movhi
 623:Src/LTC6811.c **** 	}
 485              		.loc 1 623 0
 486 0214 9DF80A30 		ldrb	r3, [sp, #10]	@ zero_extendqisi2
 487 0218 1B02     		lsls	r3, r3, #8
 488 021a 1BB2     		sxth	r3, r3
 489 021c 9DF80B20 		ldrb	r2, [sp, #11]	@ zero_extendqisi2
 490 0220 1343     		orrs	r3, r3, r2
 491 0222 FB80     		strh	r3, [r7, #6]	@ movhi
 492 0224 54E7     		b	.L26
 493              		.cfi_endproc
 494              	.LFE76:
 496              		.section	.text.readCellVoltage,"ax",%progbits
 497              		.align	1
 498              		.global	readCellVoltage
 499              		.syntax unified
 500              		.thumb
 501              		.thumb_func
 502              		.fpu softvfp
 504              	readCellVoltage:
 505              	.LFB69:
 171:Src/LTC6811.c **** 	
 506              		.loc 1 171 0
 507              		.cfi_startproc
 508              		@ args = 0, pretend = 0, frame = 0
 509              		@ frame_needed = 0, uses_anonymous_args = 0
 510              	.LVL36:
 511 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
ARM GAS  /tmp/ccbi9fCp.s 			page 23


 512              	.LCFI6:
 513              		.cfi_def_cfa_offset 24
 514              		.cfi_offset 3, -24
 515              		.cfi_offset 4, -20
 516              		.cfi_offset 5, -16
 517              		.cfi_offset 6, -12
 518              		.cfi_offset 7, -8
 519              		.cfi_offset 14, -4
 520 0002 0746     		mov	r7, r0
 521 0004 0D46     		mov	r5, r1
 522              	.LVL37:
 177:Src/LTC6811.c **** 	
 523              		.loc 1 177 0
 524 0006 1820     		movs	r0, #24
 525              	.LVL38:
 526 0008 FFF7FEFF 		bl	malloc
 527              	.LVL39:
 528 000c 0446     		mov	r4, r0
 529              	.LVL40:
 186:Src/LTC6811.c **** 	//dataValid = dataValid & PEC_check;
 530              		.loc 1 186 0
 531 000e 0246     		mov	r2, r0
 532 0010 3946     		mov	r1, r7
 533 0012 0420     		movs	r0, #4
 534              	.LVL41:
 535 0014 FFF7FEFF 		bl	readRegister
 536              	.LVL42:
 188:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 537              		.loc 1 188 0
 538 0018 2246     		mov	r2, r4
 539 001a 3946     		mov	r1, r7
 540 001c 0620     		movs	r0, #6
 541 001e FFF7FEFF 		bl	readRegister
 542              	.LVL43:
 543 0022 0646     		mov	r6, r0
 544              	.LVL44:
 190:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 545              		.loc 1 190 0
 546 0024 2246     		mov	r2, r4
 547 0026 3946     		mov	r1, r7
 548 0028 0820     		movs	r0, #8
 549 002a FFF7FEFF 		bl	readRegister
 550              	.LVL45:
 551 002e 0640     		ands	r6, r6, r0
 552              	.LVL46:
 553 0030 F6B2     		uxtb	r6, r6
 554              	.LVL47:
 192:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 555              		.loc 1 192 0
 556 0032 2246     		mov	r2, r4
 557 0034 3946     		mov	r1, r7
 558 0036 0A20     		movs	r0, #10
 559              	.LVL48:
 560 0038 FFF7FEFF 		bl	readRegister
 561              	.LVL49:
 562 003c 0640     		ands	r6, r6, r0
 563              	.LVL50:
ARM GAS  /tmp/ccbi9fCp.s 			page 24


 194:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 564              		.loc 1 194 0
 565 003e 2246     		mov	r2, r4
 566 0040 3946     		mov	r1, r7
 567 0042 0420     		movs	r0, #4
 568              	.LVL51:
 569 0044 FFF7FEFF 		bl	readRegister
 570              	.LVL52:
 571 0048 0640     		ands	r6, r6, r0
 572              	.LVL53:
 573              	.LBB7:
 197:Src/LTC6811.c **** 		cellVoltage[i] = voltage[i];
 574              		.loc 1 197 0
 575 004a 0023     		movs	r3, #0
 576 004c 05E0     		b	.L38
 577              	.LVL54:
 578              	.L39:
 198:Src/LTC6811.c **** 	}
 579              		.loc 1 198 0 discriminator 3
 580 004e 34F81320 		ldrh	r2, [r4, r3, lsl #1]
 581 0052 25F81320 		strh	r2, [r5, r3, lsl #1]	@ movhi
 197:Src/LTC6811.c **** 		cellVoltage[i] = voltage[i];
 582              		.loc 1 197 0 discriminator 3
 583 0056 0133     		adds	r3, r3, #1
 584              	.LVL55:
 585 0058 DBB2     		uxtb	r3, r3
 586              	.LVL56:
 587              	.L38:
 197:Src/LTC6811.c **** 		cellVoltage[i] = voltage[i];
 588              		.loc 1 197 0 is_stmt 0 discriminator 1
 589 005a 0B2B     		cmp	r3, #11
 590 005c F7D9     		bls	.L39
 591              	.LBE7:
 201:Src/LTC6811.c **** 	
 592              		.loc 1 201 0 is_stmt 1
 593 005e 2046     		mov	r0, r4
 594              	.LVL57:
 595 0060 FFF7FEFF 		bl	free
 596              	.LVL58:
 205:Src/LTC6811.c **** 
 597              		.loc 1 205 0
 598 0064 3046     		mov	r0, r6
 599 0066 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 600              		.cfi_endproc
 601              	.LFE69:
 603              		.section	.text.readConfig,"ax",%progbits
 604              		.align	1
 605              		.global	readConfig
 606              		.syntax unified
 607              		.thumb
 608              		.thumb_func
 609              		.fpu softvfp
 611              	readConfig:
 612              	.LFB73:
 403:Src/LTC6811.c **** 	
 613              		.loc 1 403 0
 614              		.cfi_startproc
ARM GAS  /tmp/ccbi9fCp.s 			page 25


 615              		@ args = 0, pretend = 0, frame = 0
 616              		@ frame_needed = 0, uses_anonymous_args = 0
 617              	.LVL59:
 618 0000 70B5     		push	{r4, r5, r6, lr}
 619              	.LCFI7:
 620              		.cfi_def_cfa_offset 16
 621              		.cfi_offset 4, -16
 622              		.cfi_offset 5, -12
 623              		.cfi_offset 6, -8
 624              		.cfi_offset 14, -4
 625 0002 0646     		mov	r6, r0
 626 0004 0C46     		mov	r4, r1
 627              	.LVL60:
 408:Src/LTC6811.c **** 	
 628              		.loc 1 408 0
 629 0006 0820     		movs	r0, #8
 630              	.LVL61:
 631 0008 FFF7FEFF 		bl	malloc
 632              	.LVL62:
 633 000c 0546     		mov	r5, r0
 634              	.LVL63:
 410:Src/LTC6811.c **** 	
 635              		.loc 1 410 0
 636 000e 0246     		mov	r2, r0
 637 0010 3146     		mov	r1, r6
 638 0012 0220     		movs	r0, #2
 639              	.LVL64:
 640 0014 FFF7FEFF 		bl	readRegister
 641              	.LVL65:
 412:Src/LTC6811.c **** 	cfg[1] = (uint8_t) (config[0] & 0xFF);
 642              		.loc 1 412 0
 643 0018 2B88     		ldrh	r3, [r5]
 644 001a 1A0A     		lsrs	r2, r3, #8
 645 001c 2270     		strb	r2, [r4]
 413:Src/LTC6811.c **** 	cfg[2] = (uint8_t) ((config[1] >> 8) & 0xFF);
 646              		.loc 1 413 0
 647 001e 6370     		strb	r3, [r4, #1]
 414:Src/LTC6811.c **** 	cfg[3] = (uint8_t) (config[1] & 0xFF);
 648              		.loc 1 414 0
 649 0020 6B88     		ldrh	r3, [r5, #2]
 650 0022 1A0A     		lsrs	r2, r3, #8
 651 0024 A270     		strb	r2, [r4, #2]
 415:Src/LTC6811.c **** 	cfg[4] = (uint8_t) ((config[2] >> 8) & 0xFF);
 652              		.loc 1 415 0
 653 0026 E370     		strb	r3, [r4, #3]
 416:Src/LTC6811.c **** 	cfg[5] = (uint8_t) (config[2] & 0xFF);
 654              		.loc 1 416 0
 655 0028 AB88     		ldrh	r3, [r5, #4]
 656 002a 1A0A     		lsrs	r2, r3, #8
 657 002c 2271     		strb	r2, [r4, #4]
 417:Src/LTC6811.c **** 	cfg[6] = (uint8_t) ((config[3] >> 8) & 0xFF);
 658              		.loc 1 417 0
 659 002e 6371     		strb	r3, [r4, #5]
 418:Src/LTC6811.c **** 	cfg[7] = (uint8_t) (config[3] & 0xFF);
 660              		.loc 1 418 0
 661 0030 EB88     		ldrh	r3, [r5, #6]
 662 0032 1A0A     		lsrs	r2, r3, #8
ARM GAS  /tmp/ccbi9fCp.s 			page 26


 663 0034 A271     		strb	r2, [r4, #6]
 419:Src/LTC6811.c **** 	
 664              		.loc 1 419 0
 665 0036 E371     		strb	r3, [r4, #7]
 422:Src/LTC6811.c **** 
 666              		.loc 1 422 0
 667 0038 70BD     		pop	{r4, r5, r6, pc}
 668              		.cfi_endproc
 669              	.LFE73:
 671              		.section	.text.writeConfigAddress,"ax",%progbits
 672              		.align	1
 673              		.global	writeConfigAddress
 674              		.syntax unified
 675              		.thumb
 676              		.thumb_func
 677              		.fpu softvfp
 679              	writeConfigAddress:
 680              	.LFB67:
 112:Src/LTC6811.c **** 
 681              		.loc 1 112 0
 682              		.cfi_startproc
 683              		@ args = 100, pretend = 16, frame = 8
 684              		@ frame_needed = 0, uses_anonymous_args = 0
 685              	.LVL66:
 686 0000 84B0     		sub	sp, sp, #16
 687              	.LCFI8:
 688              		.cfi_def_cfa_offset 16
 689 0002 2DE9F04F 		push	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 690              	.LCFI9:
 691              		.cfi_def_cfa_offset 52
 692              		.cfi_offset 4, -52
 693              		.cfi_offset 5, -48
 694              		.cfi_offset 6, -44
 695              		.cfi_offset 7, -40
 696              		.cfi_offset 8, -36
 697              		.cfi_offset 9, -32
 698              		.cfi_offset 10, -28
 699              		.cfi_offset 11, -24
 700              		.cfi_offset 14, -20
 701 0006 83B0     		sub	sp, sp, #12
 702              	.LCFI10:
 703              		.cfi_def_cfa_offset 64
 704 0008 0CAC     		add	r4, sp, #48
 705 000a 84E80F00 		stm	r4, {r0, r1, r2, r3}
 706 000e 9DF89090 		ldrb	r9, [sp, #144]	@ zero_extendqisi2
 707              	.LVL67:
 122:Src/LTC6811.c **** 	
 708              		.loc 1 122 0
 709 0012 0C20     		movs	r0, #12
 710 0014 FFF7FEFF 		bl	malloc
 711              	.LVL68:
 712 0018 0646     		mov	r6, r0
 713              	.LVL69:
 124:Src/LTC6811.c **** 	config[1] = (uint8_t) (cfg.UndervoltageComparisonVoltage & 0xFF);
 714              		.loc 1 124 0
 715 001a 9DF87250 		ldrb	r5, [sp, #114]	@ zero_extendqisi2
 716 001e ED01     		lsls	r5, r5, #7
ARM GAS  /tmp/ccbi9fCp.s 			page 27


 717 0020 6DB2     		sxtb	r5, r5
 718 0022 9DF87330 		ldrb	r3, [sp, #115]	@ zero_extendqisi2
 719 0026 45EA8315 		orr	r5, r5, r3, lsl #6
 720 002a 6DB2     		sxtb	r5, r5
 721 002c 9DF87430 		ldrb	r3, [sp, #116]	@ zero_extendqisi2
 722 0030 45EA4315 		orr	r5, r5, r3, lsl #5
 723 0034 6DB2     		sxtb	r5, r5
 724 0036 9DF87530 		ldrb	r3, [sp, #117]	@ zero_extendqisi2
 725 003a 45EA0315 		orr	r5, r5, r3, lsl #4
 726 003e 6DB2     		sxtb	r5, r5
 727 0040 9DF87630 		ldrb	r3, [sp, #118]	@ zero_extendqisi2
 728 0044 45EAC305 		orr	r5, r5, r3, lsl #3
 729 0048 6DB2     		sxtb	r5, r5
 730 004a 9DF87730 		ldrb	r3, [sp, #119]	@ zero_extendqisi2
 731 004e 45EA8305 		orr	r5, r5, r3, lsl #2
 732 0052 6DB2     		sxtb	r5, r5
 733 0054 9DF97830 		ldrsb	r3, [sp, #120]
 734 0058 1D43     		orrs	r5, r5, r3
 735 005a EDB2     		uxtb	r5, r5
 125:Src/LTC6811.c **** 	config[2] = (uint8_t) ((cfg.OvervoltageComparisonVoltage << 4) & 0xF0) | ((cfg.UndervoltageCompari
 736              		.loc 1 125 0
 737 005c BDF87A30 		ldrh	r3, [sp, #122]
 738 0060 5FFA83FA 		uxtb	r10, r3
 126:Src/LTC6811.c **** 	config[3] = (uint8_t) ((cfg.OvervoltageComparisonVoltage >> 4) & 0xFF);
 739              		.loc 1 126 0
 740 0064 BDF87C80 		ldrh	r8, [sp, #124]
 741 0068 4FEA0817 		lsl	r7, r8, #4
 742 006c 7FB2     		sxtb	r7, r7
 743 006e C3F30323 		ubfx	r3, r3, #8, #4
 744 0072 1F43     		orrs	r7, r7, r3
 745 0074 FFB2     		uxtb	r7, r7
 127:Src/LTC6811.c **** 	config[4] = (uint8_t) (cfg.DischargeCell8 << 7) | (cfg.DischargeCell7 << 6) | (cfg.DischargeCell6 
 746              		.loc 1 127 0
 747 0076 C8F30718 		ubfx	r8, r8, #4, #8
 128:Src/LTC6811.c **** 	config[5] = (uint8_t) ((cfg.DischargeTimeoutValue << 4) & 0xF0) | (cfg.DischargeCell12 << 3) | (cf
 748              		.loc 1 128 0
 749 007a 9DF88540 		ldrb	r4, [sp, #133]	@ zero_extendqisi2
 750 007e E401     		lsls	r4, r4, #7
 751 0080 64B2     		sxtb	r4, r4
 752 0082 9DF88430 		ldrb	r3, [sp, #132]	@ zero_extendqisi2
 753 0086 44EA8314 		orr	r4, r4, r3, lsl #6
 754 008a 64B2     		sxtb	r4, r4
 755 008c 9DF88330 		ldrb	r3, [sp, #131]	@ zero_extendqisi2
 756 0090 44EA4314 		orr	r4, r4, r3, lsl #5
 757 0094 64B2     		sxtb	r4, r4
 758 0096 9DF88230 		ldrb	r3, [sp, #130]	@ zero_extendqisi2
 759 009a 44EA0314 		orr	r4, r4, r3, lsl #4
 760 009e 64B2     		sxtb	r4, r4
 761 00a0 9DF88130 		ldrb	r3, [sp, #129]	@ zero_extendqisi2
 762 00a4 44EAC304 		orr	r4, r4, r3, lsl #3
 763 00a8 64B2     		sxtb	r4, r4
 764 00aa 9DF88030 		ldrb	r3, [sp, #128]	@ zero_extendqisi2
 765 00ae 44EA8304 		orr	r4, r4, r3, lsl #2
 766 00b2 64B2     		sxtb	r4, r4
 767 00b4 9DF87F30 		ldrb	r3, [sp, #127]	@ zero_extendqisi2
 768 00b8 44EA4304 		orr	r4, r4, r3, lsl #1
 769 00bc 64B2     		sxtb	r4, r4
ARM GAS  /tmp/ccbi9fCp.s 			page 28


 770 00be 9DF97E30 		ldrsb	r3, [sp, #126]
 771 00c2 1C43     		orrs	r4, r4, r3
 772 00c4 E4B2     		uxtb	r4, r4
 129:Src/LTC6811.c **** 	
 773              		.loc 1 129 0
 774 00c6 9DF88AB0 		ldrb	fp, [sp, #138]	@ zero_extendqisi2
 775 00ca 4FEA0B1B 		lsl	fp, fp, #4
 776 00ce 4FFA8BFB 		sxtb	fp, fp
 777 00d2 9DF88930 		ldrb	r3, [sp, #137]	@ zero_extendqisi2
 778 00d6 4BEAC30B 		orr	fp, fp, r3, lsl #3
 779 00da 4FFA8BFB 		sxtb	fp, fp
 780 00de 9DF88830 		ldrb	r3, [sp, #136]	@ zero_extendqisi2
 781 00e2 4BEA830B 		orr	fp, fp, r3, lsl #2
 782 00e6 4FFA8BFB 		sxtb	fp, fp
 783 00ea 9DF88730 		ldrb	r3, [sp, #135]	@ zero_extendqisi2
 784 00ee 4BEA430B 		orr	fp, fp, r3, lsl #1
 785 00f2 4FFA8BFB 		sxtb	fp, fp
 786 00f6 9DF98630 		ldrsb	r3, [sp, #134]
 787 00fa 4BEA030B 		orr	fp, fp, r3
 788 00fe 5FFA8BFB 		uxtb	fp, fp
 131:Src/LTC6811.c **** 	cmd[1] = (uint8_t) (WriteConfigurationRegisterGroup & 0xFF);
 789              		.loc 1 131 0
 790 0102 4FEAC903 		lsl	r3, r9, #3
 791 0106 03F07803 		and	r3, r3, #120
 792 010a 43F08003 		orr	r3, r3, #128
 793 010e 0370     		strb	r3, [r0]
 132:Src/LTC6811.c **** 	
 794              		.loc 1 132 0
 795 0110 0123     		movs	r3, #1
 796 0112 4370     		strb	r3, [r0, #1]
 134:Src/LTC6811.c **** 	
 797              		.loc 1 134 0
 798 0114 0146     		mov	r1, r0
 799 0116 0220     		movs	r0, #2
 800              	.LVL70:
 801 0118 FFF7FEFF 		bl	calculatePEC
 802              	.LVL71:
 136:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 803              		.loc 1 136 0
 804 011c 030A     		lsrs	r3, r0, #8
 805 011e B370     		strb	r3, [r6, #2]
 137:Src/LTC6811.c **** 
 806              		.loc 1 137 0
 807 0120 F070     		strb	r0, [r6, #3]
 139:Src/LTC6811.c **** 	cmd[5] = config[1];
 808              		.loc 1 139 0
 809 0122 3571     		strb	r5, [r6, #4]
 140:Src/LTC6811.c **** 	cmd[6] = config[2];
 810              		.loc 1 140 0
 811 0124 86F805A0 		strb	r10, [r6, #5]
 141:Src/LTC6811.c **** 	cmd[7] = config[3];
 812              		.loc 1 141 0
 813 0128 B771     		strb	r7, [r6, #6]
 142:Src/LTC6811.c **** 	cmd[8] = config[4];
 814              		.loc 1 142 0
 815 012a 86F80780 		strb	r8, [r6, #7]
 143:Src/LTC6811.c **** 	cmd[9] = config[5];
ARM GAS  /tmp/ccbi9fCp.s 			page 29


 816              		.loc 1 143 0
 817 012e 3472     		strb	r4, [r6, #8]
 144:Src/LTC6811.c **** 	
 818              		.loc 1 144 0
 819 0130 86F809B0 		strb	fp, [r6, #9]
 146:Src/LTC6811.c **** 
 820              		.loc 1 146 0
 821 0134 311D     		adds	r1, r6, #4
 822 0136 0620     		movs	r0, #6
 823              	.LVL72:
 824 0138 FFF7FEFF 		bl	calculatePEC
 825              	.LVL73:
 148:Src/LTC6811.c **** 	cmd[11] = PEC_return & 0xFF;
 826              		.loc 1 148 0
 827 013c 030A     		lsrs	r3, r0, #8
 828 013e B372     		strb	r3, [r6, #10]
 149:Src/LTC6811.c **** 	
 829              		.loc 1 149 0
 830 0140 F072     		strb	r0, [r6, #11]
 151:Src/LTC6811.c **** 
 831              		.loc 1 151 0
 832 0142 0C21     		movs	r1, #12
 833 0144 3046     		mov	r0, r6
 834              	.LVL74:
 835 0146 FFF7FEFF 		bl	SPIWrite
 836              	.LVL75:
 153:Src/LTC6811.c **** 	
 837              		.loc 1 153 0
 838 014a 6946     		mov	r1, sp
 839 014c 4846     		mov	r0, r9
 840 014e FFF7FEFF 		bl	readConfig
 841              	.LVL76:
 155:Src/LTC6811.c **** 
 842              		.loc 1 155 0
 843 0152 3046     		mov	r0, r6
 844 0154 FFF7FEFF 		bl	free
 845              	.LVL77:
 157:Src/LTC6811.c **** 
 846              		.loc 1 157 0
 847 0158 03B0     		add	sp, sp, #12
 848              	.LCFI11:
 849              		.cfi_def_cfa_offset 52
 850              		@ sp needed
 851 015a BDE8F04F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 852              	.LCFI12:
 853              		.cfi_restore 14
 854              		.cfi_restore 11
 855              		.cfi_restore 10
 856              		.cfi_restore 9
 857              		.cfi_restore 8
 858              		.cfi_restore 7
 859              		.cfi_restore 6
 860              		.cfi_restore 5
 861              		.cfi_restore 4
 862              		.cfi_def_cfa_offset 16
 863              	.LVL78:
 864 015e 04B0     		add	sp, sp, #16
ARM GAS  /tmp/ccbi9fCp.s 			page 30


 865              	.LCFI13:
 866              		.cfi_def_cfa_offset 0
 867 0160 7047     		bx	lr
 868              		.cfi_endproc
 869              	.LFE67:
 871              		.section	.text.writeConfigAll,"ax",%progbits
 872              		.align	1
 873              		.global	writeConfigAll
 874              		.syntax unified
 875              		.thumb
 876              		.thumb_func
 877              		.fpu softvfp
 879              	writeConfigAll:
 880              	.LFB68:
 159:Src/LTC6811.c **** 
 881              		.loc 1 159 0
 882              		.cfi_startproc
 883              		@ args = 96, pretend = 16, frame = 0
 884              		@ frame_needed = 0, uses_anonymous_args = 0
 885 0000 84B0     		sub	sp, sp, #16
 886              	.LCFI14:
 887              		.cfi_def_cfa_offset 16
 888 0002 10B5     		push	{r4, lr}
 889              	.LCFI15:
 890              		.cfi_def_cfa_offset 24
 891              		.cfi_offset 4, -24
 892              		.cfi_offset 14, -20
 893 0004 96B0     		sub	sp, sp, #88
 894              	.LCFI16:
 895              		.cfi_def_cfa_offset 112
 896 0006 18AC     		add	r4, sp, #96
 897 0008 84E80F00 		stm	r4, {r0, r1, r2, r3}
 898              	.LVL79:
 162:Src/LTC6811.c **** 	while(delay--);
 899              		.loc 1 162 0
 900 000c 0022     		movs	r2, #0
 901 000e 1021     		movs	r1, #16
 902 0010 1348     		ldr	r0, .L51
 903 0012 FFF7FEFF 		bl	HAL_GPIO_WritePin
 904              	.LVL80:
 161:Src/LTC6811.c **** 	HAL_GPIO_WritePin(GPIOA, GPIO_PIN_4, GPIO_PIN_RESET);
 905              		.loc 1 161 0
 906 0016 0F23     		movs	r3, #15
 163:Src/LTC6811.c **** 	HAL_GPIO_WritePin(GPIOA, GPIO_PIN_4, GPIO_PIN_SET);
 907              		.loc 1 163 0
 908 0018 00E0     		b	.L46
 909              	.LVL81:
 910              	.L49:
 911 001a 1346     		mov	r3, r2
 912              	.LVL82:
 913              	.L46:
 163:Src/LTC6811.c **** 	HAL_GPIO_WritePin(GPIOA, GPIO_PIN_4, GPIO_PIN_SET);
 914              		.loc 1 163 0 is_stmt 0 discriminator 1
 915 001c 5A1E     		subs	r2, r3, #1
 916              	.LVL83:
 917 001e 002B     		cmp	r3, #0
 918 0020 FBD1     		bne	.L49
ARM GAS  /tmp/ccbi9fCp.s 			page 31


 164:Src/LTC6811.c **** 
 919              		.loc 1 164 0 is_stmt 1
 920 0022 0122     		movs	r2, #1
 921              	.LVL84:
 922 0024 1021     		movs	r1, #16
 923 0026 0E48     		ldr	r0, .L51
 924 0028 FFF7FEFF 		bl	HAL_GPIO_WritePin
 925              	.LVL85:
 926              	.LBB8:
 166:Src/LTC6811.c **** 		writeConfigAddress(cfg, cfg.address[i]);
 927              		.loc 1 166 0
 928 002c 0024     		movs	r4, #0
 929 002e 0EE0     		b	.L47
 930              	.LVL86:
 931              	.L48:
 167:Src/LTC6811.c **** 	}
 932              		.loc 1 167 0 discriminator 3
 933 0030 18AB     		add	r3, sp, #96
 934 0032 2344     		add	r3, r3, r4
 935 0034 5B78     		ldrb	r3, [r3, #1]	@ zero_extendqisi2
 936 0036 1493     		str	r3, [sp, #80]
 937 0038 4E22     		movs	r2, #78
 938 003a 1CA9     		add	r1, sp, #112
 939 003c 6846     		mov	r0, sp
 940 003e FFF7FEFF 		bl	memcpy
 941              	.LVL87:
 942 0042 18AB     		add	r3, sp, #96
 943 0044 0FCB     		ldm	r3, {r0, r1, r2, r3}
 944 0046 FFF7FEFF 		bl	writeConfigAddress
 945              	.LVL88:
 166:Src/LTC6811.c **** 		writeConfigAddress(cfg, cfg.address[i]);
 946              		.loc 1 166 0 discriminator 3
 947 004a 0134     		adds	r4, r4, #1
 948              	.LVL89:
 949 004c E4B2     		uxtb	r4, r4
 950              	.LVL90:
 951              	.L47:
 166:Src/LTC6811.c **** 		writeConfigAddress(cfg, cfg.address[i]);
 952              		.loc 1 166 0 is_stmt 0 discriminator 1
 953 004e 9DF86030 		ldrb	r3, [sp, #96]	@ zero_extendqisi2
 954 0052 A342     		cmp	r3, r4
 955 0054 ECD8     		bhi	.L48
 956              	.LBE8:
 169:Src/LTC6811.c **** 
 957              		.loc 1 169 0 is_stmt 1
 958 0056 16B0     		add	sp, sp, #88
 959              	.LCFI17:
 960              		.cfi_def_cfa_offset 24
 961              		@ sp needed
 962 0058 BDE81040 		pop	{r4, lr}
 963              	.LCFI18:
 964              		.cfi_restore 14
 965              		.cfi_restore 4
 966              		.cfi_def_cfa_offset 16
 967              	.LVL91:
 968 005c 04B0     		add	sp, sp, #16
 969              	.LCFI19:
ARM GAS  /tmp/ccbi9fCp.s 			page 32


 970              		.cfi_def_cfa_offset 0
 971 005e 7047     		bx	lr
 972              	.L52:
 973              		.align	2
 974              	.L51:
 975 0060 00080140 		.word	1073809408
 976              		.cfi_endproc
 977              	.LFE68:
 979              		.section	.text.dischargeCellGroups,"ax",%progbits
 980              		.align	1
 981              		.global	dischargeCellGroups
 982              		.syntax unified
 983              		.thumb
 984              		.thumb_func
 985              		.fpu softvfp
 987              	dischargeCellGroups:
 988              	.LFB75:
 477:Src/LTC6811.c **** 	
 989              		.loc 1 477 0
 990              		.cfi_startproc
 991              		@ args = 100, pretend = 16, frame = 0
 992              		@ frame_needed = 0, uses_anonymous_args = 0
 993              	.LVL92:
 994 0000 84B0     		sub	sp, sp, #16
 995              	.LCFI20:
 996              		.cfi_def_cfa_offset 16
 997 0002 30B5     		push	{r4, r5, lr}
 998              	.LCFI21:
 999              		.cfi_def_cfa_offset 28
 1000              		.cfi_offset 4, -28
 1001              		.cfi_offset 5, -24
 1002              		.cfi_offset 14, -20
 1003 0004 97B0     		sub	sp, sp, #92
 1004              	.LCFI22:
 1005              		.cfi_def_cfa_offset 120
 1006 0006 1AAC     		add	r4, sp, #104
 1007 0008 84E80F00 		stm	r4, {r0, r1, r2, r3}
 1008 000c 329D     		ldr	r5, [sp, #200]
 1009              	.LVL93:
 1010              	.LBB9:
 483:Src/LTC6811.c **** 
 1011              		.loc 1 483 0
 1012 000e 0024     		movs	r4, #0
 1013              	.LVL94:
 1014 0010 29E0     		b	.L54
 1015              	.LVL95:
 1016              	.L55:
 485:Src/LTC6811.c **** 		cfg->DischargeCell2 = cellDischarge[i][1];
 1017              		.loc 1 485 0 discriminator 3
 1018 0012 05EBC403 		add	r3, r5, r4, lsl #3
 1019 0016 15F83420 		ldrb	r2, [r5, r4, lsl #3]	@ zero_extendqisi2
 1020 001a 8DF8B620 		strb	r2, [sp, #182]
 486:Src/LTC6811.c **** 		cfg->DischargeCell3 = cellDischarge[i][2];
 1021              		.loc 1 486 0 discriminator 3
 1022 001e 5A78     		ldrb	r2, [r3, #1]	@ zero_extendqisi2
 1023 0020 8DF8B720 		strb	r2, [sp, #183]
 487:Src/LTC6811.c **** 		cfg->DischargeCell4 = cellDischarge[i][3];
ARM GAS  /tmp/ccbi9fCp.s 			page 33


 1024              		.loc 1 487 0 discriminator 3
 1025 0024 9A78     		ldrb	r2, [r3, #2]	@ zero_extendqisi2
 1026 0026 8DF8B820 		strb	r2, [sp, #184]
 488:Src/LTC6811.c **** 		cfg->DischargeCell7 = cellDischarge[i][4];
 1027              		.loc 1 488 0 discriminator 3
 1028 002a DA78     		ldrb	r2, [r3, #3]	@ zero_extendqisi2
 1029 002c 8DF8B920 		strb	r2, [sp, #185]
 489:Src/LTC6811.c **** 		cfg->DischargeCell8 = cellDischarge[i][5];
 1030              		.loc 1 489 0 discriminator 3
 1031 0030 1A79     		ldrb	r2, [r3, #4]	@ zero_extendqisi2
 1032 0032 8DF8BC20 		strb	r2, [sp, #188]
 490:Src/LTC6811.c **** 		cfg->DischargeCell9 = cellDischarge[i][6];
 1033              		.loc 1 490 0 discriminator 3
 1034 0036 5A79     		ldrb	r2, [r3, #5]	@ zero_extendqisi2
 1035 0038 8DF8BD20 		strb	r2, [sp, #189]
 491:Src/LTC6811.c **** 		cfg->DischargeCell10 = cellDischarge[i][7];
 1036              		.loc 1 491 0 discriminator 3
 1037 003c 9A79     		ldrb	r2, [r3, #6]	@ zero_extendqisi2
 1038 003e 8DF8BE20 		strb	r2, [sp, #190]
 492:Src/LTC6811.c **** 
 1039              		.loc 1 492 0 discriminator 3
 1040 0042 DB79     		ldrb	r3, [r3, #7]	@ zero_extendqisi2
 1041 0044 8DF8BF30 		strb	r3, [sp, #191]
 494:Src/LTC6811.c **** 
 1042              		.loc 1 494 0 discriminator 3
 1043 0048 1AAB     		add	r3, sp, #104
 1044              	.LVL96:
 1045 004a 2344     		add	r3, r3, r4
 1046              	.LVL97:
 1047 004c 5B78     		ldrb	r3, [r3, #1]	@ zero_extendqisi2
 1048 004e 1493     		str	r3, [sp, #80]
 1049 0050 4E22     		movs	r2, #78
 1050 0052 1EA9     		add	r1, sp, #120
 1051 0054 6846     		mov	r0, sp
 1052 0056 FFF7FEFF 		bl	memcpy
 1053              	.LVL98:
 1054 005a 1AAB     		add	r3, sp, #104
 1055              	.LVL99:
 1056 005c 0FCB     		ldm	r3, {r0, r1, r2, r3}
 1057              	.LVL100:
 1058 005e FFF7FEFF 		bl	writeConfigAddress
 1059              	.LVL101:
 483:Src/LTC6811.c **** 
 1060              		.loc 1 483 0 discriminator 3
 1061 0062 0134     		adds	r4, r4, #1
 1062              	.LVL102:
 1063 0064 E4B2     		uxtb	r4, r4
 1064              	.LVL103:
 1065              	.L54:
 483:Src/LTC6811.c **** 
 1066              		.loc 1 483 0 is_stmt 0 discriminator 1
 1067 0066 9DF86830 		ldrb	r3, [sp, #104]	@ zero_extendqisi2
 1068 006a A342     		cmp	r3, r4
 1069 006c D1D8     		bhi	.L55
 1070              	.LBE9:
 509:Src/LTC6811.c **** 
 1071              		.loc 1 509 0 is_stmt 1
ARM GAS  /tmp/ccbi9fCp.s 			page 34


 1072 006e 0020     		movs	r0, #0
 1073 0070 17B0     		add	sp, sp, #92
 1074              	.LCFI23:
 1075              		.cfi_def_cfa_offset 28
 1076              		@ sp needed
 1077 0072 BDE83040 		pop	{r4, r5, lr}
 1078              	.LCFI24:
 1079              		.cfi_restore 14
 1080              		.cfi_restore 5
 1081              		.cfi_restore 4
 1082              		.cfi_def_cfa_offset 16
 1083              	.LVL104:
 1084 0076 04B0     		add	sp, sp, #16
 1085              	.LCFI25:
 1086              		.cfi_def_cfa_offset 0
 1087              	.LVL105:
 1088 0078 7047     		bx	lr
 1089              		.cfi_endproc
 1090              	.LFE75:
 1092              		.section	.text.sendBroadcastCommand,"ax",%progbits
 1093              		.align	1
 1094              		.global	sendBroadcastCommand
 1095              		.syntax unified
 1096              		.thumb
 1097              		.thumb_func
 1098              		.fpu softvfp
 1100              	sendBroadcastCommand:
 1101              	.LFB77:
 630:Src/LTC6811.c **** 	
 1102              		.loc 1 630 0
 1103              		.cfi_startproc
 1104              		@ args = 0, pretend = 0, frame = 8
 1105              		@ frame_needed = 0, uses_anonymous_args = 0
 1106              	.LVL106:
 1107 0000 00B5     		push	{lr}
 1108              	.LCFI26:
 1109              		.cfi_def_cfa_offset 4
 1110              		.cfi_offset 14, -4
 1111 0002 83B0     		sub	sp, sp, #12
 1112              	.LCFI27:
 1113              		.cfi_def_cfa_offset 16
 635:Src/LTC6811.c **** 	cmd[1] = (uint8_t) (command & 0xFF);
 1114              		.loc 1 635 0
 1115 0004 C0F30323 		ubfx	r3, r0, #8, #4
 1116 0008 8DF80430 		strb	r3, [sp, #4]
 636:Src/LTC6811.c **** 	
 1117              		.loc 1 636 0
 1118 000c 8DF80500 		strb	r0, [sp, #5]
 638:Src/LTC6811.c **** 	
 1119              		.loc 1 638 0
 1120 0010 01A9     		add	r1, sp, #4
 1121 0012 0220     		movs	r0, #2
 1122              	.LVL107:
 1123 0014 FFF7FEFF 		bl	calculatePEC
 1124              	.LVL108:
 640:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 1125              		.loc 1 640 0
ARM GAS  /tmp/ccbi9fCp.s 			page 35


 1126 0018 030A     		lsrs	r3, r0, #8
 1127 001a 8DF80630 		strb	r3, [sp, #6]
 641:Src/LTC6811.c **** 	
 1128              		.loc 1 641 0
 1129 001e 8DF80700 		strb	r0, [sp, #7]
 643:Src/LTC6811.c **** };
 1130              		.loc 1 643 0
 1131 0022 0421     		movs	r1, #4
 1132 0024 0DEB0100 		add	r0, sp, r1
 1133              	.LVL109:
 1134 0028 FFF7FEFF 		bl	SPIWrite
 1135              	.LVL110:
 644:Src/LTC6811.c **** 
 1136              		.loc 1 644 0
 1137 002c 03B0     		add	sp, sp, #12
 1138              	.LCFI28:
 1139              		.cfi_def_cfa_offset 4
 1140              		@ sp needed
 1141 002e 5DF804FB 		ldr	pc, [sp], #4
 1142              		.cfi_endproc
 1143              	.LFE77:
 1145              		.section	.text.readAllCellVoltages,"ax",%progbits
 1146              		.align	1
 1147              		.global	readAllCellVoltages
 1148              		.syntax unified
 1149              		.thumb
 1150              		.thumb_func
 1151              		.fpu softvfp
 1153              	readAllCellVoltages:
 1154              	.LFB70:
 207:Src/LTC6811.c **** 
 1155              		.loc 1 207 0
 1156              		.cfi_startproc
 1157              		@ args = 100, pretend = 16, frame = 40
 1158              		@ frame_needed = 0, uses_anonymous_args = 0
 1159              	.LVL111:
 1160 0000 84B0     		sub	sp, sp, #16
 1161              	.LCFI29:
 1162              		.cfi_def_cfa_offset 16
 1163 0002 F0B5     		push	{r4, r5, r6, r7, lr}
 1164              	.LCFI30:
 1165              		.cfi_def_cfa_offset 36
 1166              		.cfi_offset 4, -36
 1167              		.cfi_offset 5, -32
 1168              		.cfi_offset 6, -28
 1169              		.cfi_offset 7, -24
 1170              		.cfi_offset 14, -20
 1171 0004 8BB0     		sub	sp, sp, #44
 1172              	.LCFI31:
 1173              		.cfi_def_cfa_offset 80
 1174 0006 10AC     		add	r4, sp, #64
 1175 0008 84E80F00 		stm	r4, {r0, r1, r2, r3}
 1176 000c 289C     		ldr	r4, [sp, #160]
 1177              	.LVL112:
 257:Src/LTC6811.c **** 	sendBroadcastCommand(StartCellVoltageADCConversionAll);
 1178              		.loc 1 257 0
 1179 000e 40F21170 		movw	r0, #1809
ARM GAS  /tmp/ccbi9fCp.s 			page 36


 1180 0012 FFF7FEFF 		bl	sendBroadcastCommand
 1181              	.LVL113:
 258:Src/LTC6811.c **** 	HAL_Delay(20);
 1182              		.loc 1 258 0
 1183 0016 4FF41870 		mov	r0, #608
 1184 001a FFF7FEFF 		bl	sendBroadcastCommand
 1185              	.LVL114:
 259:Src/LTC6811.c **** 
 1186              		.loc 1 259 0
 1187 001e 1420     		movs	r0, #20
 1188 0020 FFF7FEFF 		bl	HAL_Delay
 1189              	.LVL115:
 262:Src/LTC6811.c **** 	while(delay--);
 1190              		.loc 1 262 0
 1191 0024 0022     		movs	r2, #0
 1192 0026 1021     		movs	r1, #16
 1193 0028 4248     		ldr	r0, .L73
 1194 002a FFF7FEFF 		bl	HAL_GPIO_WritePin
 1195              	.LVL116:
 261:Src/LTC6811.c **** 	HAL_GPIO_WritePin(GPIOA, GPIO_PIN_4, GPIO_PIN_RESET);
 1196              		.loc 1 261 0
 1197 002e 0F23     		movs	r3, #15
 263:Src/LTC6811.c **** 	HAL_GPIO_WritePin(GPIOA, GPIO_PIN_4, GPIO_PIN_SET);
 1198              		.loc 1 263 0
 1199 0030 00E0     		b	.L60
 1200              	.LVL117:
 1201              	.L68:
 1202 0032 1346     		mov	r3, r2
 1203              	.LVL118:
 1204              	.L60:
 263:Src/LTC6811.c **** 	HAL_GPIO_WritePin(GPIOA, GPIO_PIN_4, GPIO_PIN_SET);
 1205              		.loc 1 263 0 is_stmt 0 discriminator 1
 1206 0034 5A1E     		subs	r2, r3, #1
 1207              	.LVL119:
 1208 0036 002B     		cmp	r3, #0
 1209 0038 FBD1     		bne	.L68
 264:Src/LTC6811.c **** 
 1210              		.loc 1 264 0 is_stmt 1
 1211 003a 0122     		movs	r2, #1
 1212              	.LVL120:
 1213 003c 1021     		movs	r1, #16
 1214 003e 3D48     		ldr	r0, .L73
 1215 0040 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1216              	.LVL121:
 1217              	.LBB10:
 266:Src/LTC6811.c **** 
 1218              		.loc 1 266 0
 1219 0044 0025     		movs	r5, #0
 1220 0046 53E0     		b	.L61
 1221              	.LVL122:
 1222              	.L63:
 1223              	.LBB11:
 273:Src/LTC6811.c **** 			bmsData[(board * 8) + cell][1] = (uint8_t) (0x02 & (PEC_check[board] << 1)); //valid data bit in
 1224              		.loc 1 273 0 discriminator 3
 1225 0048 03EBC502 		add	r2, r3, r5, lsl #3
 1226 004c D2B2     		uxtb	r2, r2
 1227 004e 03EBC601 		add	r1, r3, r6, lsl #3
ARM GAS  /tmp/ccbi9fCp.s 			page 37


 1228 0052 01EB4101 		add	r1, r1, r1, lsl #1
 1229 0056 4F00     		lsls	r7, r1, #1
 1230 0058 E119     		adds	r1, r4, r7
 1231 005a 0132     		adds	r2, r2, #1
 1232 005c E255     		strb	r2, [r4, r7]
 274:Src/LTC6811.c **** 		}
 1233              		.loc 1 274 0 discriminator 3
 1234 005e 4200     		lsls	r2, r0, #1
 1235 0060 02F00202 		and	r2, r2, #2
 1236 0064 4A70     		strb	r2, [r1, #1]
 272:Src/LTC6811.c **** 			bmsData[(board * 8) + cell][0] = (uint8_t) ((board * 8) + cell + 1); //cell number
 1237              		.loc 1 272 0 discriminator 3
 1238 0066 0133     		adds	r3, r3, #1
 1239              	.LVL123:
 1240 0068 DBB2     		uxtb	r3, r3
 1241              	.LVL124:
 1242              	.L62:
 272:Src/LTC6811.c **** 			bmsData[(board * 8) + cell][0] = (uint8_t) ((board * 8) + cell + 1); //cell number
 1243              		.loc 1 272 0 is_stmt 0 discriminator 1
 1244 006a 072B     		cmp	r3, #7
 1245 006c ECD9     		bls	.L63
 1246              	.LBE11:
 278:Src/LTC6811.c **** 		bmsData[(board * 8) + 0][3] = (uint8_t) (boardVoltage[0] & 0xFF); //cell 1, voltage L
 1247              		.loc 1 278 0 is_stmt 1 discriminator 2
 1248 006e BDF81010 		ldrh	r1, [sp, #16]
 1249 0072 06EB4606 		add	r6, r6, r6, lsl #1
 1250 0076 3301     		lsls	r3, r6, #4
 1251              	.LVL125:
 1252 0078 E218     		adds	r2, r4, r3
 1253 007a 080A     		lsrs	r0, r1, #8
 1254 007c 9070     		strb	r0, [r2, #2]
 279:Src/LTC6811.c **** 		bmsData[(board * 8) + 1][2] = (uint8_t) ((boardVoltage[1] >> 8) & 0xFF); //cell 2, voltage H
 1255              		.loc 1 279 0 discriminator 2
 1256 007e D170     		strb	r1, [r2, #3]
 280:Src/LTC6811.c **** 		bmsData[(board * 8) + 1][3] = (uint8_t) (boardVoltage[1] & 0xFF); //cell 2, voltage L
 1257              		.loc 1 280 0 discriminator 2
 1258 0080 BDF81210 		ldrh	r1, [sp, #18]
 1259 0084 9A1D     		adds	r2, r3, #6
 1260 0086 2244     		add	r2, r2, r4
 1261 0088 080A     		lsrs	r0, r1, #8
 1262 008a 9070     		strb	r0, [r2, #2]
 281:Src/LTC6811.c **** 		bmsData[(board * 8) + 2][2] = (uint8_t) ((boardVoltage[2] >> 8) & 0xFF); //cell 3, voltage H
 1263              		.loc 1 281 0 discriminator 2
 1264 008c D170     		strb	r1, [r2, #3]
 282:Src/LTC6811.c **** 		bmsData[(board * 8) + 2][3] = (uint8_t) (boardVoltage[2] & 0xFF); //cell 3, voltage L
 1265              		.loc 1 282 0 discriminator 2
 1266 008e BDF81410 		ldrh	r1, [sp, #20]
 1267 0092 03F10C02 		add	r2, r3, #12
 1268 0096 2244     		add	r2, r2, r4
 1269 0098 080A     		lsrs	r0, r1, #8
 1270 009a 9070     		strb	r0, [r2, #2]
 283:Src/LTC6811.c **** 		bmsData[(board * 8) + 3][2] = (uint8_t) ((boardVoltage[3] >> 8) & 0xFF); //cell 4, voltage H
 1271              		.loc 1 283 0 discriminator 2
 1272 009c D170     		strb	r1, [r2, #3]
 284:Src/LTC6811.c **** 		bmsData[(board * 8) + 3][3] = (uint8_t) (boardVoltage[3] & 0xFF); //cell 4, voltage L 
 1273              		.loc 1 284 0 discriminator 2
 1274 009e BDF81610 		ldrh	r1, [sp, #22]
ARM GAS  /tmp/ccbi9fCp.s 			page 38


 1275 00a2 03F11202 		add	r2, r3, #18
 1276 00a6 2244     		add	r2, r2, r4
 1277 00a8 080A     		lsrs	r0, r1, #8
 1278 00aa 9070     		strb	r0, [r2, #2]
 285:Src/LTC6811.c **** 		bmsData[(board * 8) + 4][2] = (uint8_t) ((boardVoltage[6] >> 8) & 0xFF); //cell 7, voltage H
 1279              		.loc 1 285 0 discriminator 2
 1280 00ac D170     		strb	r1, [r2, #3]
 286:Src/LTC6811.c **** 		bmsData[(board * 8) + 4][3] = (uint8_t) (boardVoltage[6] & 0xFF); //cell 7, voltage L 
 1281              		.loc 1 286 0 discriminator 2
 1282 00ae BDF81C10 		ldrh	r1, [sp, #28]
 1283 00b2 03F11802 		add	r2, r3, #24
 1284 00b6 2244     		add	r2, r2, r4
 1285 00b8 080A     		lsrs	r0, r1, #8
 1286 00ba 9070     		strb	r0, [r2, #2]
 287:Src/LTC6811.c **** 		bmsData[(board * 8) + 5][2] = (uint8_t) ((boardVoltage[7] >> 8) & 0xFF); //cell 8, voltage H
 1287              		.loc 1 287 0 discriminator 2
 1288 00bc D170     		strb	r1, [r2, #3]
 288:Src/LTC6811.c **** 		bmsData[(board * 8) + 5][3] = (uint8_t) (boardVoltage[7] & 0xFF); //cell 8, voltage L
 1289              		.loc 1 288 0 discriminator 2
 1290 00be BDF81E10 		ldrh	r1, [sp, #30]
 1291 00c2 03F11E02 		add	r2, r3, #30
 1292 00c6 2244     		add	r2, r2, r4
 1293 00c8 080A     		lsrs	r0, r1, #8
 1294 00ca 9070     		strb	r0, [r2, #2]
 289:Src/LTC6811.c **** 		bmsData[(board * 8) + 6][2] = (uint8_t) ((boardVoltage[8] >> 8) & 0xFF); //cell 9, voltage H
 1295              		.loc 1 289 0 discriminator 2
 1296 00cc D170     		strb	r1, [r2, #3]
 290:Src/LTC6811.c **** 		bmsData[(board * 8) + 6][3] = (uint8_t) (boardVoltage[8] & 0xFF); //cell 9, voltage L
 1297              		.loc 1 290 0 discriminator 2
 1298 00ce BDF82010 		ldrh	r1, [sp, #32]
 1299 00d2 03F12402 		add	r2, r3, #36
 1300 00d6 2244     		add	r2, r2, r4
 1301 00d8 080A     		lsrs	r0, r1, #8
 1302 00da 9070     		strb	r0, [r2, #2]
 291:Src/LTC6811.c **** 		bmsData[(board * 8) + 7][2] = (uint8_t) ((boardVoltage[9] >> 8) & 0xFF); //cell 10, voltage H
 1303              		.loc 1 291 0 discriminator 2
 1304 00dc D170     		strb	r1, [r2, #3]
 292:Src/LTC6811.c **** 		bmsData[(board * 8) + 7][3] = (uint8_t) (boardVoltage[9] & 0xFF); //cell 10, voltage L
 1305              		.loc 1 292 0 discriminator 2
 1306 00de BDF82220 		ldrh	r2, [sp, #34]
 1307 00e2 2A33     		adds	r3, r3, #42
 1308 00e4 2344     		add	r3, r3, r4
 1309 00e6 110A     		lsrs	r1, r2, #8
 1310 00e8 9970     		strb	r1, [r3, #2]
 293:Src/LTC6811.c **** 	
 1311              		.loc 1 293 0 discriminator 2
 1312 00ea DA70     		strb	r2, [r3, #3]
 266:Src/LTC6811.c **** 
 1313              		.loc 1 266 0 discriminator 2
 1314 00ec 0135     		adds	r5, r5, #1
 1315              	.LVL126:
 1316 00ee EDB2     		uxtb	r5, r5
 1317              	.LVL127:
 1318              	.L61:
 266:Src/LTC6811.c **** 
 1319              		.loc 1 266 0 is_stmt 0 discriminator 1
 1320 00f0 0B2D     		cmp	r5, #11
ARM GAS  /tmp/ccbi9fCp.s 			page 39


 1321 00f2 0AD8     		bhi	.L71
 269:Src/LTC6811.c **** 
 1322              		.loc 1 269 0 is_stmt 1
 1323 00f4 2E46     		mov	r6, r5
 1324 00f6 04A9     		add	r1, sp, #16
 1325 00f8 2846     		mov	r0, r5
 1326 00fa FFF7FEFF 		bl	readCellVoltage
 1327              	.LVL128:
 1328 00fe 0AAB     		add	r3, sp, #40
 1329 0100 2B44     		add	r3, r3, r5
 1330 0102 03F8240C 		strb	r0, [r3, #-36]
 1331              	.LVL129:
 1332              	.LBB12:
 272:Src/LTC6811.c **** 			bmsData[(board * 8) + cell][0] = (uint8_t) ((board * 8) + cell + 1); //cell number
 1333              		.loc 1 272 0
 1334 0106 0023     		movs	r3, #0
 1335 0108 AFE7     		b	.L62
 1336              	.LVL130:
 1337              	.L71:
 1338              	.LBE12:
 1339              	.LBE10:
 1340              	.LBB13:
 297:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 1341              		.loc 1 297 0
 1342 010a 0023     		movs	r3, #0
 1343              	.LBE13:
 255:Src/LTC6811.c **** 
 1344              		.loc 1 255 0
 1345 010c 0120     		movs	r0, #1
 1346 010e 01E0     		b	.L65
 1347              	.LVL131:
 1348              	.L66:
 1349              	.LBB14:
 297:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 1350              		.loc 1 297 0 discriminator 2
 1351 0110 0133     		adds	r3, r3, #1
 1352              	.LVL132:
 1353 0112 DBB2     		uxtb	r3, r3
 1354              	.LVL133:
 1355              	.L65:
 297:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 1356              		.loc 1 297 0 is_stmt 0 discriminator 1
 1357 0114 0B2B     		cmp	r3, #11
 1358 0116 07D8     		bhi	.L72
 298:Src/LTC6811.c **** 			dataValid = false;
 1359              		.loc 1 298 0 is_stmt 1
 1360 0118 0AAA     		add	r2, sp, #40
 1361 011a 1A44     		add	r2, r2, r3
 1362 011c 12F8242C 		ldrb	r2, [r2, #-36]	@ zero_extendqisi2
 1363 0120 002A     		cmp	r2, #0
 1364 0122 F5D1     		bne	.L66
 299:Src/LTC6811.c **** 	}
 1365              		.loc 1 299 0
 1366 0124 1046     		mov	r0, r2
 1367              	.LVL134:
 1368 0126 F3E7     		b	.L66
 1369              	.LVL135:
ARM GAS  /tmp/ccbi9fCp.s 			page 40


 1370              	.L72:
 1371              	.LBE14:
 303:Src/LTC6811.c **** 
 1372              		.loc 1 303 0
 1373 0128 0BB0     		add	sp, sp, #44
 1374              	.LCFI32:
 1375              		.cfi_def_cfa_offset 36
 1376              		@ sp needed
 1377 012a BDE8F040 		pop	{r4, r5, r6, r7, lr}
 1378              	.LCFI33:
 1379              		.cfi_restore 14
 1380              		.cfi_restore 7
 1381              		.cfi_restore 6
 1382              		.cfi_restore 5
 1383              		.cfi_restore 4
 1384              		.cfi_def_cfa_offset 16
 1385              	.LVL136:
 1386 012e 04B0     		add	sp, sp, #16
 1387              	.LCFI34:
 1388              		.cfi_def_cfa_offset 0
 1389 0130 7047     		bx	lr
 1390              	.L74:
 1391 0132 00BF     		.align	2
 1392              	.L73:
 1393 0134 00080140 		.word	1073809408
 1394              		.cfi_endproc
 1395              	.LFE70:
 1397              		.section	.text.checkAllCellConnections,"ax",%progbits
 1398              		.align	1
 1399              		.global	checkAllCellConnections
 1400              		.syntax unified
 1401              		.thumb
 1402              		.thumb_func
 1403              		.fpu softvfp
 1405              	checkAllCellConnections:
 1406              	.LFB74:
 441:Src/LTC6811.c **** 	
 1407              		.loc 1 441 0
 1408              		.cfi_startproc
 1409              		@ args = 100, pretend = 16, frame = 0
 1410              		@ frame_needed = 1, uses_anonymous_args = 0
 1411              	.LVL137:
 1412 0000 84B0     		sub	sp, sp, #16
 1413              	.LCFI35:
 1414              		.cfi_def_cfa_offset 16
 1415 0002 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 1416              	.LCFI36:
 1417              		.cfi_def_cfa_offset 40
 1418              		.cfi_offset 4, -40
 1419              		.cfi_offset 5, -36
 1420              		.cfi_offset 6, -32
 1421              		.cfi_offset 7, -28
 1422              		.cfi_offset 8, -24
 1423              		.cfi_offset 14, -20
 1424 0006 00AF     		add	r7, sp, #0
 1425              	.LCFI37:
 1426              		.cfi_def_cfa_register 7
ARM GAS  /tmp/ccbi9fCp.s 			page 41


 1427 0008 07F11804 		add	r4, r7, #24
 1428 000c 84E80F00 		stm	r4, {r0, r1, r2, r3}
 1429 0010 D7F87880 		ldr	r8, [r7, #120]
 443:Src/LTC6811.c **** 	uint16_t cellVoltage;
 1430              		.loc 1 443 0
 1431 0014 97F83930 		ldrb	r3, [r7, #57]	@ zero_extendqisi2
 1432              	.LVL138:
 1433 0018 5B00     		lsls	r3, r3, #1
 1434              	.LVL139:
 1435 001a 0833     		adds	r3, r3, #8
 1436 001c 03F47E73 		and	r3, r3, #1016
 1437 0020 ADEB030D 		sub	sp, sp, r3
 1438 0024 6D46     		mov	r5, sp
 1439              	.LVL140:
 448:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 1440              		.loc 1 448 0
 1441 0026 40F22920 		movw	r0, #553
 1442 002a FFF7FEFF 		bl	sendBroadcastCommand
 1443              	.LVL141:
 449:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 1444              		.loc 1 449 0
 1445 002e 40F22920 		movw	r0, #553
 1446 0032 FFF7FEFF 		bl	sendBroadcastCommand
 1447              	.LVL142:
 450:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 1448              		.loc 1 450 0
 1449 0036 40F22920 		movw	r0, #553
 1450 003a FFF7FEFF 		bl	sendBroadcastCommand
 1451              	.LVL143:
 451:Src/LTC6811.c **** 	sendBroadcastCommand(StartOpenWireConversionPulldown);
 1452              		.loc 1 451 0
 1453 003e 40F22920 		movw	r0, #553
 1454 0042 FFF7FEFF 		bl	sendBroadcastCommand
 1455              	.LVL144:
 452:Src/LTC6811.c **** 
 1456              		.loc 1 452 0
 1457 0046 40F22920 		movw	r0, #553
 1458 004a FFF7FEFF 		bl	sendBroadcastCommand
 1459              	.LVL145:
 454:Src/LTC6811.c **** 
 1460              		.loc 1 454 0
 1461 004e 0F20     		movs	r0, #15
 1462 0050 FFF7FEFF 		bl	HAL_Delay
 1463              	.LVL146:
 1464              	.LBB15:
 456:Src/LTC6811.c **** 
 1465              		.loc 1 456 0
 1466 0054 0024     		movs	r4, #0
 1467 0056 22E0     		b	.L76
 1468              	.LVL147:
 1469              	.L78:
 1470              	.LBB16:
 470:Src/LTC6811.c **** 		}
 1471              		.loc 1 470 0
 1472 0058 5A78     		ldrb	r2, [r3, #1]	@ zero_extendqisi2
 1473 005a 42F00102 		orr	r2, r2, #1
 1474 005e 5A70     		strb	r2, [r3, #1]
ARM GAS  /tmp/ccbi9fCp.s 			page 42


 1475              	.LVL148:
 1476              	.L79:
 460:Src/LTC6811.c **** 
 1477              		.loc 1 460 0 discriminator 2
 1478 0060 0131     		adds	r1, r1, #1
 1479              	.LVL149:
 1480 0062 C9B2     		uxtb	r1, r1
 1481              	.LVL150:
 1482              	.L77:
 460:Src/LTC6811.c **** 
 1483              		.loc 1 460 0 is_stmt 0 discriminator 1
 1484 0064 97F83A30 		ldrb	r3, [r7, #58]	@ zero_extendqisi2
 1485 0068 9942     		cmp	r1, r3
 1486 006a 16D2     		bcs	.L83
 1487              	.LVL151:
 463:Src/LTC6811.c **** 			cellVoltage = cellVoltage << 8;
 1488              		.loc 1 463 0 is_stmt 1
 1489 006c 03FB0613 		mla	r3, r3, r6, r1
 1490 0070 03EB4303 		add	r3, r3, r3, lsl #1
 1491 0074 5A00     		lsls	r2, r3, #1
 1492 0076 08EB0203 		add	r3, r8, r2
 1493 007a 9878     		ldrb	r0, [r3, #2]	@ zero_extendqisi2
 1494              	.LVL152:
 465:Src/LTC6811.c **** 
 1495              		.loc 1 465 0
 1496 007c DA78     		ldrb	r2, [r3, #3]	@ zero_extendqisi2
 1497 007e 02EB0022 		add	r2, r2, r0, lsl #8
 1498 0082 92B2     		uxth	r2, r2
 1499              	.LVL153:
 467:Src/LTC6811.c **** 				bmsData[(board * cfg.numOfCellsPerIC) + cell][1] &= 0xFE;
 1500              		.loc 1 467 0
 1501 0084 35F81100 		ldrh	r0, [r5, r1, lsl #1]
 1502 0088 121A     		subs	r2, r2, r0
 1503              	.LVL154:
 1504 008a B2F57A7F 		cmp	r2, #1000
 1505 008e E3DD     		ble	.L78
 468:Src/LTC6811.c **** 			else
 1506              		.loc 1 468 0
 1507 0090 5A78     		ldrb	r2, [r3, #1]	@ zero_extendqisi2
 1508 0092 22F00102 		bic	r2, r2, #1
 1509 0096 5A70     		strb	r2, [r3, #1]
 1510 0098 E2E7     		b	.L79
 1511              	.LVL155:
 1512              	.L83:
 1513              	.LBE16:
 456:Src/LTC6811.c **** 
 1514              		.loc 1 456 0 discriminator 2
 1515 009a 0134     		adds	r4, r4, #1
 1516              	.LVL156:
 1517 009c E4B2     		uxtb	r4, r4
 1518              	.LVL157:
 1519              	.L76:
 456:Src/LTC6811.c **** 
 1520              		.loc 1 456 0 is_stmt 0 discriminator 1
 1521 009e 3B7E     		ldrb	r3, [r7, #24]	@ zero_extendqisi2
 1522 00a0 9C42     		cmp	r4, r3
 1523 00a2 09D2     		bcs	.L84
ARM GAS  /tmp/ccbi9fCp.s 			page 43


 458:Src/LTC6811.c **** 
 1524              		.loc 1 458 0 is_stmt 1
 1525 00a4 2646     		mov	r6, r4
 1526 00a6 07F11803 		add	r3, r7, #24
 1527 00aa 2344     		add	r3, r3, r4
 1528 00ac 2946     		mov	r1, r5
 1529 00ae 5878     		ldrb	r0, [r3, #1]	@ zero_extendqisi2
 1530 00b0 FFF7FEFF 		bl	readCellVoltage
 1531              	.LVL158:
 1532              	.LBB17:
 460:Src/LTC6811.c **** 
 1533              		.loc 1 460 0
 1534 00b4 0021     		movs	r1, #0
 1535 00b6 D5E7     		b	.L77
 1536              	.LVL159:
 1537              	.L84:
 1538              	.LBE17:
 1539              	.LBE15:
 475:Src/LTC6811.c **** 
 1540              		.loc 1 475 0
 1541 00b8 0020     		movs	r0, #0
 1542 00ba BD46     		mov	sp, r7
 1543              	.LCFI38:
 1544              		.cfi_def_cfa_register 13
 1545              		@ sp needed
 1546 00bc BDE8F041 		pop	{r4, r5, r6, r7, r8, lr}
 1547              	.LCFI39:
 1548              		.cfi_restore 14
 1549              		.cfi_restore 8
 1550              		.cfi_restore 7
 1551              		.cfi_restore 6
 1552              		.cfi_restore 5
 1553              		.cfi_restore 4
 1554              		.cfi_def_cfa_offset 16
 1555              	.LVL160:
 1556 00c0 04B0     		add	sp, sp, #16
 1557              	.LCFI40:
 1558              		.cfi_def_cfa_offset 0
 1559 00c2 7047     		bx	lr
 1560              		.cfi_endproc
 1561              	.LFE74:
 1563              		.section	.text.sendAddressCommand,"ax",%progbits
 1564              		.align	1
 1565              		.global	sendAddressCommand
 1566              		.syntax unified
 1567              		.thumb
 1568              		.thumb_func
 1569              		.fpu softvfp
 1571              	sendAddressCommand:
 1572              	.LFB78:
 646:Src/LTC6811.c **** 	
 1573              		.loc 1 646 0
 1574              		.cfi_startproc
 1575              		@ args = 0, pretend = 0, frame = 8
 1576              		@ frame_needed = 0, uses_anonymous_args = 0
 1577              	.LVL161:
 1578 0000 70B5     		push	{r4, r5, r6, lr}
ARM GAS  /tmp/ccbi9fCp.s 			page 44


 1579              	.LCFI41:
 1580              		.cfi_def_cfa_offset 16
 1581              		.cfi_offset 4, -16
 1582              		.cfi_offset 5, -12
 1583              		.cfi_offset 6, -8
 1584              		.cfi_offset 14, -4
 1585 0002 82B0     		sub	sp, sp, #8
 1586              	.LCFI42:
 1587              		.cfi_def_cfa_offset 24
 1588 0004 0546     		mov	r5, r0
 1589 0006 0C46     		mov	r4, r1
 652:Src/LTC6811.c **** 	
 1590              		.loc 1 652 0
 1591 0008 0220     		movs	r0, #2
 1592              	.LVL162:
 1593 000a FFF7FEFF 		bl	malloc
 1594              	.LVL163:
 1595 000e 0646     		mov	r6, r0
 1596              	.LVL164:
 654:Src/LTC6811.c **** 	msbytes[1] = (uint8_t) (command & 0xFF);
 1597              		.loc 1 654 0
 1598 0010 E300     		lsls	r3, r4, #3
 1599 0012 03F07803 		and	r3, r3, #120
 1600 0016 63F07F03 		orn	r3, r3, #127
 1601 001a C5F30224 		ubfx	r4, r5, #8, #3
 1602 001e 2343     		orrs	r3, r3, r4
 1603 0020 DBB2     		uxtb	r3, r3
 1604 0022 0370     		strb	r3, [r0]
 655:Src/LTC6811.c **** 
 1605              		.loc 1 655 0
 1606 0024 EDB2     		uxtb	r5, r5
 1607 0026 4570     		strb	r5, [r0, #1]
 657:Src/LTC6811.c **** 	cmd[1] = msbytes[1];
 1608              		.loc 1 657 0
 1609 0028 8DF80430 		strb	r3, [sp, #4]
 658:Src/LTC6811.c **** 	
 1610              		.loc 1 658 0
 1611 002c 8DF80550 		strb	r5, [sp, #5]
 660:Src/LTC6811.c **** 	
 1612              		.loc 1 660 0
 1613 0030 0146     		mov	r1, r0
 1614 0032 0220     		movs	r0, #2
 1615              	.LVL165:
 1616 0034 FFF7FEFF 		bl	calculatePEC
 1617              	.LVL166:
 662:Src/LTC6811.c **** 	cmd[3] = PEC_return & 0xFF;
 1618              		.loc 1 662 0
 1619 0038 030A     		lsrs	r3, r0, #8
 1620 003a 8DF80630 		strb	r3, [sp, #6]
 663:Src/LTC6811.c **** 	
 1621              		.loc 1 663 0
 1622 003e 8DF80700 		strb	r0, [sp, #7]
 665:Src/LTC6811.c **** 	
 1623              		.loc 1 665 0
 1624 0042 0421     		movs	r1, #4
 1625 0044 0DEB0100 		add	r0, sp, r1
 1626              	.LVL167:
ARM GAS  /tmp/ccbi9fCp.s 			page 45


 1627 0048 FFF7FEFF 		bl	SPIWrite
 1628              	.LVL168:
 667:Src/LTC6811.c **** };
 1629              		.loc 1 667 0
 1630 004c 3046     		mov	r0, r6
 1631 004e FFF7FEFF 		bl	free
 1632              	.LVL169:
 668:Src/LTC6811.c **** 
 1633              		.loc 1 668 0
 1634 0052 02B0     		add	sp, sp, #8
 1635              	.LCFI43:
 1636              		.cfi_def_cfa_offset 16
 1637              		@ sp needed
 1638 0054 70BD     		pop	{r4, r5, r6, pc}
 1639              		.cfi_endproc
 1640              	.LFE78:
 1642              		.global	__aeabi_ui2d
 1643              		.global	__aeabi_ddiv
 1644              		.global	__aeabi_dmul
 1645              		.global	__aeabi_dsub
 1646              		.global	__aeabi_dadd
 1647              		.global	__aeabi_d2uiz
 1648              		.section	.text.readCellTemp,"ax",%progbits
 1649              		.align	1
 1650              		.global	readCellTemp
 1651              		.syntax unified
 1652              		.thumb
 1653              		.thumb_func
 1654              		.fpu softvfp
 1656              	readCellTemp:
 1657              	.LFB71:
 305:Src/LTC6811.c **** 	
 1658              		.loc 1 305 0
 1659              		.cfi_startproc
 1660              		@ args = 0, pretend = 0, frame = 16
 1661              		@ frame_needed = 0, uses_anonymous_args = 0
 1662              	.LVL170:
 1663 0000 2DE9F04F 		push	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 1664              	.LCFI44:
 1665              		.cfi_def_cfa_offset 36
 1666              		.cfi_offset 4, -36
 1667              		.cfi_offset 5, -32
 1668              		.cfi_offset 6, -28
 1669              		.cfi_offset 7, -24
 1670              		.cfi_offset 8, -20
 1671              		.cfi_offset 9, -16
 1672              		.cfi_offset 10, -12
 1673              		.cfi_offset 11, -8
 1674              		.cfi_offset 14, -4
 1675 0004 85B0     		sub	sp, sp, #20
 1676              	.LCFI45:
 1677              		.cfi_def_cfa_offset 56
 1678 0006 0446     		mov	r4, r0
 1679 0008 8B46     		mov	fp, r1
 1680 000a 1646     		mov	r6, r2
 1681 000c 1F46     		mov	r7, r3
 1682              	.LVL171:
ARM GAS  /tmp/ccbi9fCp.s 			page 46


 313:Src/LTC6811.c **** 	
 1683              		.loc 1 313 0
 1684 000e 0820     		movs	r0, #8
 1685              	.LVL172:
 1686 0010 FFF7FEFF 		bl	malloc
 1687              	.LVL173:
 1688 0014 8246     		mov	r10, r0
 1689              	.LVL174:
 315:Src/LTC6811.c **** 	
 1690              		.loc 1 315 0
 1691 0016 2146     		mov	r1, r4
 1692 0018 4FF48C60 		mov	r0, #1120
 1693              	.LVL175:
 1694 001c FFF7FEFF 		bl	sendAddressCommand
 1695              	.LVL176:
 317:Src/LTC6811.c **** 	
 1696              		.loc 1 317 0
 1697 0020 3220     		movs	r0, #50
 1698 0022 FFF7FEFF 		bl	HAL_Delay
 1699              	.LVL177:
 319:Src/LTC6811.c **** 	//dataValid = dataValid & PEC_check;
 1700              		.loc 1 319 0
 1701 0026 5246     		mov	r2, r10
 1702 0028 2146     		mov	r1, r4
 1703 002a 0C20     		movs	r0, #12
 1704 002c FFF7FEFF 		bl	readRegister
 1705              	.LVL178:
 321:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 1706              		.loc 1 321 0
 1707 0030 5246     		mov	r2, r10
 1708 0032 2146     		mov	r1, r4
 1709 0034 0E20     		movs	r0, #14
 1710 0036 FFF7FEFF 		bl	readRegister
 1711              	.LVL179:
 1712 003a 0546     		mov	r5, r0
 1713              	.LVL180:
 323:Src/LTC6811.c **** 	dataValid = dataValid & PEC_check;
 1714              		.loc 1 323 0
 1715 003c 5246     		mov	r2, r10
 1716 003e 2146     		mov	r1, r4
 1717 0040 0C20     		movs	r0, #12
 1718 0042 FFF7FEFF 		bl	readRegister
 1719              	.LVL181:
 1720 0046 2840     		ands	r0, r0, r5
 1721              	.LVL182:
 1722 0048 C3B2     		uxtb	r3, r0
 1723 004a 0393     		str	r3, [sp, #12]
 1724              	.LVL183:
 1725              	.LBB18:
 326:Src/LTC6811.c **** 		if ((temp[i] > 24400) || (temp[i] < 13000)) {
 1726              		.loc 1 326 0
 1727 004c 0025     		movs	r5, #0
 1728 004e 10E0     		b	.L88
 1729              	.LVL184:
 1730              	.L89:
 332:Src/LTC6811.c **** 		
 1731              		.loc 1 332 0
ARM GAS  /tmp/ccbi9fCp.s 			page 47


 1732 0050 0023     		movs	r3, #0
 1733 0052 7355     		strb	r3, [r6, r5]
 1734 0054 21E0     		b	.L90
 1735              	.L91:
 339:Src/LTC6811.c **** 		
 1736              		.loc 1 339 0
 1737 0056 0023     		movs	r3, #0
 1738 0058 BB54     		strb	r3, [r7, r2]
 1739              	.L92:
 341:Src/LTC6811.c **** 			dummy[i] = (double) temp[i] / 10000; // convert from ADC value to voltage
 1740              		.loc 1 341 0
 1741 005a 3AF80400 		ldrh	r0, [r10, r4]
 1742 005e A0F56B53 		sub	r3, r0, #15040
 1743 0062 3C3B     		subs	r3, r3, #60
 1744 0064 9BB2     		uxth	r3, r3
 1745 0066 42F25442 		movw	r2, #9300
 1746 006a 9342     		cmp	r3, r2
 1747 006c 26D9     		bls	.L96
 1748              	.L93:
 326:Src/LTC6811.c **** 		if ((temp[i] > 24400) || (temp[i] < 13000)) {
 1749              		.loc 1 326 0 discriminator 2
 1750 006e 0135     		adds	r5, r5, #1
 1751              	.LVL185:
 1752 0070 EDB2     		uxtb	r5, r5
 1753              	.LVL186:
 1754              	.L88:
 326:Src/LTC6811.c **** 		if ((temp[i] > 24400) || (temp[i] < 13000)) {
 1755              		.loc 1 326 0 is_stmt 0 discriminator 1
 1756 0072 032D     		cmp	r5, #3
 1757 0074 00F2A480 		bhi	.L97
 327:Src/LTC6811.c **** 			dcFault[i] = true;
 1758              		.loc 1 327 0 is_stmt 1
 1759 0078 2A46     		mov	r2, r5
 1760 007a 6C00     		lsls	r4, r5, #1
 1761 007c 3AF81530 		ldrh	r3, [r10, r5, lsl #1]
 1762 0080 A3F54B53 		sub	r3, r3, #12992
 1763 0084 083B     		subs	r3, r3, #8
 1764 0086 9BB2     		uxth	r3, r3
 1765 0088 42F68841 		movw	r1, #11400
 1766 008c 8B42     		cmp	r3, r1
 1767 008e DFD9     		bls	.L89
 328:Src/LTC6811.c **** 			cellTemp[i] = 0x0000;
 1768              		.loc 1 328 0
 1769 0090 0123     		movs	r3, #1
 1770 0092 7355     		strb	r3, [r6, r5]
 329:Src/LTC6811.c **** 		}
 1771              		.loc 1 329 0
 1772 0094 0023     		movs	r3, #0
 1773 0096 2BF81530 		strh	r3, [fp, r5, lsl #1]	@ movhi
 1774              	.L90:
 334:Src/LTC6811.c **** 			tempFault[i] = true;
 1775              		.loc 1 334 0
 1776 009a 3AF80430 		ldrh	r3, [r10, r4]
 1777 009e A3F54B53 		sub	r3, r3, #12992
 1778 00a2 083B     		subs	r3, r3, #8
 1779 00a4 9BB2     		uxth	r3, r3
 1780 00a6 40F63301 		movw	r1, #2099
ARM GAS  /tmp/ccbi9fCp.s 			page 48


 1781 00aa 8B42     		cmp	r3, r1
 1782 00ac D3D8     		bhi	.L91
 335:Src/LTC6811.c **** 			cellTemp[i] = 0xFFFF;
 1783              		.loc 1 335 0
 1784 00ae 0123     		movs	r3, #1
 1785 00b0 BB54     		strb	r3, [r7, r2]
 336:Src/LTC6811.c **** 		}
 1786              		.loc 1 336 0
 1787 00b2 4FF6FF73 		movw	r3, #65535
 1788 00b6 2BF80430 		strh	r3, [fp, r4]	@ movhi
 1789 00ba CEE7     		b	.L92
 1790              	.L96:
 342:Src/LTC6811.c **** 			// convert from voltage to temperature
 1791              		.loc 1 342 0
 1792 00bc FFF7FEFF 		bl	__aeabi_ui2d
 1793              	.LVL187:
 1794 00c0 43A3     		adr	r3, .L98
 1795 00c2 D3E90023 		ldrd	r2, [r3]
 1796 00c6 FFF7FEFF 		bl	__aeabi_ddiv
 1797              	.LVL188:
 1798 00ca CDE90001 		strd	r0, [sp]
 344:Src/LTC6811.c **** 			conversion[i] = 500 * (conversion[i] + 20); // map value to larger range
 1799              		.loc 1 344 0
 1800 00ce 42A3     		adr	r3, .L98+8
 1801 00d0 D3E90023 		ldrd	r2, [r3]
 1802 00d4 FFF7FEFF 		bl	__aeabi_dmul
 1803              	.LVL189:
 1804 00d8 0246     		mov	r2, r0
 1805 00da 0B46     		mov	r3, r1
 1806 00dc 40A1     		adr	r1, .L98+16
 1807 00de D1E90001 		ldrd	r0, [r1]
 1808 00e2 FFF7FEFF 		bl	__aeabi_dsub
 1809              	.LVL190:
 1810 00e6 8046     		mov	r8, r0
 1811 00e8 8946     		mov	r9, r1
 1812 00ea 0022     		movs	r2, #0
 1813 00ec 4FF08043 		mov	r3, #1073741824
 1814 00f0 DDE90001 		ldrd	r0, [sp]
 1815 00f4 FFF7FEFF 		bl	pow
 1816              	.LVL191:
 1817 00f8 3BA3     		adr	r3, .L98+24
 1818 00fa D3E90023 		ldrd	r2, [r3]
 1819 00fe FFF7FEFF 		bl	__aeabi_dmul
 1820              	.LVL192:
 1821 0102 0246     		mov	r2, r0
 1822 0104 0B46     		mov	r3, r1
 1823 0106 4046     		mov	r0, r8
 1824 0108 4946     		mov	r1, r9
 1825 010a FFF7FEFF 		bl	__aeabi_dadd
 1826              	.LVL193:
 1827 010e 8046     		mov	r8, r0
 1828 0110 8946     		mov	r9, r1
 1829 0112 0022     		movs	r2, #0
 1830 0114 3E4B     		ldr	r3, .L98+64
 1831 0116 DDE90001 		ldrd	r0, [sp]
 1832 011a FFF7FEFF 		bl	pow
 1833              	.LVL194:
ARM GAS  /tmp/ccbi9fCp.s 			page 49


 1834 011e 34A3     		adr	r3, .L98+32
 1835 0120 D3E90023 		ldrd	r2, [r3]
 1836 0124 FFF7FEFF 		bl	__aeabi_dmul
 1837              	.LVL195:
 1838 0128 0246     		mov	r2, r0
 1839 012a 0B46     		mov	r3, r1
 1840 012c 4046     		mov	r0, r8
 1841 012e 4946     		mov	r1, r9
 1842 0130 FFF7FEFF 		bl	__aeabi_dsub
 1843              	.LVL196:
 1844 0134 8046     		mov	r8, r0
 1845 0136 8946     		mov	r9, r1
 1846 0138 0022     		movs	r2, #0
 1847 013a 364B     		ldr	r3, .L98+68
 1848 013c DDE90001 		ldrd	r0, [sp]
 1849 0140 FFF7FEFF 		bl	pow
 1850              	.LVL197:
 1851 0144 2CA3     		adr	r3, .L98+40
 1852 0146 D3E90023 		ldrd	r2, [r3]
 1853 014a FFF7FEFF 		bl	__aeabi_dmul
 1854              	.LVL198:
 1855 014e 0246     		mov	r2, r0
 1856 0150 0B46     		mov	r3, r1
 1857 0152 4046     		mov	r0, r8
 1858 0154 4946     		mov	r1, r9
 1859 0156 FFF7FEFF 		bl	__aeabi_dadd
 1860              	.LVL199:
 1861 015a 8046     		mov	r8, r0
 1862 015c 8946     		mov	r9, r1
 1863 015e 0022     		movs	r2, #0
 1864 0160 2D4B     		ldr	r3, .L98+72
 1865 0162 DDE90001 		ldrd	r0, [sp]
 1866 0166 FFF7FEFF 		bl	pow
 1867              	.LVL200:
 1868 016a 25A3     		adr	r3, .L98+48
 1869 016c D3E90023 		ldrd	r2, [r3]
 1870 0170 FFF7FEFF 		bl	__aeabi_dmul
 1871              	.LVL201:
 1872 0174 0246     		mov	r2, r0
 1873 0176 0B46     		mov	r3, r1
 1874 0178 4046     		mov	r0, r8
 1875 017a 4946     		mov	r1, r9
 1876 017c FFF7FEFF 		bl	__aeabi_dsub
 1877              	.LVL202:
 1878 0180 8046     		mov	r8, r0
 1879 0182 8946     		mov	r9, r1
 1880 0184 0022     		movs	r2, #0
 1881 0186 254B     		ldr	r3, .L98+76
 1882 0188 DDE90001 		ldrd	r0, [sp]
 1883 018c FFF7FEFF 		bl	pow
 1884              	.LVL203:
 1885 0190 1DA3     		adr	r3, .L98+56
 1886 0192 D3E90023 		ldrd	r2, [r3]
 1887 0196 FFF7FEFF 		bl	__aeabi_dmul
 1888              	.LVL204:
 1889 019a 0246     		mov	r2, r0
 1890 019c 0B46     		mov	r3, r1
ARM GAS  /tmp/ccbi9fCp.s 			page 50


 1891 019e 4046     		mov	r0, r8
 1892 01a0 4946     		mov	r1, r9
 1893 01a2 FFF7FEFF 		bl	__aeabi_dadd
 1894              	.LVL205:
 345:Src/LTC6811.c **** 			cellTemp[i] = (uint16_t) conversion[i];
 1895              		.loc 1 345 0
 1896 01a6 0022     		movs	r2, #0
 1897 01a8 1D4B     		ldr	r3, .L98+80
 1898 01aa FFF7FEFF 		bl	__aeabi_dadd
 1899              	.LVL206:
 1900 01ae 0022     		movs	r2, #0
 1901 01b0 1C4B     		ldr	r3, .L98+84
 1902 01b2 FFF7FEFF 		bl	__aeabi_dmul
 1903              	.LVL207:
 346:Src/LTC6811.c **** 		}
 1904              		.loc 1 346 0
 1905 01b6 FFF7FEFF 		bl	__aeabi_d2uiz
 1906              	.LVL208:
 1907 01ba 2BF80400 		strh	r0, [fp, r4]	@ movhi
 1908 01be 56E7     		b	.L93
 1909              	.L97:
 1910              	.LBE18:
 350:Src/LTC6811.c **** 	
 1911              		.loc 1 350 0
 1912 01c0 5046     		mov	r0, r10
 1913 01c2 FFF7FEFF 		bl	free
 1914              	.LVL209:
 354:Src/LTC6811.c **** 
 1915              		.loc 1 354 0
 1916 01c6 0398     		ldr	r0, [sp, #12]
 1917 01c8 05B0     		add	sp, sp, #20
 1918              	.LCFI46:
 1919              		.cfi_def_cfa_offset 36
 1920              		@ sp needed
 1921 01ca BDE8F08F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, pc}
 1922              	.LVL210:
 1923              	.L99:
 1924 01ce 00BF     		.align	3
 1925              	.L98:
 1926 01d0 00000000 		.word	0
 1927 01d4 0088C340 		.word	1086556160
 1928 01d8 00000000 		.word	0
 1929 01dc 30D0FB40 		.word	1090244656
 1930 01e0 00000000 		.word	0
 1931 01e4 E06CE240 		.word	1088580832
 1932 01e8 00000000 		.word	0
 1933 01ec 386A0141 		.word	1090611768
 1934 01f0 00000000 		.word	0
 1935 01f4 1010F740 		.word	1089933328
 1936 01f8 00000000 		.word	0
 1937 01fc E0FDE040 		.word	1088486880
 1938 0200 00000000 		.word	0
 1939 0204 005DBA40 		.word	1085955328
 1940 0208 7B14AE47 		.word	1202590843
 1941 020c E1C88040 		.word	1082181857
 1942 0210 00000840 		.word	1074266112
 1943 0214 00001040 		.word	1074790400
ARM GAS  /tmp/ccbi9fCp.s 			page 51


 1944 0218 00001440 		.word	1075052544
 1945 021c 00001840 		.word	1075314688
 1946 0220 00003440 		.word	1077149696
 1947 0224 00407F40 		.word	1082081280
 1948              		.cfi_endproc
 1949              	.LFE71:
 1951              		.section	.text.readAllCellTemps,"ax",%progbits
 1952              		.align	1
 1953              		.global	readAllCellTemps
 1954              		.syntax unified
 1955              		.thumb
 1956              		.thumb_func
 1957              		.fpu softvfp
 1959              	readAllCellTemps:
 1960              	.LFB72:
 356:Src/LTC6811.c **** 
 1961              		.loc 1 356 0
 1962              		.cfi_startproc
 1963              		@ args = 100, pretend = 16, frame = 32
 1964              		@ frame_needed = 0, uses_anonymous_args = 0
 1965              	.LVL211:
 1966 0000 84B0     		sub	sp, sp, #16
 1967              	.LCFI47:
 1968              		.cfi_def_cfa_offset 16
 1969 0002 F0B5     		push	{r4, r5, r6, r7, lr}
 1970              	.LCFI48:
 1971              		.cfi_def_cfa_offset 36
 1972              		.cfi_offset 4, -36
 1973              		.cfi_offset 5, -32
 1974              		.cfi_offset 6, -28
 1975              		.cfi_offset 7, -24
 1976              		.cfi_offset 14, -20
 1977 0004 89B0     		sub	sp, sp, #36
 1978              	.LCFI49:
 1979              		.cfi_def_cfa_offset 72
 1980 0006 0EAC     		add	r4, sp, #56
 1981 0008 84E80F00 		stm	r4, {r0, r1, r2, r3}
 1982 000c 269C     		ldr	r4, [sp, #152]
 1983              	.LVL212:
 1984              	.LBB19:
 364:Src/LTC6811.c **** 
 1985              		.loc 1 364 0
 1986 000e 0026     		movs	r6, #0
 1987 0010 55E0     		b	.L101
 1988              	.LVL213:
 1989              	.L103:
 1990              	.LBB20:
 371:Src/LTC6811.c **** 			bmsData[(board * 8) + cell][1] |= (boardTempFault[cell / 2] << 4);
 1991              		.loc 1 371 0 discriminator 3
 1992 0012 01EBC503 		add	r3, r1, r5, lsl #3
 1993 0016 03EB4303 		add	r3, r3, r3, lsl #1
 1994 001a 5A00     		lsls	r2, r3, #1
 1995 001c 2244     		add	r2, r2, r4
 1996 001e 5378     		ldrb	r3, [r2, #1]	@ zero_extendqisi2
 1997 0020 03EA4003 		and	r3, r3, r0, lsl #1
 1998 0024 5BB2     		sxtb	r3, r3
 1999 0026 5370     		strb	r3, [r2, #1]
ARM GAS  /tmp/ccbi9fCp.s 			page 52


 372:Src/LTC6811.c **** 			bmsData[(board * 8) + cell][1] |= (boardDCFault[cell / 2] << 3);
 2000              		.loc 1 372 0 discriminator 3
 2001 0028 08AF     		add	r7, sp, #32
 2002 002a 07EB5107 		add	r7, r7, r1, lsr #1
 2003 002e 17F810CC 		ldrb	ip, [r7, #-16]	@ zero_extendqisi2
 2004 0032 43EA0C13 		orr	r3, r3, ip, lsl #4
 2005 0036 5BB2     		sxtb	r3, r3
 2006 0038 5370     		strb	r3, [r2, #1]
 373:Src/LTC6811.c **** 		}
 2007              		.loc 1 373 0 discriminator 3
 2008 003a 17F80C7C 		ldrb	r7, [r7, #-12]	@ zero_extendqisi2
 2009 003e 43EAC703 		orr	r3, r3, r7, lsl #3
 2010 0042 5370     		strb	r3, [r2, #1]
 370:Src/LTC6811.c **** 			bmsData[(board * 8) + cell][1] &= (PEC_check[board] << 1);
 2011              		.loc 1 370 0 discriminator 3
 2012 0044 0131     		adds	r1, r1, #1
 2013              	.LVL214:
 2014 0046 C9B2     		uxtb	r1, r1
 2015              	.LVL215:
 2016              	.L102:
 370:Src/LTC6811.c **** 			bmsData[(board * 8) + cell][1] &= (PEC_check[board] << 1);
 2017              		.loc 1 370 0 is_stmt 0 discriminator 1
 2018 0048 0729     		cmp	r1, #7
 2019 004a E2D9     		bls	.L103
 2020              	.LBE20:
 377:Src/LTC6811.c **** 		bmsData[(board * 8) + 0][5] = (uint8_t) (boardTemp[0] & 0xFF); //temp1 L
 2021              		.loc 1 377 0 is_stmt 1 discriminator 2
 2022 004c BDF81820 		ldrh	r2, [sp, #24]
 2023 0050 05EB4505 		add	r5, r5, r5, lsl #1
 2024 0054 2B01     		lsls	r3, r5, #4
 2025 0056 E118     		adds	r1, r4, r3
 2026              	.LVL216:
 2027 0058 100A     		lsrs	r0, r2, #8
 2028 005a 0871     		strb	r0, [r1, #4]
 378:Src/LTC6811.c **** 		bmsData[(board * 8) + 1][4] = (uint8_t) ((boardTemp[0] >> 8) & 0xFF); //temp1 H
 2029              		.loc 1 378 0 discriminator 2
 2030 005c D2B2     		uxtb	r2, r2
 2031 005e 4A71     		strb	r2, [r1, #5]
 379:Src/LTC6811.c **** 		bmsData[(board * 8) + 1][5] = (uint8_t) (boardTemp[0] & 0xFF); //temp1 L
 2032              		.loc 1 379 0 discriminator 2
 2033 0060 991D     		adds	r1, r3, #6
 2034 0062 2144     		add	r1, r1, r4
 2035 0064 0871     		strb	r0, [r1, #4]
 380:Src/LTC6811.c **** 		bmsData[(board * 8) + 2][4] = (uint8_t) ((boardTemp[1] >> 8) & 0xFF); //temp2 H
 2036              		.loc 1 380 0 discriminator 2
 2037 0066 4A71     		strb	r2, [r1, #5]
 381:Src/LTC6811.c **** 		bmsData[(board * 8) + 2][5] = (uint8_t) (boardTemp[1] & 0xFF); //temp2 L
 2038              		.loc 1 381 0 discriminator 2
 2039 0068 BDF81A20 		ldrh	r2, [sp, #26]
 2040 006c 03F10C01 		add	r1, r3, #12
 2041 0070 2144     		add	r1, r1, r4
 2042 0072 100A     		lsrs	r0, r2, #8
 2043 0074 0871     		strb	r0, [r1, #4]
 382:Src/LTC6811.c **** 		bmsData[(board * 8) + 3][4] = (uint8_t) ((boardTemp[1] >> 8) & 0xFF); //temp2 H
 2044              		.loc 1 382 0 discriminator 2
 2045 0076 D2B2     		uxtb	r2, r2
 2046 0078 4A71     		strb	r2, [r1, #5]
ARM GAS  /tmp/ccbi9fCp.s 			page 53


 383:Src/LTC6811.c **** 		bmsData[(board * 8) + 3][5] = (uint8_t) (boardTemp[1] & 0xFF); //temp2 L
 2047              		.loc 1 383 0 discriminator 2
 2048 007a 03F11201 		add	r1, r3, #18
 2049 007e 2144     		add	r1, r1, r4
 2050 0080 0871     		strb	r0, [r1, #4]
 384:Src/LTC6811.c **** 		bmsData[(board * 8) + 4][4] = (uint8_t) ((boardTemp[2] >> 8) & 0xFF); //temp3 H
 2051              		.loc 1 384 0 discriminator 2
 2052 0082 4A71     		strb	r2, [r1, #5]
 385:Src/LTC6811.c **** 		bmsData[(board * 8) + 4][5] = (uint8_t) (boardTemp[2] & 0xFF); //temp3 L
 2053              		.loc 1 385 0 discriminator 2
 2054 0084 BDF81C20 		ldrh	r2, [sp, #28]
 2055 0088 03F11801 		add	r1, r3, #24
 2056 008c 2144     		add	r1, r1, r4
 2057 008e 100A     		lsrs	r0, r2, #8
 2058 0090 0871     		strb	r0, [r1, #4]
 386:Src/LTC6811.c **** 		bmsData[(board * 8) + 5][4] = (uint8_t) ((boardTemp[2] >> 8) & 0xFF); //temp3 H
 2059              		.loc 1 386 0 discriminator 2
 2060 0092 D2B2     		uxtb	r2, r2
 2061 0094 4A71     		strb	r2, [r1, #5]
 387:Src/LTC6811.c **** 		bmsData[(board * 8) + 5][5] = (uint8_t) (boardTemp[2] & 0xFF); //temp3 L
 2062              		.loc 1 387 0 discriminator 2
 2063 0096 03F11E01 		add	r1, r3, #30
 2064 009a 2144     		add	r1, r1, r4
 2065 009c 0871     		strb	r0, [r1, #4]
 388:Src/LTC6811.c **** 		bmsData[(board * 8) + 6][4] = (uint8_t) ((boardTemp[3] >> 8) & 0xFF); //temp4 H
 2066              		.loc 1 388 0 discriminator 2
 2067 009e 4A71     		strb	r2, [r1, #5]
 389:Src/LTC6811.c **** 		bmsData[(board * 8) + 6][5] = (uint8_t) (boardTemp[3] & 0xFF); //temp4 L
 2068              		.loc 1 389 0 discriminator 2
 2069 00a0 BDF81E20 		ldrh	r2, [sp, #30]
 2070 00a4 03F12401 		add	r1, r3, #36
 2071 00a8 2144     		add	r1, r1, r4
 2072 00aa 100A     		lsrs	r0, r2, #8
 2073 00ac 0871     		strb	r0, [r1, #4]
 390:Src/LTC6811.c **** 		bmsData[(board * 8) + 7][4] = (uint8_t) ((boardTemp[3] >> 8) & 0xFF); //temp4 H
 2074              		.loc 1 390 0 discriminator 2
 2075 00ae D2B2     		uxtb	r2, r2
 2076 00b0 4A71     		strb	r2, [r1, #5]
 391:Src/LTC6811.c **** 		bmsData[(board * 8) + 7][5] = (uint8_t) (boardTemp[3] & 0xFF); //temp4 L
 2077              		.loc 1 391 0 discriminator 2
 2078 00b2 2A33     		adds	r3, r3, #42
 2079 00b4 2344     		add	r3, r3, r4
 2080 00b6 1871     		strb	r0, [r3, #4]
 392:Src/LTC6811.c **** 	}
 2081              		.loc 1 392 0 discriminator 2
 2082 00b8 5A71     		strb	r2, [r3, #5]
 364:Src/LTC6811.c **** 
 2083              		.loc 1 364 0 discriminator 2
 2084 00ba 0136     		adds	r6, r6, #1
 2085              	.LVL217:
 2086 00bc F6B2     		uxtb	r6, r6
 2087              	.LVL218:
 2088              	.L101:
 364:Src/LTC6811.c **** 
 2089              		.loc 1 364 0 is_stmt 0 discriminator 1
 2090 00be 0B2E     		cmp	r6, #11
 2091 00c0 0CD8     		bhi	.L110
ARM GAS  /tmp/ccbi9fCp.s 			page 54


 367:Src/LTC6811.c **** 
 2092              		.loc 1 367 0 is_stmt 1
 2093 00c2 3546     		mov	r5, r6
 2094 00c4 04AB     		add	r3, sp, #16
 2095 00c6 05AA     		add	r2, sp, #20
 2096 00c8 06A9     		add	r1, sp, #24
 2097 00ca 3046     		mov	r0, r6
 2098 00cc FFF7FEFF 		bl	readCellTemp
 2099              	.LVL219:
 2100 00d0 08AB     		add	r3, sp, #32
 2101 00d2 3344     		add	r3, r3, r6
 2102 00d4 03F81C0C 		strb	r0, [r3, #-28]
 2103              	.LVL220:
 2104              	.LBB21:
 370:Src/LTC6811.c **** 			bmsData[(board * 8) + cell][1] &= (PEC_check[board] << 1);
 2105              		.loc 1 370 0
 2106 00d8 0021     		movs	r1, #0
 2107 00da B5E7     		b	.L102
 2108              	.LVL221:
 2109              	.L110:
 2110              	.LBE21:
 2111              	.LBE19:
 2112              	.LBB22:
 395:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 2113              		.loc 1 395 0
 2114 00dc 0023     		movs	r3, #0
 2115              	.LBE22:
 362:Src/LTC6811.c **** 
 2116              		.loc 1 362 0
 2117 00de 0120     		movs	r0, #1
 2118 00e0 01E0     		b	.L105
 2119              	.LVL222:
 2120              	.L106:
 2121              	.LBB23:
 395:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 2122              		.loc 1 395 0 discriminator 2
 2123 00e2 0133     		adds	r3, r3, #1
 2124              	.LVL223:
 2125 00e4 DBB2     		uxtb	r3, r3
 2126              	.LVL224:
 2127              	.L105:
 395:Src/LTC6811.c **** 		if (PEC_check[board] == 0)
 2128              		.loc 1 395 0 is_stmt 0 discriminator 1
 2129 00e6 0B2B     		cmp	r3, #11
 2130 00e8 07D8     		bhi	.L111
 396:Src/LTC6811.c **** 			dataValid = false;
 2131              		.loc 1 396 0 is_stmt 1
 2132 00ea 08AA     		add	r2, sp, #32
 2133 00ec 1A44     		add	r2, r2, r3
 2134 00ee 12F81C2C 		ldrb	r2, [r2, #-28]	@ zero_extendqisi2
 2135 00f2 002A     		cmp	r2, #0
 2136 00f4 F5D1     		bne	.L106
 397:Src/LTC6811.c **** 	}
 2137              		.loc 1 397 0
 2138 00f6 1046     		mov	r0, r2
 2139              	.LVL225:
 2140 00f8 F3E7     		b	.L106
ARM GAS  /tmp/ccbi9fCp.s 			page 55


 2141              	.LVL226:
 2142              	.L111:
 2143              	.LBE23:
 401:Src/LTC6811.c **** 
 2144              		.loc 1 401 0
 2145 00fa 09B0     		add	sp, sp, #36
 2146              	.LCFI50:
 2147              		.cfi_def_cfa_offset 36
 2148              		@ sp needed
 2149 00fc BDE8F040 		pop	{r4, r5, r6, r7, lr}
 2150              	.LCFI51:
 2151              		.cfi_restore 14
 2152              		.cfi_restore 7
 2153              		.cfi_restore 6
 2154              		.cfi_restore 5
 2155              		.cfi_restore 4
 2156              		.cfi_def_cfa_offset 16
 2157              	.LVL227:
 2158 0100 04B0     		add	sp, sp, #16
 2159              	.LCFI52:
 2160              		.cfi_def_cfa_offset 0
 2161 0102 7047     		bx	lr
 2162              		.cfi_endproc
 2163              	.LFE72:
 2165              		.global	CRC15_POLY
 2166              		.comm	pec15Table,512,4
 2167              		.section	.data.CRC15_POLY,"aw",%progbits
 2168              		.align	1
 2169              		.set	.LANCHOR0,. + 0
 2172              	CRC15_POLY:
 2173 0000 9945     		.short	17817
 2174              		.text
 2175              	.Letext0:
 2176              		.file 2 "/usr/include/newlib/machine/_default_types.h"
 2177              		.file 3 "/usr/include/newlib/sys/_stdint.h"
 2178              		.file 4 "Drivers/CMSIS/Include/core_cm3.h"
 2179              		.file 5 "Drivers/CMSIS/Device/ST/STM32F1xx/Include/system_stm32f1xx.h"
 2180              		.file 6 "Drivers/CMSIS/Device/ST/STM32F1xx/Include/stm32f103xb.h"
 2181              		.file 7 "/usr/include/newlib/sys/lock.h"
 2182              		.file 8 "/usr/include/newlib/sys/_types.h"
 2183              		.file 9 "/usr/lib/gcc/arm-none-eabi/7.3.1/include/stddef.h"
 2184              		.file 10 "/usr/include/newlib/sys/reent.h"
 2185              		.file 11 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_gpio.h"
 2186              		.file 12 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal.h"
 2187              		.file 13 "/usr/include/newlib/stdlib.h"
 2188              		.file 14 "Inc/BMSconfig.h"
 2189              		.file 15 "/usr/include/newlib/math.h"
 2190              		.file 16 "Inc/LTC6811.h"
 2191              		.file 17 "Inc/SPI.h"
 2192              		.file 18 "<built-in>"
ARM GAS  /tmp/ccbi9fCp.s 			page 56


DEFINED SYMBOLS
                            *ABS*:0000000000000000 LTC6811.c
     /tmp/ccbi9fCp.s:16     .text.initPECTable:0000000000000000 $t
     /tmp/ccbi9fCp.s:23     .text.initPECTable:0000000000000000 initPECTable
     /tmp/ccbi9fCp.s:97     .text.initPECTable:0000000000000038 $d
                            *COM*:0000000000000200 pec15Table
     /tmp/ccbi9fCp.s:103    .text.calculatePEC:0000000000000000 $t
     /tmp/ccbi9fCp.s:110    .text.calculatePEC:0000000000000000 calculatePEC
     /tmp/ccbi9fCp.s:171    .text.calculatePEC:000000000000002c $d
     /tmp/ccbi9fCp.s:176    .text.readRegister:0000000000000000 $t
     /tmp/ccbi9fCp.s:183    .text.readRegister:0000000000000000 readRegister
     /tmp/ccbi9fCp.s:497    .text.readCellVoltage:0000000000000000 $t
     /tmp/ccbi9fCp.s:504    .text.readCellVoltage:0000000000000000 readCellVoltage
     /tmp/ccbi9fCp.s:604    .text.readConfig:0000000000000000 $t
     /tmp/ccbi9fCp.s:611    .text.readConfig:0000000000000000 readConfig
     /tmp/ccbi9fCp.s:672    .text.writeConfigAddress:0000000000000000 $t
     /tmp/ccbi9fCp.s:679    .text.writeConfigAddress:0000000000000000 writeConfigAddress
     /tmp/ccbi9fCp.s:872    .text.writeConfigAll:0000000000000000 $t
     /tmp/ccbi9fCp.s:879    .text.writeConfigAll:0000000000000000 writeConfigAll
     /tmp/ccbi9fCp.s:975    .text.writeConfigAll:0000000000000060 $d
     /tmp/ccbi9fCp.s:980    .text.dischargeCellGroups:0000000000000000 $t
     /tmp/ccbi9fCp.s:987    .text.dischargeCellGroups:0000000000000000 dischargeCellGroups
     /tmp/ccbi9fCp.s:1093   .text.sendBroadcastCommand:0000000000000000 $t
     /tmp/ccbi9fCp.s:1100   .text.sendBroadcastCommand:0000000000000000 sendBroadcastCommand
     /tmp/ccbi9fCp.s:1146   .text.readAllCellVoltages:0000000000000000 $t
     /tmp/ccbi9fCp.s:1153   .text.readAllCellVoltages:0000000000000000 readAllCellVoltages
     /tmp/ccbi9fCp.s:1393   .text.readAllCellVoltages:0000000000000134 $d
     /tmp/ccbi9fCp.s:1398   .text.checkAllCellConnections:0000000000000000 $t
     /tmp/ccbi9fCp.s:1405   .text.checkAllCellConnections:0000000000000000 checkAllCellConnections
     /tmp/ccbi9fCp.s:1564   .text.sendAddressCommand:0000000000000000 $t
     /tmp/ccbi9fCp.s:1571   .text.sendAddressCommand:0000000000000000 sendAddressCommand
     /tmp/ccbi9fCp.s:1649   .text.readCellTemp:0000000000000000 $t
     /tmp/ccbi9fCp.s:1656   .text.readCellTemp:0000000000000000 readCellTemp
     /tmp/ccbi9fCp.s:1926   .text.readCellTemp:00000000000001d0 $d
     /tmp/ccbi9fCp.s:1952   .text.readAllCellTemps:0000000000000000 $t
     /tmp/ccbi9fCp.s:1959   .text.readAllCellTemps:0000000000000000 readAllCellTemps
     /tmp/ccbi9fCp.s:2172   .data.CRC15_POLY:0000000000000000 CRC15_POLY
     /tmp/ccbi9fCp.s:2168   .data.CRC15_POLY:0000000000000000 $d

UNDEFINED SYMBOLS
malloc
SPIWriteRead
free
SPIWrite
HAL_GPIO_WritePin
memcpy
HAL_Delay
__aeabi_ui2d
__aeabi_ddiv
__aeabi_dmul
__aeabi_dsub
__aeabi_dadd
__aeabi_d2uiz
pow
